import{r as x,a as Ls,R as Ht}from"./react-vendor-wGySg1uH.js";import{c as As}from"./supabase-vendor-DfwcnzK-.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function l(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=l(r);fetch(r.href,o)}})();var zt={exports:{}},mt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $s=x,Es=Symbol.for("react.element"),Os=Symbol.for("react.fragment"),Is=Object.prototype.hasOwnProperty,Ms=$s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ps={key:!0,ref:!0,__self:!0,__source:!0};function Vt(t,s,l){var a,r={},o=null,m=null;l!==void 0&&(o=""+l),s.key!==void 0&&(o=""+s.key),s.ref!==void 0&&(m=s.ref);for(a in s)Is.call(s,a)&&!Ps.hasOwnProperty(a)&&(r[a]=s[a]);if(t&&t.defaultProps)for(a in s=t.defaultProps,s)r[a]===void 0&&(r[a]=s[a]);return{$$typeof:Es,type:t,key:o,ref:m,props:r,_owner:Ms.current}}mt.Fragment=Os;mt.jsx=Vt;mt.jsxs=Vt;zt.exports=mt;var e=zt.exports,bt={},Dt=Ls;bt.createRoot=Dt.createRoot,bt.hydrateRoot=Dt.hydrateRoot;const Fs=void 0,Rs=void 0;console.error("Missing Supabase environment variables!"),console.log("Please create a .env file with:"),console.log("VITE_SUPABASE_URL=your-project-url"),console.log("VITE_SUPABASE_ANON_KEY=your-anon-key");const R=As(Fs,Rs,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"boats-by-george-auth",storage:window.localStorage,flowType:"pkce"}}),Ts=Object.freeze(Object.defineProperty({__proto__:null,supabase:R},Symbol.toStringTag,{value:"Module"})),Fe={async signUp(t,s,l){const{data:a,error:r}=await R.auth.signUp({email:t,password:s,options:{data:{username:l.username,name:l.name}}});if(r)throw r;return a},async resendConfirmationEmail(t){const{data:s,error:l}=await R.auth.resend({type:"signup",email:t});if(l)throw l;return s},async signIn(t,s){const{data:l,error:a}=await R.auth.signInWithPassword({email:t,password:s});if(a)throw a;return l},async signOut(){const{error:t}=await R.auth.signOut();if(t)throw t},async getSession(){const{data:{session:t}}=await R.auth.getSession();return t},async getCurrentUser(){const t=await this.getSession();if(!t)return null;const{data:s,error:l}=await R.from("users").select("*").eq("auth_id",t.user.id).single();if(l)throw l;return s},async resetPasswordRequest(t){const{data:s,error:l}=await R.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/reset-password`});if(l)throw l;return s},async updatePassword(t){const{data:s,error:l}=await R.auth.updateUser({password:t});if(l)throw l;return s}},Ce={async getAll(){const{data:t,error:s}=await R.from("boats").select("*").order("created_at",{ascending:!1});if(s)throw s;return t||[]},async getById(t){const{data:s,error:l}=await R.from("boats").select("*").eq("id",t).single();if(l)throw l;return s},async getByQrCode(t){const{data:s,error:l}=await R.from("boats").select("*").eq("qr_code",t);if(l)throw l;return s&&s.length>0?s[0]:null},async getByNfcTag(t){const{data:s,error:l}=await R.from("boats").select("*").eq("nfc_tag",t);if(l)throw l;return s&&s.length>0?s[0]:null},async getByHullId(t){const{data:s,error:l}=await R.from("boats").select("*").eq("hull_id",t);if(l)throw l;return s&&s.length>0?s[0]:null},async create(t){const{data:s,error:l}=await R.from("boats").insert([t]).select();if(l)throw l;return s&&s.length>0?s[0]:null},async update(t,s){const{data:l,error:a}=await R.from("boats").update(s).eq("id",t).select();if(a)throw a;return l&&l.length>0?l[0]:null},async delete(t){const{error:s}=await R.from("boats").delete().eq("id",t);if(s)throw s},async batchUpdate(t){const s=t.map(l=>this.update(l.id,l));return Promise.all(s)},async search(t){const s=t.toLowerCase(),{data:l,error:a}=await R.from("boats").select("*").or(`name.ilike.%${s}%,model.ilike.%${s}%,owner.ilike.%${s}%`);if(a)throw a;return l||[]},async getByStatus(t){const{data:s,error:l}=await R.from("boats").select("*").eq("status",t);if(l)throw l;return s||[]},async getByLocation(t){const{data:s,error:l}=await R.from("boats").select("*").eq("location",t);if(l)throw l;return s||[]},async assignNfcTag(t,s){const l=await this.getByNfcTag(s);if(l&&l.id!==t)throw new Error("NFC tag is already assigned to another boat");return this.update(t,{nfc_tag:s})},async releaseNfcTag(t){return this.update(t,{nfc_tag:null})},async archive(t){return this.update(t,{status:"archived",archived_date:new Date().toISOString()})},async release(t){const s=await this.getById(t);if(s.location&&s.slot){const{data:l}=await R.from("locations").select("*").eq("name",s.location);if(l&&l.length>0){const a=l[0],r={...a.boats};delete r[s.slot],await R.from("locations").update({boats:r}).eq("id",a.id)}}return this.archive(t)},async importFromDockmaster(t){var l,a,r;if(t.serialNumber||t.hullId){const o=t.serialNumber||t.hullId,m=await this.getByHullId(o);if(m)return m}const s={name:t.name||t.description||`${((l=t.boatModelInfo)==null?void 0:l.vendorName)||""} ${((a=t.boatModelInfo)==null?void 0:a.modelNumber)||""}`.trim()||"Unknown Boat",model:t.model||((r=t.boatModelInfo)==null?void 0:r.modelNumber)||"",hull_id:t.serialNumber||t.hullId||null,owner:t.owner||t.custName||"",customer_id:t.custId||null,dockmaster_boat_id:t.id||t.dockmasterId||null,status:"active",location:null,slot:null};return this.create(s)},async assignToSlot(t,s,l){const{data:a,error:r}=await R.from("locations").select("*").eq("id",s).single();if(r)throw r;if(a.boats&&a.boats[l])throw new Error("Slot is already occupied");const o=await this.getById(t);o.location&&o.slot&&await this.removeFromSlot(t);const m={...a.boats,[l]:t};return await R.from("locations").update({boats:m}).eq("id",s),this.update(t,{location:a.name,slot:l})},async removeFromSlot(t){const s=await this.getById(t);if(!s.location||!s.slot)return s;const{data:l}=await R.from("locations").select("*").eq("name",s.location);if(l&&l.length>0){const a=l[0];if(a.type==="pool"){const r=(a.pool_boats||[]).filter(o=>o!==t);await R.from("locations").update({pool_boats:r}).eq("id",a.id)}else{const r={...a.boats};delete r[s.slot],await R.from("locations").update({boats:r}).eq("id",a.id)}}return this.update(t,{location:null,slot:null})},async moveToSlot(t,s,l){const{error:a}=await R.from("locations").select("id").eq("id",s).single();if(a)throw a;const{data:r}=await R.from("locations").select("*").order("id",{ascending:!0});if(r)for(const p of r){let u=!1,w={...p};if(p.boats){const d=Object.keys(p.boats).find(D=>p.boats[D]===t);d&&(console.log("[Boats] Found boat in grid location:",p.name,"slot:",d,"- removing it"),w.boats={...p.boats},delete w.boats[d],u=!0)}if(p.type==="pool"&&p.pool_boats&&p.pool_boats.includes(t)&&(console.log("[Boats] Found boat in pool location:",p.name,"- removing it"),w.pool_boats=p.pool_boats.filter(d=>d!==t),u=!0),u){const d={};w.boats&&(d.boats=w.boats),w.pool_boats&&(d.pool_boats=w.pool_boats),await R.from("locations").update(d).eq("id",p.id)}}const{data:o,error:m}=await R.from("locations").select("*").eq("id",s).single();if(m)throw m;if(o.type==="pool"){const u=[...o.pool_boats||[],t];return await R.from("locations").update({pool_boats:u}).eq("id",s),this.update(t,{location:o.name,slot:"pool"})}else{if(o.boats&&o.boats[l])throw new Error("Target slot is already occupied");const p={...o.boats,[l]:t};return await R.from("locations").update({boats:p}).eq("id",s),this.update(t,{location:o.name,slot:l})}}},ze={STATUSES:{NEEDS_APPROVAL:"needs-approval",NEEDS_PARTS:"needs-parts",PARTS_KIT_PULLED:"parts-kit-pulled",ON_DECK:"on-deck",ALL_WORK_COMPLETE:"all-work-complete",ARCHIVED:"archived",ACTIVE:"active"},async findExistingBoat(t){const{dockmasterId:s,hullId:l}=t;if(s){const{data:a,error:r}=await R.from("boats").select("*").eq("dockmaster_id",s);if(!r&&a&&a.length>0)return{boat:a[0],source:"boats"}}if(l){const{data:a,error:r}=await R.from("boats").select("*").eq("hull_id",l);if(!r&&a&&a.length>0)return{boat:a[0],source:"boats"}}if(s){const{data:a,error:r}=await R.from("inventory_boats").select("*").eq("dockmaster_id",s);if(!r&&a&&a.length>0)return{boat:a[0],source:"inventory_boats"}}return null},async importOrUpdateBoat(t,s={}){const{preserveLocation:l=!1,targetStatus:a=this.STATUSES.NEEDS_APPROVAL}=s,r={name:t.name||"Unknown Boat",model:t.model||"",hull_id:t.hullId||t.hull_id||null,dockmaster_id:t.dockmasterId||t.dockmaster_id||null,owner:t.owner||"",customer_id:t.customerId||t.customer_id||null,work_order_number:t.workOrderNumber||t.work_order_number||null},o=await this.findExistingBoat({dockmasterId:r.dockmaster_id,hullId:r.hull_id});if(o){const{boat:m,source:p}=o;if(p==="inventory_boats"){const d={...r,qr_code:`QR-${Date.now()}`,nfc_tag:null,status:a,location:null,slot:null,archived_date:null},{data:D,error:H}=await R.from("boats").insert([d]).select();if(H)throw H;return D[0]}const u=m.status===this.STATUSES.ARCHIVED,w={...r,status:u?a:m.status,archived_date:u?null:m.archived_date,location:l?m.location:null,slot:l?m.slot:null};return await Ce.update(m.id,w)}else{const m={...r,qr_code:t.qrCode||`QR-${Date.now()}`,nfc_tag:t.nfcTag||null,status:a,location:null,slot:null,archived_date:null};return await Ce.create(m)}},async unarchiveBoat(t,s={}){const{targetStatus:l=this.STATUSES.NEEDS_APPROVAL,location:a=null,slot:r=null}=s,o=await Ce.getById(t);if(!o)throw new Error(`Boat ${t} not found`);if(o.status!==this.STATUSES.ARCHIVED)return a!==null?await Ce.update(t,{location:a,slot:r}):o;const m={status:l,archived_date:null,location:a,slot:r};return await Ce.update(t,m)},async archiveBoat(t){const s={status:this.STATUSES.ARCHIVED,archived_date:new Date().toISOString(),location:null,slot:null};return await Ce.update(t,s)},async updateBoatStatus(t,s){const l=await Ce.getById(t);if(!l)throw new Error(`Boat ${t} not found`);if(l.status===this.STATUSES.ARCHIVED&&s!==this.STATUSES.ARCHIVED)throw new Error("Cannot change status of archived boat. Unarchive it first.");if(!Object.values(this.STATUSES).includes(s))throw new Error(`Invalid status: ${s}`);return await Ce.update(t,{status:s})}},kt={async getAll(){const{data:t,error:s}=await R.from("inventory_boats").select("*").order("created_at",{ascending:!1});if(s)throw s;return t||[]},async getById(t){const{data:s,error:l}=await R.from("inventory_boats").select("*").eq("id",t).single();if(l)throw l;return s},async getByDockmasterId(t){const{data:s,error:l}=await R.from("inventory_boats").select("*").eq("dockmaster_id",t);if(l)throw l;return s&&s.length>0?s[0]:null},async getByHullId(t){const{data:s,error:l}=await R.from("inventory_boats").select("*").eq("hull_id",t);if(l)throw l;return s&&s.length>0?s[0]:null},async create(t){const{data:s,error:l}=await R.from("inventory_boats").insert([t]).select();if(l)throw l;return s&&s.length>0?s[0]:null},async update(t,s){const{data:l,error:a}=await R.from("inventory_boats").update(s).eq("id",t).select();if(a)throw a;return l&&l.length>0?l[0]:null},async sync(t,s=!1){const l=await this.getAll(),a=new Map(l.map(u=>[u.dockmaster_id,u])),r=[],o=[],m=new Set;for(const u of t)if(m.add(u.dockmaster_id),a.has(u.dockmaster_id)){const w=a.get(u.dockmaster_id);r.push({id:w.id,...u,last_synced:new Date().toISOString()})}else o.push({...u,last_synced:new Date().toISOString()});const p=[];if(o.length>0&&p.push(R.from("inventory_boats").insert(o)),r.length>0&&p.push(...r.map(u=>R.from("inventory_boats").update(u).eq("id",u.id))),await Promise.all(p),s){const u=l.filter(w=>!m.has(w.dockmaster_id));if(u.length>0){console.log(`Deleting ${u.length} boats no longer in Dockmaster`);const w=u.map(D=>D.id),{error:d}=await R.from("inventory_boats").delete().in("id",w);d&&console.error("Error deleting stale inventory boats:",d)}}return this.getAll()},async delete(t){const{error:s}=await R.from("inventory_boats").delete().eq("id",t);if(s)throw s},async search(t){const s=t.toLowerCase(),{data:l,error:a}=await R.from("inventory_boats").select("*").or(`name.ilike.%${s}%,model.ilike.%${s}%,make.ilike.%${s}%`);if(a)throw a;return l||[]},async getBySalesStatus(t){const{data:s,error:l}=await R.from("inventory_boats").select("*").eq("sales_status",t);if(l)throw l;return s||[]},async getByYear(t){const{data:s,error:l}=await R.from("inventory_boats").select("*").eq("year",t);if(l)throw l;return s||[]},async getByMake(t){const{data:s,error:l}=await R.from("inventory_boats").select("*").eq("make",t);if(l)throw l;return s||[]},async assignNfcTag(t,s){const{data:l,error:a}=await R.from("inventory_boats").select("*").eq("nfc_tag",s);if(l&&l.length>0&&l[0].id!==t)throw new Error("NFC tag is already assigned to another boat");return this.update(t,{nfc_tag:s})},async releaseNfcTag(t){return this.update(t,{nfc_tag:null})},async assignToSlot(t,s,l){const{data:a,error:r}=await R.from("locations").select("*").eq("id",s).single();if(r)throw r;if(a.boats&&a.boats[l])throw new Error("Slot is already occupied");const o=await this.getById(t);o.location&&o.slot&&await this.removeFromSlot(t);const m={...a.boats,[l]:t};return await R.from("locations").update({boats:m}).eq("id",s),this.update(t,{location:a.name,slot:l})},async removeFromSlot(t){console.log("[removeFromSlot] Starting removal for boat:",t);const{data:s}=await R.from("locations").select("*");console.log("[removeFromSlot] Searching through all locations for boat:",t);for(const a of s||[]){let r=!1;if(a.type==="pool"){const o=a.pool_boats||[];if(o.includes(t)){console.log("[removeFromSlot] Found boat in pool location:",a.name),r=!0;const m=o.filter(p=>p!==t);await R.from("locations").update({pool_boats:m}).eq("id",a.id),console.log("[removeFromSlot] Removed from pool_boats")}}else{const o=a.boats||{},m=Object.keys(o).find(p=>o[p]===t);if(m){console.log("[removeFromSlot] Found boat in grid location:",a.name,"slot:",m),r=!0;const p={...o};delete p[m],await R.from("locations").update({boats:p}).eq("id",a.id),console.log("[removeFromSlot] Removed from boats object")}}if(r)break}console.log("[removeFromSlot] Clearing boat location and slot fields");const l=await this.update(t,{location:null,slot:null});return console.log("[removeFromSlot] Removal complete:",l),l},async moveToSlot(t,s,l){const{data:a,error:r}=await R.from("locations").select("*").eq("id",s).single();if(r)throw r;await this.getById(t);const{data:o}=await R.from("locations").select("*").order("id",{ascending:!0});if(o)for(const u of o){let w=!1,d={...u};if(u.boats){const D=Object.keys(u.boats).find(H=>u.boats[H]===t);D&&(console.log("[Inventory] Found boat in grid location:",u.name,"slot:",D,"- removing it"),d.boats={...u.boats},delete d.boats[D],w=!0)}if(u.type==="pool"&&u.pool_boats&&u.pool_boats.includes(t)&&(console.log("[Inventory] Found boat in pool location:",u.name,"- removing it"),d.pool_boats=u.pool_boats.filter(D=>D!==t),w=!0),w){const D={};d.boats&&(D.boats=d.boats),d.pool_boats&&(D.pool_boats=d.pool_boats),await R.from("locations").update(D).eq("id",u.id)}}const{data:m,error:p}=await R.from("locations").select("*").eq("id",s).single();if(p)throw p;if(m.type==="pool"){const u=m.pool_boats||[];if(u.includes(t))console.log("[Inventory] Boat already in target pool, skipping add");else{const w=[...u,t];await R.from("locations").update({pool_boats:w}).eq("id",s)}return this.update(t,{location:m.name,slot:"pool"})}else{if(m.boats&&m.boats[l])throw new Error("Target slot is already occupied");const u={...m.boats,[l]:t};return await R.from("locations").update({boats:u}).eq("id",s),this.update(t,{location:m.name,slot:l})}}},Ws={async getAll(){const{data:t,error:s}=await R.from("locations").select("*").order("name",{ascending:!0});if(s)throw s;return t||[]},async getById(t){const{data:s,error:l}=await R.from("locations").select("*").eq("id",t).single();if(l)throw l;return s},async create(t){const{data:s,error:l}=await R.from("locations").insert([t]).select();if(l)throw l;return s&&s.length>0?s[0]:null},async update(t,s){const{data:l,error:a}=await R.from("locations").update(s).eq("id",t).select();if(a)throw a;return l&&l.length>0?l[0]:null},async delete(t){const{error:s}=await R.from("locations").delete().eq("id",t);if(s)throw s},async batchUpdate(t){const s=t.map(l=>this.update(l.id,l));return Promise.all(s)},async getByName(t){const{data:s,error:l}=await R.from("locations").select("*").eq("name",t);if(l)throw l;return s&&s.length>0?s[0]:null},async getBoatsAtLocation(t,s){const l=await this.getById(t);if(!l||!l.boats)return[];const a=Object.values(l.boats);return s.filter(r=>a.includes(r.id))},async clearAllBoats(t){return this.update(t,{boats:{}})}},qs={async getAll(){const{data:t,error:s}=await R.from("sites").select("*").order("sort_order",{ascending:!0});if(s)throw s;return t||[]},async getById(t){const{data:s,error:l}=await R.from("sites").select("*").eq("id",t).single();if(l)throw l;return s},async create(t){const{data:s}=await R.from("sites").select("sort_order").order("sort_order",{ascending:!1}).limit(1),l=s&&s.length>0?s[0].sort_order+1:0,{data:a,error:r}=await R.from("sites").insert([{...t,sort_order:l}]).select();if(r)throw r;return a&&a.length>0?a[0]:null},async update(t,s){const{data:l,error:a}=await R.from("sites").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select();if(a)throw a;return l&&l.length>0?l[0]:null},async delete(t){const{data:s}=await R.from("locations").select("id").eq("site_id",t).limit(1);if(s&&s.length>0)throw new Error("Cannot delete site with assigned locations. Please move or delete locations first.");const{error:l}=await R.from("sites").delete().eq("id",t);if(l)throw l},async reorder(t){const s=t.map((r,o)=>R.from("sites").update({sort_order:o,updated_at:new Date().toISOString()}).eq("id",r)),a=(await Promise.all(s)).filter(r=>r.error);if(a.length>0)throw a[0].error;return!0},async ensureDefaultSite(){const t=await this.getAll();return t.length===0?this.create({name:"Main Site"}):t[0]},async getLocationsForSite(t){const{data:s,error:l}=await R.from("locations").select("*").eq("site_id",t).order("name",{ascending:!0});if(l)throw l;return s||[]}},Hs={async get(t){const{data:s,error:l}=await R.from("user_preferences").select("*").eq("user_id",t);if(l)throw l;return s&&s.length>0?s[0]:null},async save(t,s){const{data:l,error:a}=await R.from("user_preferences").upsert({user_id:t,selected_locations:s.selectedLocations||[],location_order:s.locationOrder||[]},{onConflict:"user_id"}).select();if(a)throw a;return l&&l.length>0?l[0]:null}},zs={async getConfig(){const{data:t,error:s}=await R.from("dockmaster_config").select("*").limit(1);if(s)throw s;return t&&t.length>0?t[0]:null},async saveConfig(t){const s=await this.getConfig();if(s){const{data:l,error:a}=await R.from("dockmaster_config").update(t).eq("id",s.id).select();if(a)throw a;return l&&l.length>0?l[0]:null}else{const{data:l,error:a}=await R.from("dockmaster_config").insert([t]).select();if(a)throw a;return l&&l.length>0?l[0]:null}},async updateLastSync(){const t=await this.getConfig();if(!t)return;const{error:s}=await R.from("dockmaster_config").update({last_sync:new Date().toISOString()}).eq("id",t.id);if(s)throw s}},Vs={async getAll(){const{data:t,error:s}=await R.from("users").select("*").order("created_at",{ascending:!1});if(s)throw s;return t||[]},async updateRole(t,s){const{data:l,error:a}=await R.from("users").update({role:s}).eq("id",t).select();if(a)throw a;return l&&l.length>0?l[0]:null}},Ys={subscribeToBoats(t){return R.channel("boats-changes").on("postgres_changes",{event:"*",schema:"public",table:"boats"},t).subscribe()},subscribeToLocations(t){return R.channel("locations-changes").on("postgres_changes",{event:"*",schema:"public",table:"locations"},t).subscribe()},subscribeToInventoryBoats(t){return R.channel("inventory-boats-changes").on("postgres_changes",{event:"*",schema:"public",table:"inventory_boats"},t).subscribe()},unsubscribe(t){R.removeChannel(t)}},Ks=async()=>{const[t,s]=await Promise.all([Ce.getAll(),kt.getAll()]),l=s.map(a=>({...a,isInventory:!0}));return[...t,...l]},Be=t=>{if(!t)return t;if(Array.isArray(t))return t.map(Be);if(typeof t!="object")return t;const s={};for(const[l,a]of Object.entries(t)){const r=l.replace(/_([a-z])/g,(o,m)=>m.toUpperCase());s[r]=typeof a=="object"?Be(a):a}return s},wt=t=>{if(!t)return t;if(Array.isArray(t))return t.map(wt);if(typeof t!="object")return t;const s={};for(const[l,a]of Object.entries(t)){const r=l.replace(/[A-Z]/g,o=>`_${o.toLowerCase()}`);s[r]=typeof a=="object"?wt(a):a}return s},ke={async getAll(){const{data:t,error:s}=await R.from("boat_shows").select("*").order("show_date",{ascending:!0,nullsFirst:!1});if(s)throw s;return(t==null?void 0:t.map(Be))||[]},async getById(t){const{data:s,error:l}=await R.from("boat_shows").select(`
        *,
        items:boat_show_items(*)
      `).eq("id",t).single();if(l)throw l;return Be(s)},async create(t){const s={name:t.name,venue:t.venue||null,show_date:t.showDate||null,width_ft:t.widthFt||100,height_ft:t.heightFt||100,notes:t.notes||null},{data:l,error:a}=await R.from("boat_shows").insert([s]).select().single();if(a)throw a;return Be(l)},async update(t,s){const l={};s.name!==void 0&&(l.name=s.name),s.venue!==void 0&&(l.venue=s.venue),s.showDate!==void 0&&(l.show_date=s.showDate),s.widthFt!==void 0&&(l.width_ft=s.widthFt),s.heightFt!==void 0&&(l.height_ft=s.heightFt),s.notes!==void 0&&(l.notes=s.notes);const{data:a,error:r}=await R.from("boat_shows").update(l).eq("id",t).select().single();if(r)throw r;return Be(a)},async delete(t){const{error:s}=await R.from("boat_shows").delete().eq("id",t);if(s)throw s;return!0},async getItems(t){const{data:s,error:l}=await R.from("boat_show_items").select(`
        *,
        inventory_boat:inventory_boats(*)
      `).eq("show_id",t).order("z_index",{ascending:!0});if(l)throw l;return(s==null?void 0:s.map(a=>{const r=Be(a);return r.inventoryBoat&&(r.boat=Be(r.inventoryBoat),delete r.inventoryBoat),r}))||[]},async addItem(t,s){const l={show_id:t,item_type:s.itemType,inventory_boat_id:s.inventoryBoatId||null,x:s.x||0,y:s.y||0,rotation:s.rotation||0,width_ft:s.widthFt||null,height_ft:s.heightFt||null,label:s.label||null,color:s.color||null,z_index:s.zIndex||0},{data:a,error:r}=await R.from("boat_show_items").insert([l]).select(`
        *,
        inventory_boat:inventory_boats(*)
      `).single();if(r)throw r;const o=Be(a);return o.inventoryBoat&&(o.boat=Be(o.inventoryBoat),delete o.inventoryBoat),o},async updateItem(t,s){const l={};s.x!==void 0&&(l.x=s.x),s.y!==void 0&&(l.y=s.y),s.rotation!==void 0&&(l.rotation=s.rotation),s.widthFt!==void 0&&(l.width_ft=s.widthFt),s.heightFt!==void 0&&(l.height_ft=s.heightFt),s.label!==void 0&&(l.label=s.label),s.color!==void 0&&(l.color=s.color),s.zIndex!==void 0&&(l.z_index=s.zIndex);const{data:a,error:r}=await R.from("boat_show_items").update(l).eq("id",t).select(`
        *,
        inventory_boat:inventory_boats(*)
      `).single();if(r)throw r;const o=Be(a);return o.inventoryBoat&&(o.boat=Be(o.inventoryBoat),delete o.inventoryBoat),o},async removeItem(t){const{error:s}=await R.from("boat_show_items").delete().eq("id",t);if(s)throw s;return!0},async updateItems(t){const s=t.map(r=>({id:r.id,x:r.x,y:r.y,rotation:r.rotation,z_index:r.zIndex})),a=(await Promise.all(s.map(r=>R.from("boat_show_items").update({x:r.x,y:r.y,rotation:r.rotation,z_index:r.z_index}).eq("id",r.id)))).filter(r=>r.error);if(a.length>0)throw a[0].error;return!0},subscribeToShow(t,s){return R.channel(`boat_show_${t}`).on("postgres_changes",{event:"*",schema:"public",table:"boat_show_items",filter:`show_id=eq.${t}`},s).subscribe()},unsubscribe(t){t&&R.removeChannel(t)}},Gs={async logMovement({boatId:t,boatType:s,fromLocation:l,fromSlot:a,toLocation:r,toSlot:o,movedBy:m,notes:p}){const{data:u,error:w}=await R.from("boat_movements").insert([{boat_id:t,boat_type:s||"customer",from_location:l,from_slot:a,to_location:r,to_slot:o,moved_by:m,notes:p||null}]).select();if(w)throw w;return u&&u.length>0?u[0]:null},async getForBoat(t,s=10){const{data:l,error:a}=await R.from("boat_movements").select(`
        *,
        moved_by_user:users!boat_movements_moved_by_fkey(id, name, email)
      `).eq("boat_id",t).order("moved_at",{ascending:!1}).limit(s);if(a)throw a;return(l||[]).map(r=>({id:r.id,boatId:r.boat_id,boatType:r.boat_type,fromLocation:r.from_location,fromSlot:r.from_slot,toLocation:r.to_location,toSlot:r.to_slot,movedBy:r.moved_by,movedByUser:r.moved_by_user,movedAt:r.moved_at,notes:r.notes}))},async getLastMovements(t,s=2){return this.getForBoat(t,s)}},Le={auth:Fe,boats:Ce,boatLifecycle:ze,inventoryBoats:kt,locations:Ws,sites:qs,preferences:Hs,dockmaster:zs,users:Vs,boatShows:ke,boatMovements:Gs,subscriptions:Ys,getAllBoatsCombined:Ks,toCamelCase:Be,toSnakeCase:wt},Yt=x.createContext({}),lt=()=>{const t=x.useContext(Yt);if(!t)throw new Error("useAuth must be used within AuthProvider");return t},Js=({children:t})=>{const[s,l]=x.useState(null),[a,r]=x.useState(!0),[o,m]=x.useState(null),[p,u]=x.useState(!1),[w,d]=x.useState(!1),[D,H]=x.useState(""),[N,P]=x.useState(!1),T=x.useRef(!1);x.useEffect(()=>{const $=async()=>{var ee;const z=window.location.hash,O=new URLSearchParams(window.location.search),B=window.location.pathname;console.log("Checking for recovery flow...",{pathname:B,hash:z==null?void 0:z.substring(0,50),search:(ee=window.location.search)==null?void 0:ee.substring(0,50)});const X=B==="/reset-password"||B.includes("reset-password");let ae=!1;z&&new URLSearchParams(z.substring(1)).get("type")==="recovery"&&(console.log("Recovery token detected in URL hash"),ae=!0),O.get("type")==="recovery"&&(console.log("Recovery token detected in URL params"),ae=!0);const E=O.get("code");if(E&&X){console.log("PKCE code detected on reset-password path, exchanging for session...");try{const{data:oe,error:b}=await R.auth.exchangeCodeForSession(E);if(b)console.error("Error exchanging code for session:",b);else return console.log("Successfully exchanged code for session"),m(oe.session),u(!0),r(!1),window.history.replaceState({},document.title,"/reset-password"),!0}catch(oe){console.error("Exception exchanging code:",oe)}}return ae||X?(console.log("Activating password reset mode"),u(!0),!0):!1};(async()=>{const z=await $();await v(),z&&u(!0)})();const{data:q}=R.auth.onAuthStateChange(async(z,O)=>{console.log("Auth event:",z,"Session:",O?"exists":"null");const B=window.location.hash,X=window.location.pathname,ae=B&&B.includes("type=recovery")||X==="/reset-password"||X.includes("reset-password");switch(z){case"SIGNED_IN":if(ae||p){console.log("Recovery sign-in detected, showing password reset form"),m(O),u(!0),r(!1);return}console.log("Sign-in detected, waiting for INITIAL_SESSION to load profile"),m(O);break;case"TOKEN_REFRESHED":m(O);break;case"USER_UPDATED":console.log("User updated (password/email change), updating session only"),m(O);break;case"SIGNED_OUT":console.log("User signed out, clearing state"),m(null),l(null);break;case"PASSWORD_RECOVERY":console.log("Password recovery mode activated"),m(O),u(!0);break;case"INITIAL_SESSION":m(O),O!=null&&O.user&&!s&&await I(O.user.id);break;default:O&&(m(O),O.user&&!s&&await I(O.user.id));break}});return()=>{var z;(z=q==null?void 0:q.subscription)==null||z.unsubscribe()}},[]);const v=async()=>{console.log("Checking for existing user session...");try{const $=await Fe.getSession();console.log("Session found:",$?"Yes":"No"),m($),$!=null&&$.user&&!s?(console.log("Loading user profile from session..."),await I($.user.id)):$!=null&&$.user&&s?console.log("User profile already loaded, skipping"):console.log("No active session")}catch($){console.error("Error checking user:",$)}finally{console.log("✓ Check user complete, setting loading to false"),r(!1)}},I=async($,g=0)=>{var q;if(T.current)return console.log("Profile load already in progress, skipping duplicate request"),s;if(s&&s.auth_id===$)return console.log("Profile already loaded for this auth_id"),s;console.log("Loading user profile for auth_id:",$),T.current=!0;try{const z=new Promise((ae,E)=>setTimeout(()=>E(new Error("User profile load timeout after 5 seconds")),5e3)),O=R.from("users").select("*").eq("auth_id",$).single(),{data:B,error:X}=await Promise.race([O,z]);if(X)throw console.error("Error loading user profile:",X),X;return console.log("✓ User profile loaded:",B),l(B),T.current=!1,B}catch(z){return console.error("Failed to load user profile:",z),T.current=!1,g<2&&((q=z.message)!=null&&q.includes("timeout")||z.code==="PGRST000")?(console.log(`Retrying user profile load (attempt ${g+2}/3)...`),await new Promise(O=>setTimeout(O,1e3)),I($,g+1)):(z.code==="PGRST116"&&console.error("User profile not found. Please contact an administrator."),console.warn("Could not load user profile"),null)}},K={user:s,session:o,loading:a,signUp:async($,g,q)=>{try{return r(!0),{data:await Fe.signUp($,g,q),error:null}}catch(z){return console.error("Sign up error:",z),{data:null,error:z}}finally{r(!1)}},signIn:async($,g)=>{var q,z,O,B;try{r(!0);const X=await Fe.signIn($,g);return(q=X.session)!=null&&q.user&&await I(X.session.user.id),{data:X,error:null}}catch(X){return console.error("Sign in error:",X),(z=X.message)!=null&&z.includes("Email not confirmed")||(O=X.message)!=null&&O.includes("email_not_confirmed")||(B=X.message)!=null&&B.includes("Email link is invalid or has expired")?(d(!0),H($),{data:null,error:{...X,isEmailNotConfirmed:!0,message:"Please confirm your email address before logging in. Check your inbox for the confirmation link."}}):{data:null,error:X}}finally{r(!1)}},signOut:async()=>{try{return r(!0),await Fe.signOut(),l(null),m(null),{error:null}}catch($){return console.error("Sign out error:",$),{error:$}}finally{r(!1)}},refreshUser:async()=>{o!=null&&o.user&&await I(o.user.id)},hasRole:$=>(s==null?void 0:s.role)===$,isAdmin:()=>(s==null?void 0:s.role)==="admin",isManagerOrAdmin:()=>(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="manager",requestPasswordReset:async $=>{try{return r(!0),await Fe.resetPasswordRequest($),{error:null}}catch(g){return console.error("Password reset request error:",g),{error:g}}finally{r(!1)}},updatePassword:async $=>{try{return r(!0),await Fe.updatePassword($),{error:null}}catch(g){return console.error("Password update error:",g),{error:g}}finally{r(!1)}},showPasswordReset:p,setShowPasswordReset:u};return e.jsx(Yt.Provider,{value:K,children:t})},Us=()=>{const[t,s]=x.useState(!1),[l,a]=x.useState(!1),[r,o]=x.useState(""),[m,p]=x.useState(""),[u,w]=x.useState(""),[d,D]=x.useState(""),[H,N]=x.useState(""),[P,T]=x.useState(""),[v,I]=x.useState(!1),{signIn:se,signUp:V,requestPasswordReset:y}=lt(),A=async G=>{G.preventDefault(),N(""),T(""),I(!0);try{if(l){const{error:Y}=await y(r);if(Y)throw Y;T("Password reset email sent! Please check your inbox."),a(!1),o("")}else if(t){if(!d){N("Please enter your full name");return}const Y=u.trim()||r.split("@")[0],{data:le,error:L}=await V(r,m,{username:Y,name:d});if(L)throw L;T("Account created! Please check your email to confirm."),s(!1)}else{const{data:Y,error:le}=await se(r,m);if(le)throw le}}catch(Y){N(Y.message||"Authentication failed")}finally{I(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-slate-100 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"mx-auto mb-4 flex items-center justify-center",children:[e.jsx("img",{src:"/images/logo.png",alt:"Boats By George",className:"h-24 w-auto object-contain",onError:G=>{G.target.style.display="none",G.target.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center",style:{display:"none"},children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Boats By George"}),e.jsx("p",{className:"text-slate-600",children:"Asset Management System"})]}),H&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",children:[H,showResendEmail&&!resendSuccess&&e.jsx("button",{type:"button",onClick:handleResendConfirmation,className:"mt-2 text-sm text-blue-600 hover:text-blue-700 underline",disabled:v,children:"Resend confirmation email"})]}),P&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4",children:P}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:d,onChange:G=>D(G.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John Doe",required:t})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Username ",e.jsx("span",{className:"text-slate-400 font-normal",children:"(optional)"})]}),e.jsx("input",{type:"text",value:u,onChange:G=>w(G.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"johndoe"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Leave blank to use your email as username"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:r,onChange:G=>o(G.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"you@example.com",required:!0})]}),!l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",value:m,onChange:G=>p(G.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"••••••••",required:!0,minLength:6}),t&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Minimum 6 characters"})]}),!t&&!l&&e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"button",onClick:()=>{a(!0),N(""),T("")},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Forgot Password?"})}),e.jsx("button",{type:"submit",disabled:v,className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white font-semibold rounded-lg transition-colors",children:v?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),l?"Sending Reset Link...":t?"Creating Account...":"Signing In..."]}):e.jsx("span",{children:l?"Send Reset Link":t?"Create Account":"Sign In"})})]}),e.jsx("div",{className:"mt-6 text-center space-y-2",children:l?e.jsx("button",{onClick:()=>{a(!1),N(""),T("")},className:"text-blue-600 hover:text-blue-700 font-medium",children:"Back to Sign In"}):e.jsx("button",{onClick:()=>{s(!t),N(""),T("")},className:"text-blue-600 hover:text-blue-700 font-medium",children:t?"Already have an account? Sign In":"Don't have an account? Sign Up"})})]})})},Zs=()=>{const[t,s]=x.useState(""),[l,a]=x.useState(""),[r,o]=x.useState(""),[m,p]=x.useState(""),[u,w]=x.useState(!1),{setShowPasswordReset:d}=lt(),D=async N=>{if(N.preventDefault(),o(""),p(""),t!==l){o("Passwords do not match");return}if(t.length<6){o("Password must be at least 6 characters");return}w(!0);try{console.log("Attempting to update password...");const{data:P,error:T}=await R.auth.updateUser({password:t});if(console.log("Update response:",{data:P,error:T}),T)throw console.error("Update error:",T),T;console.log("Password updated successfully!"),p("Password updated successfully! Redirecting..."),setTimeout(()=>{d(!1),window.location.href="/"},2e3)}catch(P){console.error("Caught error:",P),o(P.message||"Failed to update password. Please try again."),w(!1)}},H=()=>{d(!1),window.location.href="/"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8",children:[e.jsx("button",{onClick:H,className:"absolute top-4 right-4 p-2 hover:bg-slate-100 rounded-full transition-colors",disabled:u,children:e.jsx("svg",{className:"w-5 h-5 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Reset Your Password"}),e.jsx("p",{className:"text-slate-600 mt-2",children:"Enter your new password below"})]}),r&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",children:[e.jsx("p",{className:"font-medium",children:"Error"}),e.jsx("p",{className:"text-sm mt-1",children:r}),e.jsx("button",{onClick:H,className:"text-sm underline mt-2",children:"Back to login"})]}),m&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4",children:m}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"New Password"}),e.jsx("input",{type:"password",value:t,onChange:N=>s(N.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter new password",required:!0,minLength:6,disabled:u||m}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Minimum 6 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:l,onChange:N=>a(N.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Confirm new password",required:!0,minLength:6,disabled:u||m})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:H,disabled:u,className:"flex-1 px-4 py-3 border border-slate-300 text-slate-700 font-semibold rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u||m,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white font-semibold rounded-lg transition-colors",children:u?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):m?"Redirecting...":"Update Password"})]})]}),u&&e.jsxs("div",{className:"mt-4 text-xs text-slate-500 text-center",children:[e.jsx("p",{children:"If this takes more than 10 seconds, check your internet connection"}),e.jsx("p",{children:"or click Cancel to try again"})]})]})})},Qs=({children:t,requireAdmin:s=!1})=>{const{user:l,loading:a,isAdmin:r,showPasswordReset:o}=lt();return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading..."})]})}):o?e.jsx(Zs,{}):l?s&&!r()?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-8 max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-slate-600",children:"You don't have permission to access this page."})]})}):t:e.jsx(Us,{})};/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),he=(t,s)=>{const l=x.forwardRef(({color:a="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:m,className:p="",children:u,...w},d)=>x.createElement("svg",{ref:d,...Xs,width:r,height:r,stroke:a,strokeWidth:m?Number(o)*24/Number(r):o,className:["lucide",`lucide-${el(t)}`,p].join(" "),...w},[...s.map(([D,H])=>x.createElement(D,H)),...(Array.isArray(u)?u:[u])||[]]));return l.displayName=`${t}`,l};/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=he("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=he("Anchor",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["line",{x1:"12",x2:"12",y1:"22",y2:"8",key:"abakz7"}],["path",{d:"M5 12H2a10 10 0 0 0 20 0h-3",key:"1hv3nh"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=he("Armchair",[["path",{d:"M19 9V6a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v3",key:"irtipd"}],["path",{d:"M3 16a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v2H7v-2a2 2 0 0 0-4 0Z",key:"1e01m0"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ll=he("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=he("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=he("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=he("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=he("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=he("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=he("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=he("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=he("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=he("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const il=he("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=he("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=he("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=he("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=he("Flower2",[["path",{d:"M12 5a3 3 0 1 1 3 3m-3-3a3 3 0 1 0-3 3m3-3v1M9 8a3 3 0 1 0 3 3M9 8h1m5 0a3 3 0 1 1-3 3m3-3h-1m-2 3v-1",key:"3pnvol"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M12 10v12",key:"6ubwww"}],["path",{d:"M12 22c4.2 0 7-1.667 7-5-4.2 0-7 1.667-7 5Z",key:"9hd38g"}],["path",{d:"M12 22c-4.2 0-7-1.667-7-5 4.2 0 7 1.667 7 5Z",key:"ufn41s"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=he("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=he("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=he("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=he("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=he("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=he("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=he("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=he("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=he("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=he("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xl=he("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=he("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=he("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=he("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=he("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=he("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=he("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=he("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=he("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=he("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=he("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=he("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=he("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=he("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=he("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=he("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=he("Tent",[["path",{d:"M3.5 21 14 3",key:"1szst5"}],["path",{d:"M20.5 21 10 3",key:"1310c3"}],["path",{d:"M15.5 21 12 15l-3.5 6",key:"1ddtfw"}],["path",{d:"M2 21h20",key:"1nyx9w"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=he("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=he("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=he("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=he("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=he("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vl=he("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.293.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yl=he("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function jl({users:t,onLogin:s}){const[l,a]=x.useState(""),[r,o]=x.useState(""),[m,p]=x.useState(""),u=w=>{w.preventDefault();const d=t.find(D=>D.username===l&&D.password===r);d?s(d):p("Invalid username or password")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-xl flex items-center justify-center mx-auto mb-4",children:e.jsx(Ne,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Boats By George"}),e.jsx("p",{className:"text-slate-600",children:"Asset Management System"})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Username"}),e.jsx("input",{type:"text",value:l,onChange:w=>a(w.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",value:r,onChange:w=>o(w.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter password",required:!0})]}),m&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm",children:m}),e.jsx("button",{type:"submit",className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors shadow-md",children:"Sign In"}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm",children:[e.jsx("p",{className:"font-semibold text-blue-900 mb-1",children:"Demo Credentials:"}),e.jsxs("p",{className:"text-blue-700",children:["Username: ",e.jsx("span",{className:"font-mono",children:"admin"})]}),e.jsxs("p",{className:"text-blue-700",children:["Password: ",e.jsx("span",{className:"font-mono",children:"admin"})]})]})]})]})})}function at({onMoveBoat:t,onSuccess:s,onError:l}){const[a,r]=x.useState(!1),[o,m]=x.useState(null);return{removeBoat:x.useCallback(async u=>{if(!u||!u.id){const w=new Error("Invalid boat object");m(w),l&&l(w);return}if(!t){const w=new Error("onMoveBoat callback not provided");m(w),l&&l(w);return}r(!0),m(null);try{console.log("[useRemoveBoat] Removing boat:",u.id,"isInventory:",u.isInventory),await t(u.id,null,null,u.isInventory||!1),console.log("[useRemoveBoat] Boat removed successfully"),s&&s(u)}catch(w){console.error("[useRemoveBoat] Error removing boat:",w),m(w),l?l(w):alert(`Failed to remove boat: ${w.message}`)}finally{r(!1)}},[t,s,l]),isRemoving:a,error:o}}function es({operation:t,workOrderId:s,onClose:l}){if(!t)return null;const a=t.opcodeDesc||t.opcode_desc||"",r=t.longDesc||t.long_desc||"",o=t.techDesc||t.tech_desc||"",m=t.managerComments||t.manager_comments||"",p=t.totalCharges??t.total_charges??0,u=t.totalParts??t.total_parts??0,w=t.totalLabor??t.total_labor??0,d=t.totalLaborHours??t.total_labor_hours??0,D=t.totalFreight??t.total_freight??0,H=t.totalEquipment??t.total_equipment??0,N=t.totalSublet??t.total_sublet??0;t.totalMileage??t.total_mileage,t.totalMiscSupply??t.total_misc_supply;const P=t.estimatedCharges??t.estimated_charges??0,T=t.estimatedParts??t.estimated_parts??0,v=t.estimatedLabor??t.estimated_labor??0,I=t.estimatedLaborHours??t.estimated_labor_hours??0,se=t.flagLaborFinished||t.flag_labor_finished,V=t.isOpcodeApproved||t.is_opcode_approved,y=t.laborBilled??t.labor_billed??0,A=t.estStartDate||t.est_start_date,G=t.estCompleteDate||t.est_complete_date,Y=t.reqCompDate||t.req_comp_date,le=t.lastWorkedAt||t.last_worked_at,L=t.standardHours??t.standard_hours??0,W=t.flatRateAmount??t.flat_rate_amount??0,K=t.status==="C",$=!K&&se,g=O=>O==null||O===0?"-":`$${Number(O).toFixed(2)}`,q=O=>O==null||O===0?"-":`${Number(O).toFixed(2)} hrs`,z=O=>O?O.includes("T")?new Date(O).toLocaleString():O:"-";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col animate-slide-in",children:[e.jsxs("div",{className:`bg-gradient-to-r ${K?"from-green-600 to-green-700":$?"from-orange-500 to-orange-600":"from-blue-600 to-blue-700"} text-white p-4 flex-shrink-0`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${K?"bg-green-800":$?"bg-orange-700":"bg-blue-800"}`,children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:t.opcode}),e.jsx("p",{className:"text-sm opacity-90",children:a}),s&&e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:["WO# ",s]})]})]}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-white/20 rounded transition-colors",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 flex-wrap",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${K?"bg-green-800 text-green-100":"bg-yellow-100 text-yellow-800"}`,children:K?"Closed":"Open"}),se&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-800 rounded-full text-xs font-medium",children:"Labor Complete"}),$&&e.jsx("span",{className:"px-2 py-0.5 bg-orange-800 text-orange-100 rounded-full text-xs font-bold",children:"UNBILLED"}),V&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-800 rounded-full text-xs font-medium",children:"Approved"}),t.type&&e.jsxs("span",{className:"px-2 py-0.5 bg-white/20 text-white rounded-full text-xs",children:["Type: ",t.type]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(tt,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-semibold text-slate-800",children:"Financial Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-2",children:"Actual"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Total Charges:"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:g(p)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Parts:"}),e.jsx("span",{className:"text-sm text-slate-900",children:g(u)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Labor:"}),e.jsx("span",{className:"text-sm text-slate-900",children:g(w)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Labor Hours:"}),e.jsx("span",{className:"text-sm text-slate-900",children:q(d)})]}),D>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Freight:"}),e.jsx("span",{className:"text-sm text-slate-900",children:g(D)})]}),N>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Sublet:"}),e.jsx("span",{className:"text-sm text-slate-900",children:g(N)})]}),H>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Equipment:"}),e.jsx("span",{className:"text-sm text-slate-900",children:g(H)})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-2",children:"Estimated"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Total:"}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:g(P)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Parts:"}),e.jsx("span",{className:"text-sm text-slate-900",children:g(T)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Labor:"}),e.jsx("span",{className:"text-sm text-slate-900",children:g(v)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Labor Hours:"}),e.jsx("span",{className:"text-sm text-slate-900",children:q(I)})]}),L>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Standard Hours:"}),e.jsx("span",{className:"text-sm text-slate-900",children:q(L)})]})]})]})]}),(w>0||y>0)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Labor Billed:"}),e.jsxs("span",{className:`text-sm font-semibold ${y>=w?"text-green-600":"text-orange-600"}`,children:[g(y)," / ",g(w)]})]})}),W>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Flat Rate Amount:"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:g(W)})]})})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Kt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-slate-800",children:"Scheduling"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[A&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Est. Start Date"}),e.jsx("p",{className:"text-sm text-slate-900",children:z(A)})]}),G&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Est. Complete Date"}),e.jsx("p",{className:"text-sm text-slate-900",children:z(G)})]})]}),e.jsxs("div",{className:"space-y-2",children:[Y&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Requested Complete Date"}),e.jsx("p",{className:"text-sm text-slate-900",children:z(Y)})]}),le&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Last Worked"}),e.jsx("p",{className:"text-sm text-slate-900 font-medium",children:z(le)})]})]})]}),!A&&!G&&!Y&&!le&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No scheduling information available"})]}),(r||o||m)&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-semibold text-slate-800",children:"Notes & Descriptions"})]}),e.jsxs("div",{className:"space-y-3",children:[r&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap bg-white p-2 rounded border border-slate-100",children:r})]}),o&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-1",children:"Technician Notes"}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap bg-white p-2 rounded border border-slate-100",children:o})]}),m&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 uppercase mb-1",children:"Manager Comments"}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap bg-white p-2 rounded border border-slate-100",children:m})]})]})]}),!r&&!o&&!m&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-slate-400"}),e.jsx("h4",{className:"font-semibold text-slate-600",children:"Notes & Descriptions"})]}),e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No notes or descriptions available for this operation"})]})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 flex-shrink-0",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:l,className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg transition-colors",children:"Close"})})})]})})}function Ct({workOrders:t=[],boatName:s="",boatOwner:l="",lastSynced:a=null,fromCache:r=!1,loading:o=!1,onRefresh:m=null,onClose:p,variant:u="customer"}){const[w,d]=x.useState(null),[D,H]=x.useState(null),N=u==="inventory",P=N?"from-purple-600 to-purple-700":"from-slate-600 to-slate-700",T=N?"hover:bg-purple-500":"hover:bg-slate-500";return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col animate-slide-in",children:[e.jsx("div",{className:`bg-gradient-to-r ${P} text-white p-4 flex-shrink-0`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:N?"Work Orders":"Open Work Orders"}),e.jsxs("p",{className:`text-sm ${N?"text-purple-200":"text-slate-300"}`,children:[s,l&&!N&&` - ${l}`]}),a&&!N&&e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[r?"Cached":"Synced",": ",new Date(a).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&!N&&e.jsxs("button",{onClick:m,disabled:o,className:"flex items-center gap-1 px-3 py-1.5 bg-white/20 hover:bg-white/30 disabled:bg-white/10 text-white text-sm font-medium rounded-lg transition-colors",title:"Refresh from Dockmaster",children:[e.jsx("svg",{className:`w-4 h-4 ${o?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),o?"Syncing...":"Refresh"]}),e.jsx("button",{onClick:p,className:`p-1 ${T} rounded transition-colors`,children:e.jsx(ve,{className:"w-6 h-6"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Oe,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 font-medium",children:N?"No Open Work Orders":"No open work orders found for this boat."}),N?e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"No rigging or prep work orders found for this boat"}):m&&e.jsx("button",{onClick:m,disabled:o,className:"mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white text-sm font-medium rounded-lg transition-colors",children:o?"Checking...":"Check Dockmaster"})]}):e.jsx("div",{className:"space-y-6",children:t.map(v=>e.jsxs("div",{className:"border-2 border-slate-300 rounded-xl overflow-hidden shadow-md bg-white",children:[e.jsxs("div",{className:"bg-gradient-to-r from-slate-100 to-slate-50 p-4 border-b-2 border-slate-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-slate-900 font-mono",children:["WO# ",v.id]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${v.status==="O"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:v.status==="O"?"Open":"Closed"})]}),v.title&&e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:v.title})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-slate-900",children:["$",(v.totalCharges??v.total_charges??0).toFixed(2)]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Total Charges"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-slate-500",children:[e.jsxs("span",{children:["Created: ",v.creationDate]}),v.category&&e.jsxs("span",{children:["Category: ",v.category]})]})]}),v.operations&&v.operations.length>0&&e.jsxs("div",{className:"p-4 bg-slate-50",children:[e.jsxs("p",{className:"text-xs font-medium text-slate-500 uppercase mb-3",children:["Operations (",v.operations.length,")"]}),e.jsx("div",{className:"space-y-2",children:v.operations.map((I,se)=>{const V=I.status==="C",y=I.flagLaborFinished||I.flag_labor_finished,A=!V&&y,G=I.totalCharges??I.total_charges??0,Y=I.opcodeDesc||I.opcode_desc;return e.jsxs("div",{onClick:()=>{d(I),H(v.id)},className:`flex items-center justify-between p-3 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md ${V?"bg-green-50 border-green-200 hover:border-green-400":A?"bg-orange-50 border-orange-300 hover:border-orange-400":"bg-white border-slate-200 hover:border-blue-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0 ${V?"bg-green-500":A?"bg-orange-500":"bg-slate-300"}`,children:V?e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):A?e.jsx(tt,{className:"w-4 h-4 text-white"}):e.jsx("span",{className:"text-xs text-white font-bold",children:se+1})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:Y||I.opcode}),A&&e.jsx("span",{className:"px-2 py-0.5 bg-orange-500 text-white text-xs font-bold rounded uppercase",children:"Unbilled"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[I.opcode,I.type&&` • ${I.type}`," • ",I.status==="O"?"Open":"Closed"]})]})]}),G>0&&e.jsxs("span",{className:"text-sm font-medium text-slate-700 flex-shrink-0 ml-2",children:["$",G.toFixed(2)]})]},I.id||se)})})]})]},v.id))})}),e.jsx("div",{className:"p-4 border-t border-slate-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[N&&a?e.jsxs("p",{className:"text-xs text-slate-500",children:["Data as of ",new Date(a).toLocaleString()]}):N?e.jsx("p",{className:"text-xs text-slate-500",children:"Sync work orders from Inventory page"}):e.jsx("div",{}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg transition-colors",children:"Close"})]})})]}),w&&e.jsx(es,{operation:w,workOrderId:D,onClose:()=>{d(null),H(null)}})]})}function ts({location:t,boats:s=[],inventoryBoats:l=[],mode:a="display",currentBoatId:r=null,onSlotClick:o,viewMode:m="layout",showBoatNames:p=!0,interactive:u=!0}){const w=t.layout==="u-shaped",d=(P,T)=>{var G;const v=`${P}-${T}`,I=(G=t.boats)==null?void 0:G[v],se=I?s.find(Y=>Y.id===I)||l.find(Y=>Y.id===I):null,V=!!I,y=I===r,A=!V||y;if(w&&m==="layout"){const Y=T===0,le=T===t.columns-1,L=P===t.rows-1;if(!Y&&!le&&!L)return e.jsx("div",{className:"aspect-square"},v)}return e.jsxs("button",{onClick:()=>a==="select"&&A&&(o==null?void 0:o(v)),disabled:a==="select"&&!A,className:`
          relative aspect-square flex flex-col items-center justify-center rounded-lg border-2 shadow-sm
          ${y?"border-blue-500 bg-blue-100 shadow-md":""}
          ${V&&!y?"border-slate-300 bg-slate-100 opacity-60 cursor-not-allowed":""}
          ${A&&a==="select"&&u?"border-slate-300 hover:border-blue-400 hover:bg-blue-50 cursor-pointer transition-colors":""}
          ${!A&&a==="display"?"border-blue-300 bg-gradient-to-br from-blue-50 to-blue-100":""}
        `,children:[e.jsxs("span",{className:`text-xs font-medium ${V?"text-slate-600":"text-slate-400"}`,children:[P+1,"-",T+1]}),V&&p&&se&&e.jsx("span",{className:"text-xs text-slate-700 font-semibold truncate max-w-full px-1",children:se.name||se.hullId||se.hull_id})]},v)};if(!w||m==="layout")return e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:`repeat(${t.columns}, minmax(0, 1fr))`},children:Array.from({length:t.rows}).map((P,T)=>Array.from({length:t.columns}).map((v,I)=>d(T,I)))});const D=[],H=[],N=[];for(let P=0;P<t.rows-1;P++)D.push({row:P,col:0});for(let P=0;P<t.columns;P++)H.push({row:t.rows-1,col:P});for(let P=0;P<t.rows-1;P++)N.push({row:P,col:t.columns-1});return e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-xs font-medium text-slate-600 mb-2",children:"Left Arm"}),e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:"1fr"},children:D.map(P=>d(P.row,P.col))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-xs font-medium text-slate-600 mb-2",children:"Bottom"}),e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:`repeat(${t.columns}, 1fr)`},children:H.map(P=>d(P.row,P.col))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-xs font-medium text-slate-600 mb-2",children:"Right Arm"}),e.jsx("div",{className:"grid gap-2",style:{gridTemplateColumns:"1fr"},children:N.map(P=>d(P.row,P.col))})]})]})}const Nl=["fall","winter","spring"],Ot={fall:"Fall",winter:"Winter",spring:"Spring"};function _e(t){return t.storageBoat?t.fallStatus!=="all-work-complete"?"fall":t.winterStatus!=="all-work-complete"?"winter":"spring":null}function kl(t){if(!t.storageBoat)return t.status;const s=_e(t);return t[`${s}Status`]}var rt={};function Sl(t){const l=new Date-t,a=Math.floor(l/6e4),r=Math.floor(l/36e5),o=Math.floor(l/864e5);return a<1?"just now":a<60?`${a}m ago`:r<24?`${r}h ago`:o<7?`${o}d ago`:t.toLocaleDateString()}function nt({status:t,label:s,active:l,onClick:a}){return e.jsx("button",{onClick:a,className:`p-4 rounded-lg border-2 transition-all ${l?`status-${t} border-transparent text-white font-semibold shadow-md`:"border-slate-300 bg-white hover:border-slate-400 text-slate-700"}`,children:s})}function ut({boat:t,onRemove:s,onClose:l,onUpdateBoat:a,onUpdateLocations:r,locations:o=[],sites:m=[],onMoveBoat:p,currentUser:u,boats:w=[],inventoryBoats:d=[]}){const[D,H]=x.useState(!1),[N,P]=x.useState(null),[T,v]=x.useState(null),[I,se]=x.useState("layout"),[V,y]=x.useState(!1),[A,G]=x.useState([]),[Y,le]=x.useState(!1),[L,W]=x.useState(""),[K,$]=x.useState(!1),[g,q]=x.useState(""),[z,O]=x.useState(""),[B,X]=x.useState(!1),[ae,E]=x.useState([]),[ee,oe]=x.useState(!1),[b,Z]=x.useState(t.notes||""),[ue,ge]=x.useState(!1),[xe,ye]=x.useState(t.storageBoat?_e(t):"fall"),U=(c,k)=>{if(Q)return;const F=`${c}${k.charAt(0).toUpperCase()+k.slice(1)}Complete`,te={...t,[F]:!t[F]},me=`${c}Status`;!te[F]&&t[me]==="all-work-complete"&&(te[me]="on-deck"),a(te)},J=x.useCallback(async()=>{if(t!=null&&t.id){oe(!0);try{const c=await Le.boatMovements.getForBoat(t.id,5);E(c)}catch(c){console.error("Error loading movement history:",c)}finally{oe(!1)}}},[t==null?void 0:t.id]);x.useEffect(()=>{J()},[J]);const re={"needs-approval":"Needs Approval","needs-parts":"Needs Parts","parts-kit-pulled":"Parts Kit Pulled","on-deck":"On Deck","all-work-complete":"All Work Complete",archived:"Released"},ie={HA:"On Hand Available",HS:"On Hand Sold",OA:"On Order Available",OS:"On Order Sold",FA:"Future Available",FS:"Future Sold",S:"Sold",R:"Reserved",FP:"Floor Planned"},fe=t.storageBoat?t[`${xe}MechanicalsComplete`]&&t[`${xe}CleanComplete`]&&t[`${xe}FiberglassComplete`]&&t[`${xe}WarrantyComplete`]&&t[`${xe}InvoicedComplete`]:t.mechanicalsComplete&&t.cleanComplete&&t.fiberglassComplete&&t.warrantyComplete&&t.invoicedComplete,Q=t.status==="archived",S=t.isInventory===!0,h=c=>{if(Q)return;const k={...t,[c]:!t[c]};!k[c]&&t.status==="all-work-complete"&&(k.status="on-deck"),a(k)},i=c=>{if(!Q)if(t.storageBoat){if(c==="all-work-complete"&&!fe){alert("Cannot mark as complete! All work phases (Mechanicals, Clean, Fiberglass, Warranty, Invoiced) must be completed first.");return}if(c==="all-work-complete"&&A.length>0&&A.some(me=>me.operations&&me.operations.some(pe=>pe.status!=="C"&&pe.flagLaborFinished))&&!confirm("All work should be invoiced before the boat is marked as complete. Would you like to override?"))return;const k=`${xe}Status`,F={...t,[k]:c};c==="all-work-complete"&&u?(F[`${xe}CompletedBy`]=u.name||u.username,F[`${xe}CompletedAt`]=new Date().toISOString()):c!=="all-work-complete"&&(F[`${xe}CompletedBy`]=null,F[`${xe}CompletedAt`]=null),a(F)}else{if(c==="all-work-complete"&&!fe){alert("Cannot mark as complete! All work phases (Mechanicals, Clean, Fiberglass, Warranty, Invoiced) must be completed first.");return}if(c==="all-work-complete"&&A.length>0&&A.some(te=>te.operations&&te.operations.some(me=>me.status!=="C"&&me.flagLaborFinished))&&!confirm("All work should be invoiced before the boat is marked as complete. Would you like to override?"))return;const k={...t,status:c};c==="all-work-complete"&&u?(k.completedBy=u.name||u.username,k.completedAt=new Date().toISOString()):c!=="all-work-complete"&&(k.completedBy=null,k.completedAt=null),a(k)}},[_,de]=x.useState(null),[ne,ce]=x.useState(!1),be=async()=>{var c;if(!t.id){W("No boat ID available");return}le(!0),W("");try{const{data:k,error:F}=await R.from("work_orders").select(`
          *,
          operations:work_order_operations(*)
        `).eq("boat_id",t.id).eq("status","O").is("rigging_id",null).order("id",{ascending:!0});if(F)throw F;if(G(k||[]),de(((c=k==null?void 0:k[0])==null?void 0:c.last_synced)||null),ce(!0),y(!0),k&&k.length>0){const te=k.map(me=>me.id).filter(Boolean).join(", ");te&&te!==t.workOrderNumber&&a({...t,workOrderNumber:te})}}catch(k){console.error("Error loading work orders from DB:",k),W(k.message)}finally{le(!1)}},j=async()=>{if(!t.customerId&&!t.id){W("No customer ID associated with this boat. Work orders cannot be fetched.");return}le(!0),W("");try{const c=rt.REACT_APP_SUPABASE_URL,k=rt.REACT_APP_SUPABASE_ANON_KEY,F={customerId:String(t.customerId||""),boatId:String(t.dockmasterId||""),boatUuid:String(t.id||""),refresh:!0},te=await fetch(`${c}/functions/v1/dockmaster-workorders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify(F)});if(!te.ok){const pe=await te.json();throw new Error(pe.error||"Failed to fetch work orders")}const me=await te.json();if(G(me.workOrders||[]),de(me.lastSynced),ce(!1),me.workOrders&&me.workOrders.length>0){const pe=me.workOrders.map(je=>je.id).filter(Boolean).join(", ");pe&&a({...t,workOrderNumber:pe})}}catch(c){console.error("Error syncing work orders from API:",c),W(c.message)}finally{le(!1)}},C=async()=>{if(!t.dockmasterId){q("This boat has no Dockmaster ID. It may have been created manually.");return}$(!0),q(""),O("");try{const c=rt.REACT_APP_SUPABASE_URL,k=rt.REACT_APP_SUPABASE_ANON_KEY,F=await fetch(`${c}/functions/v1/dockmaster-retrieve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({boatId:t.dockmasterId})});if(!F.ok){const pe=await F.json();throw new Error(pe.error||"Failed to fetch boat data from Dockmaster")}const te=await F.json();console.log("Updated boat data from Dockmaster:",te);const me={...t,name:te.name||t.name,model:te.model||t.model,make:te.make||t.make,year:te.year||t.year,hullId:te.hin||t.hullId,customerId:te.ownerId||t.customerId};a(me),O("Boat updated successfully from Dockmaster!"),setTimeout(()=>O(""),3e3)}catch(c){console.error("Error updating from Dockmaster:",c),q(c.message)}finally{$(!1)}},M=async()=>{if(!Q){ge(!0);try{const c={...t,notes:b.trim(),notesUpdatedBy:(u==null?void 0:u.name)||(u==null?void 0:u.username)||"Unknown",notesUpdatedAt:new Date().toISOString()};await a(c)}catch(c){console.error("Error saving notes:",c),alert("Failed to save notes. Please try again.")}finally{ge(!1)}}},n=async()=>{if(confirm(`Release ${t.name} back to owner? This will remove it from its current location and archive it. This action cannot be undone.`))try{if(X(!0),(t.location||t.currentLocation)&&s)try{await s()}catch(k){console.error("Error removing boat from location:",k)}const c=await ze.archiveBoat(t.id);await a(c),l()}catch(c){console.error("Error releasing boat:",c),alert(`Failed to release boat: ${c.message}`)}finally{X(!1)}},f=t.storageBoat?t[`${_e(t)}Status`]:t.status;return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 md:p-4 z-[60]",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[95vh] flex flex-col animate-slide-in",children:[e.jsx("div",{className:`status-${f} p-4 md:p-6 rounded-t-xl flex-shrink-0`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-white/20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-white mb-0.5 truncate",children:t.name}),e.jsxs("p",{className:"text-xs md:text-sm text-white/90 truncate",children:[t.model," • ",t.qrCode]})]})]}),e.jsx("button",{onClick:l,className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors flex-shrink-0",children:e.jsx(ve,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-5 overflow-y-auto flex-1",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base md:text-lg font-bold text-slate-900 mb-3",children:"Boat Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 md:gap-3",children:[e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 mb-0.5",children:"Owner"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 truncate",children:t.owner})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 mb-0.5",children:"Status"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 truncate",children:re[t.status]})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg col-span-1 sm:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-600 mb-0.5",children:"Work Order Number"}),e.jsx("input",{type:"text",value:t.workOrderNumber||"",onChange:c=>a({...t,workOrderNumber:c.target.value}),disabled:Q,className:`w-full text-sm font-semibold text-slate-900 bg-transparent border-0 border-b-2 ${Q?"border-slate-200":"border-slate-300 focus:border-blue-500"} px-0 py-1 focus:outline-none focus:ring-0`,placeholder:Q?"N/A":"Enter work order number"})]}),S&&t.salesStatus&&e.jsxs("div",{className:"p-3 bg-blue-50 border-2 border-blue-200 rounded-lg col-span-1 sm:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("svg",{className:"w-3 h-3 text-blue-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("p",{className:"text-xs text-blue-700 font-medium",children:"Sales Status (Inventory)"})]}),e.jsxs("p",{className:"text-sm font-bold text-blue-900",children:[t.salesStatus," - ",ie[t.salesStatus]||t.salesStatus]})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 mb-0.5",children:"Current Location"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 truncate",children:t.location||"Unassigned"}),!Q&&o.length>0&&e.jsx("button",{onClick:()=>H(!0),className:"text-xs text-blue-600 hover:text-blue-800 font-medium whitespace-nowrap",children:t.location?"Move...":"Assign..."})]})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 mb-0.5",children:"Slot"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 truncate",children:t.slot==="pool"?"Pool":t.slot?(()=>{const c=t.slot.split("-");return c.length===2&&!isNaN(c[0])&&!isNaN(c[1])?`${parseInt(c[0])+1}-${parseInt(c[1])+1}`:t.slot})():"N/A"})]}),e.jsxs("div",{className:"p-3 bg-blue-50 border-2 border-blue-200 rounded-lg col-span-1 sm:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-blue-600"}),e.jsx("p",{className:"text-xs text-blue-700 font-medium",children:"Recent Moves"})]}),ee?e.jsx("p",{className:"text-xs text-blue-600",children:"Loading..."}):ae.length>0?e.jsx("div",{className:"space-y-1.5",children:ae.slice(0,3).map((c,k)=>{var Ye;const F=Ie=>{if(!Ie||Ie==="pool")return Ie||"";const Me=Ie.split("-");return Me.length===2&&!isNaN(Me[0])&&!isNaN(Me[1])?`${parseInt(Me[0])+1}-${parseInt(Me[1])+1}`:Ie},te=c.fromLocation?`${c.fromLocation}${c.fromSlot?` (${F(c.fromSlot)})`:""}`:"Unassigned",me=c.toLocation?`${c.toLocation}${c.toSlot?` (${F(c.toSlot)})`:""}`:"Unassigned",pe=new Date(c.movedAt),je=Sl(pe),De=((Ye=c.movedByUser)==null?void 0:Ye.name)||null;return e.jsxs("div",{className:"text-xs text-blue-800 flex items-start gap-1",children:[e.jsx("span",{className:"text-blue-400 flex-shrink-0",children:k===0?"→":"·"}),e.jsxs("span",{className:"truncate",children:[te," → ",me,e.jsxs("span",{className:"text-blue-500 ml-1",children:["(",je,De?` by ${De}`:"",")"]})]})]},c.id||k)})}):e.jsx("p",{className:"text-xs text-blue-600",children:"No movement history yet"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-base md:text-lg font-bold text-slate-900",children:"Notes"}),t.notesUpdatedBy&&t.notesUpdatedAt&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Last updated by ",t.notesUpdatedBy||"Unknown"," on ",t.notesUpdatedAt?new Date(t.notesUpdatedAt).toLocaleDateString():""]})]}),e.jsx("textarea",{value:b,onChange:c=>Z(c.target.value),disabled:Q,placeholder:Q?"No notes":"Add notes about this boat...",rows:4,className:`w-full px-3 py-2 border rounded-lg text-sm resize-y ${Q?"bg-slate-50 border-slate-200 text-slate-600 cursor-not-allowed":"bg-white border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-slate-900"}`}),!Q&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("button",{onClick:M,disabled:ue||b.trim()===(t.notes||""),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors text-sm",children:ue?"Saving...":"Save Note"}),e.jsx("p",{className:"text-xs text-slate-500",children:'Click "Save Note" to record your changes'})]}),Q&&e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Notes are read-only for archived boats"})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-base md:text-lg font-bold text-slate-900",children:"Storage Boat"}),e.jsx("button",{onClick:()=>{if(Q)return;const c={...t,storageBoat:!t.storageBoat};a(c)},disabled:Q,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ${t.storageBoat?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t.storageBoat?"translate-x-6":"translate-x-1"}`})})]})}),t.storageBoat?e.jsxs("div",{children:[e.jsx("h4",{className:"text-base md:text-lg font-bold text-slate-900 mb-3",children:"Seasonal Work Phases"}),e.jsx("div",{className:"flex gap-2 mb-4",children:Nl.map(c=>e.jsx("button",{onClick:()=>ye(c),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${xe===c?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:Ot[c]},c))}),e.jsx("div",{className:"space-y-2",children:["mechanicals","clean","fiberglass","warranty","invoiced"].map(c=>{const k=`${xe}${c.charAt(0).toUpperCase()+c.slice(1)}Complete`,F=t[k];return e.jsxs("button",{onClick:()=>U(xe,c),className:"w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${F?"bg-green-100":"bg-slate-200"}`,children:F?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(ve,{className:"w-5 h-5 text-slate-400"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 truncate capitalize",children:c==="mechanicals"?"Mechanicals":c==="clean"?"Clean":c==="fiberglass"?"Fiberglass":c==="warranty"?"Warranty":"Invoiced"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex-shrink-0 ${F?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:F?"✓":"○"})]},c)})})]}):e.jsxs("div",{children:[e.jsx("h4",{className:"text-base md:text-lg font-bold text-slate-900 mb-1",children:"Work Phases"}),e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Check phases that are complete or not needed. All phases must be verified and billed before marking status as complete."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>h("mechanicalsComplete"),className:"w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${t.mechanicalsComplete?"bg-green-100":"bg-slate-200"}`,children:t.mechanicalsComplete?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(ve,{className:"w-5 h-5 text-slate-400"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 truncate",children:"Mechanicals"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex-shrink-0 ${t.mechanicalsComplete?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:t.mechanicalsComplete?"✓":"○"})]}),e.jsxs("button",{onClick:()=>h("cleanComplete"),className:"w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${t.cleanComplete?"bg-green-100":"bg-slate-200"}`,children:t.cleanComplete?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(ve,{className:"w-5 h-5 text-slate-400"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 truncate",children:"Clean"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex-shrink-0 ${t.cleanComplete?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:t.cleanComplete?"✓":"○"})]}),e.jsxs("button",{onClick:()=>h("fiberglassComplete"),className:"w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${t.fiberglassComplete?"bg-green-100":"bg-slate-200"}`,children:t.fiberglassComplete?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(ve,{className:"w-5 h-5 text-slate-400"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 truncate",children:"Fiberglass"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex-shrink-0 ${t.fiberglassComplete?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:t.fiberglassComplete?"✓":"○"})]}),e.jsxs("button",{onClick:()=>h("warrantyComplete"),className:"w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${t.warrantyComplete?"bg-green-100":"bg-slate-200"}`,children:t.warrantyComplete?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(ve,{className:"w-5 h-5 text-slate-400"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 truncate",children:"Warranty"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex-shrink-0 ${t.warrantyComplete?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:t.warrantyComplete?"✓":"○"})]}),e.jsxs("button",{onClick:()=>h("invoicedComplete"),className:"w-full flex items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center transition-colors flex-shrink-0 ${t.invoicedComplete?"bg-green-100":"bg-slate-200"}`,children:t.invoicedComplete?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx(ve,{className:"w-5 h-5 text-slate-400"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 truncate",children:"Invoiced"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex-shrink-0 ${t.invoicedComplete?"bg-green-100 text-green-700":"bg-slate-200 text-slate-600"}`,children:t.invoicedComplete?"✓":"○"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-slate-900 mb-4",children:["Update Status ",t.storageBoat&&`(${Ot[xe]})`]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(nt,{status:"needs-approval",label:"Needs Approval",active:t.storageBoat?t[`${xe}Status`]==="needs-approval":t.status==="needs-approval",onClick:()=>i("needs-approval")}),e.jsx(nt,{status:"needs-parts",label:"Needs Parts",active:t.storageBoat?t[`${xe}Status`]==="needs-parts":t.status==="needs-parts",onClick:()=>i("needs-parts")}),e.jsx(nt,{status:"parts-kit-pulled",label:"Parts Pulled",active:t.storageBoat?t[`${xe}Status`]==="parts-kit-pulled":t.status==="parts-kit-pulled",onClick:()=>i("parts-kit-pulled")}),e.jsx(nt,{status:"on-deck",label:"On Deck",active:t.storageBoat?t[`${xe}Status`]==="on-deck":t.status==="on-deck",onClick:()=>i("on-deck")}),e.jsxs("button",{onClick:()=>i("all-work-complete"),disabled:!fe,className:`p-4 rounded-lg border-2 transition-all ${(t.storageBoat?t[`${xe}Status`]==="all-work-complete":t.status==="all-work-complete")?"status-all-work-complete border-transparent text-white font-semibold shadow-md":fe?"border-slate-300 bg-white hover:border-slate-400 text-slate-700":"border-slate-200 bg-slate-100 text-slate-400 cursor-not-allowed"}`,title:fe?"":"Complete all work phases first",children:[e.jsx("span",{children:"Complete"}),t.storageBoat?t[`${xe}Status`]==="all-work-complete"&&t[`${xe}CompletedBy`]&&e.jsxs("span",{className:"block text-xs mt-1 opacity-90",children:["by ",t[`${xe}CompletedBy`]]}):t.status==="all-work-complete"&&t.completedBy&&e.jsxs("span",{className:"block text-xs mt-1 opacity-90",children:["by ",t.completedBy]})]})]}),!fe&&e.jsx("p",{className:"text-sm text-orange-600 mt-2",children:"⚠️ All work phases must be completed before marking as complete"}),t.storageBoat?t[`${xe}Status`]==="all-work-complete"&&t[`${xe}CompletedBy`]&&t[`${xe}CompletedAt`]&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["Marked complete by ",t[`${xe}CompletedBy`]," on ",new Date(t[`${xe}CompletedAt`]).toLocaleDateString()]}):t.status==="all-work-complete"&&t.completedBy&&t.completedAt&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["Marked complete by ",t.completedBy," on ",new Date(t.completedAt).toLocaleDateString()]})]}),Q?e.jsxs("div",{className:"space-y-4",children:[t.archivedDate&&e.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Released On"}),e.jsx("p",{className:"font-semibold text-slate-900",children:new Date(t.archivedDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),e.jsx("div",{className:"flex gap-3 pt-4 border-t border-slate-200",children:e.jsx("button",{onClick:l,className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white font-semibold rounded-lg transition-colors",children:"Close"})})]}):e.jsxs("div",{className:"flex flex-col gap-3 pt-4 border-t border-slate-200",children:[!t.isInventory&&t.dockmasterId&&e.jsxs("button",{onClick:C,disabled:K,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 disabled:from-purple-400 disabled:to-purple-500 text-white font-semibold rounded-lg transition-all shadow-md",children:[e.jsx("svg",{className:`w-5 h-5 ${K?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),K?"Updating...":"Update from Dockmaster"]}),g&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:g}),z&&e.jsx("p",{className:"text-sm text-green-600 text-center",children:z}),!t.isInventory&&t.customerId&&e.jsxs("button",{onClick:()=>be(),disabled:Y,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 disabled:from-blue-400 disabled:to-blue-500 text-white font-semibold rounded-lg transition-all shadow-md",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),Y?"Loading Work Orders...":"View Open Work Orders"]}),!t.isInventory&&!t.customerId&&t.dockmasterId&&e.jsx("p",{className:"text-xs text-slate-500 text-center",children:'Click "Update from Dockmaster" to enable Work Orders'}),L&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:L}),e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold rounded-lg transition-all shadow-md",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Release Boat to Owner"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:s,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-red-50 hover:bg-red-100 text-red-600 font-semibold rounded-lg transition-colors",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Remove from Location"]}),e.jsx("button",{onClick:l,className:"flex-1 px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white font-semibold rounded-lg transition-colors",children:"Close"})]})]})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[70]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[80vh] flex flex-col animate-slide-in",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900",children:N?"Select Slot":"Move to Location"}),e.jsx("button",{onClick:()=>{H(!1),P(null),v(null)},className:"p-1 hover:bg-slate-100 rounded",children:e.jsx(ve,{className:"w-5 h-5 text-slate-500"})})]})}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:N?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>P(null),className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(Gt,{className:"w-4 h-4"}),"Back to locations"]}),N.layout==="u-shaped"&&e.jsx("button",{onClick:()=>se(I==="layout"?"concise":"layout"),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:I==="layout"?"Concise View":"Layout View"})]}),e.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Select a slot in ",e.jsx("strong",{children:N.name}),":"]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:e.jsx(ts,{location:N,boats:w,inventoryBoats:d,mode:"select",currentBoatId:t.id,onSlotClick:async c=>{p&&(await p(t,N,c),H(!1),P(null),await J())},viewMode:I,showBoatNames:!0,interactive:!0})})]}):e.jsxs("div",{className:"space-y-3",children:[t.location&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:async()=>{p&&(await p(t,null,null),H(!1),await J())},className:"w-full p-4 text-left rounded-lg border-2 border-red-300 bg-red-50 hover:border-red-400 hover:bg-red-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ve,{className:"w-4 h-4 text-red-600"}),e.jsx("p",{className:"font-bold text-red-900",children:"Remove from Location"})]}),e.jsxs("p",{className:"text-xs text-red-700",children:["Remove boat from ",t.location," and mark as unassigned"]})]}),e.jsx("div",{className:"border-t border-slate-200 my-3"})]}),m.length>0?m.map(c=>{const k=o.filter(F=>F.site_id===c.id);return k.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),e.jsx("span",{className:"text-xs font-semibold text-indigo-700 uppercase tracking-wide",children:c.name}),e.jsx("div",{className:"flex-1 border-t border-indigo-200"})]}),k.filter(F=>F.type==="shop").map(F=>{const te=F.layout==="u-shaped"?F.rows*2+F.columns:F.rows*F.columns,me=Object.keys(F.boats||{}).length,pe=te-me;return e.jsxs("button",{onClick:()=>P(F),disabled:pe===0&&t.location!==F.name,className:`w-full p-3 text-left rounded-lg border-2 transition-colors ml-2 ${t.location===F.name?"border-orange-500 bg-orange-50":pe===0?"border-slate-200 bg-slate-100 opacity-50 cursor-not-allowed":"border-slate-200 hover:border-orange-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:F.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["workshop • ",pe," slots available"]})]},F.id)}),k.filter(F=>F.type==="pool").map(F=>e.jsxs("button",{onClick:async()=>{p&&(await p(t,F,"pool"),H(!1),await J())},className:`w-full p-3 text-left rounded-lg border-2 transition-colors ml-2 ${t.location===F.name?"border-teal-500 bg-teal-50":"border-slate-200 hover:border-teal-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-teal-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:F.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Pool • ",(F.pool_boats||F.poolBoats||[]).length," boats"]})]},F.id)),k.filter(F=>F.type==="rack-building"||F.type==="parking-lot").map(F=>{const te=F.layout==="u-shaped"?F.rows*2+F.columns:F.rows*F.columns,me=Object.keys(F.boats||{}).length,pe=te-me;return e.jsxs("button",{onClick:()=>P(F),disabled:pe===0&&t.location!==F.name,className:`w-full p-3 text-left rounded-lg border-2 transition-colors ml-2 ${t.location===F.name?"border-blue-500 bg-blue-50":pe===0?"border-slate-200 bg-slate-100 opacity-50 cursor-not-allowed":"border-slate-200 hover:border-blue-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${F.type==="rack-building"?"bg-blue-500":F.type==="parking-lot"?"bg-purple-500":"bg-orange-500"}`}),e.jsx("p",{className:"font-semibold text-slate-900",children:F.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[F.type.replace("-"," ")," • ",pe," slots available"]})]},F.id)})]},c.id)}):e.jsxs(e.Fragment,{children:[o.filter(c=>c.type==="shop").map(c=>{const k=c.layout==="u-shaped"?c.rows*2+c.columns:c.rows*c.columns,F=Object.keys(c.boats||{}).length,te=k-F;return e.jsxs("button",{onClick:()=>P(c),disabled:te===0&&t.location!==c.name,className:`w-full p-3 text-left rounded-lg border-2 transition-colors ${t.location===c.name?"border-orange-500 bg-orange-50":te===0?"border-slate-200 bg-slate-100 opacity-50 cursor-not-allowed":"border-slate-200 hover:border-orange-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:c.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["workshop • ",te," slots available"]})]},c.id)}),o.filter(c=>c.type==="pool").map(c=>e.jsxs("button",{onClick:async()=>{p&&(await p(t,c,"pool"),H(!1),await J())},className:`w-full p-3 text-left rounded-lg border-2 transition-colors ${t.location===c.name?"border-teal-500 bg-teal-50":"border-slate-200 hover:border-teal-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-teal-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:c.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Pool • ",(c.pool_boats||c.poolBoats||[]).length," boats"]})]},c.id)),o.filter(c=>c.type==="rack-building"||c.type==="parking-lot").map(c=>{const k=c.layout==="u-shaped"?c.rows*2+c.columns:c.rows*c.columns,F=Object.keys(c.boats||{}).length,te=k-F;return e.jsxs("button",{onClick:()=>P(c),disabled:te===0&&t.location!==c.name,className:`w-full p-3 text-left rounded-lg border-2 transition-colors ${t.location===c.name?"border-blue-500 bg-blue-50":te===0?"border-slate-200 bg-slate-100 opacity-50 cursor-not-allowed":"border-slate-200 hover:border-blue-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${c.type==="rack-building"?"bg-blue-500":"bg-purple-500"}`}),e.jsx("p",{className:"font-semibold text-slate-900",children:c.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[c.type.replace("-"," ")," • ",te," slots available"]})]},c.id)})]}),m.length>0&&(()=>{const c=o.filter(k=>!k.site_id);return c.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-400"}),e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wide",children:"Unassigned"}),e.jsx("div",{className:"flex-1 border-t border-slate-200"})]}),c.map(k=>{const F=k.type==="pool",te=k.layout==="u-shaped"?k.rows*2+k.columns:k.rows*k.columns,me=Object.keys(k.boats||{}).length,pe=te-me;return e.jsxs("button",{onClick:async()=>{F&&p?(await p(t,k,"pool"),H(!1),await J()):P(k)},disabled:!F&&pe===0&&t.location!==k.name,className:`w-full p-3 text-left rounded-lg border-2 transition-colors ml-2 ${t.location===k.name?"border-blue-500 bg-blue-50":!F&&pe===0?"border-slate-200 bg-slate-100 opacity-50 cursor-not-allowed":"border-slate-200 hover:border-blue-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${F?"bg-teal-500":k.type==="rack-building"?"bg-blue-500":k.type==="parking-lot"?"bg-purple-500":"bg-orange-500"}`}),e.jsx("p",{className:"font-semibold text-slate-900",children:k.name})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:F?`Pool • ${(k.pool_boats||k.poolBoats||[]).length} boats`:`${k.type.replace("-"," ")} • ${pe} slots available`})]},k.id)})]})})()]})})]})}),V&&e.jsx(Ct,{workOrders:A,boatName:t.name,boatOwner:t.owner,lastSynced:_,fromCache:ne,loading:Y,onRefresh:()=>j(),onClose:()=>y(!1),variant:"customer"})]})}function ss(t,s=[]){var r,o;let l=t.location?s.find(m=>m.name===t.location):null,a=t.slot;if(!l||!a)for(const m of s){if(m.type==="pool"&&((r=m.pool_boats)!=null&&r.includes(t.id))){l=m,a="pool";break}if(m.boats){const p=Object.keys(m.boats).find(u=>m.boats[u]===t.id);if(p){l=m,a=p;break}}}else l&&!a&&(l.type==="pool"&&((o=l.pool_boats)!=null&&o.includes(t.id))?a="pool":l.boats&&(a=Object.keys(l.boats).find(m=>l.boats[m]===t.id)||null));return{location:l,slotId:a,enrichedBoat:{...t,location:(l==null?void 0:l.name)||t.location,slot:a||t.slot}}}function _t(t,s=[]){if(!t.location)return{location:null,isInPool:!1,displayLocation:"Unassigned",displaySlot:null};const l=s.find(o=>o.name===t.location),a=(l==null?void 0:l.type)==="pool"||t.slot==="pool";let r=t.slot;if(a)r="Pool";else if(t.slot){const o=t.slot.split("-");o.length===2&&!isNaN(o[0])&&!isNaN(o[1])&&(r=`${parseInt(o[0])+1}-${parseInt(o[1])+1}`)}return{location:l,isInPool:a,displayLocation:t.location,displaySlot:r}}function It({location:t,slot:s,className:l=""}){if(!t)return e.jsx("div",{className:`text-xs text-slate-500 ${l}`,children:"Unassigned"});const a=s==="Pool"||s==="pool";return e.jsxs("div",{className:`text-xs ${l}`,children:[e.jsx("span",{className:"font-medium text-slate-700",children:t}),s&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-400 mx-1",children:"•"}),e.jsx("span",{className:a?"text-teal-600":"text-slate-600",children:s})]})]})}function Cl({boat:t,size:s="w-3 h-3",className:l=""}){if(t.isInventory)return null;if(t.storageBoat){const a=_e(t),r=t[`${a}MechanicalsComplete`],o=t[`${a}CleanComplete`],m=t[`${a}FiberglassComplete`],p=t[`${a}WarrantyComplete`];return e.jsxs("div",{className:`flex gap-1 ${l}`,children:[e.jsx(Oe,{className:`${s} ${r?"text-green-500":"text-slate-300"}`,strokeWidth:r?2.5:1.5}),e.jsx(Je,{className:`${s} ${o?"text-green-500":"text-slate-300"}`,strokeWidth:o?2.5:1.5}),e.jsx(Te,{className:`${s} ${m?"text-green-500":"text-slate-300"}`,strokeWidth:m?2.5:1.5}),e.jsx(He,{className:`${s} ${p?"text-green-500":"text-slate-300"}`,strokeWidth:p?2.5:1.5})]})}return e.jsxs("div",{className:`flex gap-1 ${l}`,children:[e.jsx(Oe,{className:`${s} ${t.mechanicalsComplete?"text-green-500":"text-slate-300"}`,strokeWidth:t.mechanicalsComplete?2.5:1.5}),e.jsx(Je,{className:`${s} ${t.cleanComplete?"text-green-500":"text-slate-300"}`,strokeWidth:t.cleanComplete?2.5:1.5}),e.jsx(Te,{className:`${s} ${t.fiberglassComplete?"text-green-500":"text-slate-300"}`,strokeWidth:t.fiberglassComplete?2.5:1.5}),e.jsx(He,{className:`${s} ${t.warrantyComplete?"text-green-500":"text-slate-300"}`,strokeWidth:t.warrantyComplete?2.5:1.5})]})}function _l({boat:t,className:s=""}){return t.isInventory?e.jsxs("div",{className:`flex items-center gap-1 ${s}`,children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-[10px] font-bold",children:t.salesStatus||"INV"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Inventory"})]}):null}function Bl({boat:t,showLocation:s=!1,locations:l=[]}){const{displayLocation:a,displaySlot:r}=_t(t,l);return t.isInventory?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold text-slate-900 text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-slate-600 truncate",children:[t.year," ",t.model]}),e.jsx(_l,{boat:t,className:"mt-2"}),s&&e.jsx(It,{location:a,slot:r,className:"mt-1"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold text-slate-900 text-sm truncate",children:t.owner}),e.jsx("p",{className:"text-xs text-slate-600 truncate",children:t.name}),t.workOrderNumber&&e.jsxs("p",{className:"text-xs text-slate-500 font-mono mt-1",children:["WO: ",t.workOrderNumber]}),e.jsx(Cl,{boat:t,className:"mt-2"}),s&&e.jsx(It,{location:a,slot:r,className:"mt-1"})]})}function Dl({boat:t,onClick:s,showLocation:l=!1,locations:a=[],draggable:r=!1,onDragStart:o,onDragEnd:m,className:p=""}){return e.jsx("div",{draggable:r,onDragStart:o,onDragEnd:m,onClick:()=>s&&s(t),className:`p-3 bg-white rounded-lg border border-slate-200 hover:border-teal-400 hover:shadow-md cursor-pointer transition-all ${p}`,children:e.jsx(Bl,{boat:t,showLocation:l,locations:a})})}function Ll(t){const l=new Date-t,a=Math.floor(l/6e4),r=Math.floor(l/36e5),o=Math.floor(l/864e5);return a<1?"just now":a<60?`${a}m ago`:r<24?`${r}h ago`:o<7?`${o}d ago`:t.toLocaleDateString()}function xt({boat:t,locations:s=[],sites:l=[],boats:a=[],inventoryBoats:r=[],onMoveBoat:o,onUpdateBoat:m,onClose:p,currentUser:u}){var ue,ge,xe,ye,U,J,re,ie,fe,Q;const[w,d]=x.useState(!1),[D,H]=x.useState("layout"),[N,P]=x.useState(null),[T,v]=x.useState(!1),[I,se]=x.useState([]),[V,y]=x.useState(!1),[A,G]=x.useState(""),[Y,le]=x.useState(null),[L,W]=x.useState([]),[K,$]=x.useState(!1),[g,q]=x.useState(t.notes||""),[z,O]=x.useState(!1),B=x.useCallback(async()=>{if(t!=null&&t.id){$(!0);try{const S=await Le.boatMovements.getForBoat(t.id,5);W(S)}catch(S){console.error("Error loading movement history:",S)}finally{$(!1)}}},[t==null?void 0:t.id]);x.useEffect(()=>{B()},[B]);const{enrichedBoat:X}=ss(t,s),ae=async()=>{var S;if(!t.dockmasterId){G("No Dockmaster ID available for this boat");return}y(!0),G("");try{const{data:h,error:i}=await R.from("work_orders").select(`
          *,
          operations:work_order_operations(*)
        `).eq("rigging_id",t.dockmasterId).eq("status","O").order("id",{ascending:!0});if(i)throw i;se(h||[]),le(((S=h==null?void 0:h[0])==null?void 0:S.last_synced)||null),v(!0)}catch(h){console.error("Error loading work orders from DB:",h),G(h.message)}finally{y(!1)}},{displayLocation:E,displaySlot:ee}=_t(X,s),oe={HA:"On Hand Available",HS:"On Hand Sold",OA:"On Order Available",OS:"On Order Sold",FA:"Future Available",FS:"Future Sold",S:"Sold",R:"Reserved",FP:"Floor Planned"},b=async()=>{O(!0);try{const S={...t,notes:g.trim(),notes_updated_by:"User",notes_updated_at:new Date().toISOString()};m&&await m(S)}catch(S){console.error("Error saving notes:",S),alert("Failed to save notes. Please try again.")}finally{O(!1)}},Z=async(S,h)=>{console.log("[InventoryBoatDetailsModal.handleMove] Called with:",{targetLocation:S==null?void 0:S.id,targetSlot:h}),o?(console.log("[InventoryBoatDetailsModal.handleMove] Calling onMoveBoat with boat:",t.id),await o(t,S,h),console.log("[InventoryBoatDetailsModal.handleMove] onMoveBoat complete"),await B()):console.log("[InventoryBoatDetailsModal.handleMove] No onMoveBoat handler!"),d(!1),P(null),S||(console.log("[InventoryBoatDetailsModal.handleMove] Closing modal after removal"),p())};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 rounded text-xs font-medium",children:"INVENTORY"})}),e.jsx("h3",{className:"text-xl font-bold truncate",children:t.name}),e.jsxs("p",{className:"text-blue-100 text-sm truncate",children:[t.year," ",t.make," ",t.model]})]}),e.jsx("button",{onClick:p,className:"p-1 hover:bg-blue-500 rounded transition-colors flex-shrink-0 ml-2",children:e.jsx(ve,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-4 overflow-y-auto flex-1 space-y-4",children:[t.salesStatus&&e.jsxs("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Sales Status"})]}),e.jsx("p",{className:"text-lg font-bold text-blue-900",children:oe[t.salesStatus]||t.salesStatus}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Code: ",t.salesStatus]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Hull ID"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 font-mono",children:t.hullId||t.hull_id||"N/A"})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Stock #"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 font-mono",children:t.stockNumber||t.stock_number||"N/A"})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Color"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:t.color||"N/A"})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-0.5",children:"Dockmaster ID"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900 font-mono",children:t.dockmasterId||t.dockmaster_id||"N/A"})]})]}),(()=>{const S=t.listPrice||t.list_price,h=t.totalCost||t.total_cost,i=(u==null?void 0:u.role)==="admin"||(u==null?void 0:u.role)==="manager";return S||h&&i?e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"Pricing"}),e.jsxs("div",{className:`grid ${S&&h&&i?"grid-cols-2":"grid-cols-1"} gap-3`,children:[S&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600",children:"List Price"}),e.jsxs("p",{className:"text-lg font-bold text-green-900",children:["$",Number(t.listPrice||t.list_price).toLocaleString()]})]}),h&&i&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600",children:"Total Cost"}),e.jsxs("p",{className:"text-lg font-bold text-green-900",children:["$",Number(t.totalCost||t.total_cost).toLocaleString()]})]})]})]}):null})(),(()=>{const S=[{label:"Length",value:t.length},{label:"Beam",value:t.beam},{label:"Draft",value:t.draft},{label:"Weight",value:t.weight},{label:"Hull",value:t.hullType||t.hull_type},{label:"Material",value:t.hullMaterial||t.hull_material},{label:"Fuel Cap.",value:t.fuelCapacity||t.fuel_capacity},{label:"Max HP",value:t.motorRating||t.motor_rating}].filter(h=>h.value);return S.length===0?null:e.jsx("div",{className:"p-3 bg-slate-50 rounded-xl",children:e.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:S.map((h,i)=>e.jsxs("span",{className:"text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:[h.label,":"]})," ",e.jsx("span",{className:"font-medium text-slate-900",children:h.value})]},i))})})})(),(((ue=t.motors)==null?void 0:ue.length)>0||((ge=t.trailers)==null?void 0:ge.length)>0)&&e.jsxs("div",{className:`grid ${((xe=t.motors)==null?void 0:xe.length)>0&&((ye=t.trailers)==null?void 0:ye.length)>0?"grid-cols-2":"grid-cols-1"} gap-3`,children:[((U=t.motors)==null?void 0:U.length)>0&&e.jsxs("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("h4",{className:"text-sm font-semibold text-orange-800",children:t.motors.length>1?`${t.motors.length} Engines`:"Engine"})]}),e.jsx("div",{className:"space-y-2",children:t.motors.map((S,h)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium text-slate-900",children:[S.vendorName," ",S.modelNumber,S.horsePower&&e.jsxs("span",{className:"ml-1 px-1.5 py-0.5 bg-orange-100 text-orange-700 text-xs font-semibold rounded",children:[S.horsePower," HP"]})]}),e.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:[S.year&&`${S.year}`,S.serialNumber&&`S/N: ${S.serialNumber}`,S.shaftLength&&`${S.shaftLength} shaft`].filter(Boolean).join(" | ")})]},S.id||h))})]}),((J=t.trailers)==null?void 0:J.length)>0&&e.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),e.jsx("h4",{className:"text-sm font-semibold text-purple-800",children:t.trailers.length>1?`${t.trailers.length} Trailers`:"Trailer"})]}),e.jsx("div",{className:"space-y-2",children:t.trailers.map((S,h)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium text-slate-900",children:[S.vendorName," ",S.modelNumber]}),e.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:[S.year&&`${S.year}`,S.serialNumber&&`S/N: ${S.serialNumber}`,S.weightCapacity&&`Cap: ${S.weightCapacity}`].filter(Boolean).join(" | ")})]},S.id||h))})]})]}),(((re=t.options)==null?void 0:re.length)>0||((ie=t.accessories)==null?void 0:ie.length)>0)&&e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl space-y-3",children:[((fe=t.options)==null?void 0:fe.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wide mb-2",children:["Options (",t.options.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.options.slice(0,8).map((S,h)=>e.jsx("span",{className:"px-2 py-1 bg-white border border-slate-200 rounded text-xs text-slate-700",children:S.desc||S.optionCode},S.optionCode||h)),t.options.length>8&&e.jsxs("span",{className:"px-2 py-1 bg-slate-100 rounded text-xs text-slate-500 font-medium",children:["+",t.options.length-8," more"]})]})]}),((Q=t.accessories)==null?void 0:Q.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wide mb-2",children:["Accessories (",t.accessories.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.accessories.slice(0,8).map((S,h)=>e.jsxs("span",{className:"px-2 py-1 bg-white border border-slate-200 rounded text-xs text-slate-700",children:[S.desc||S.accCode,S.qty>1&&e.jsxs("span",{className:"text-slate-400 ml-1",children:["x",S.qty]})]},S.accCode||h)),t.accessories.length>8&&e.jsxs("span",{className:"px-2 py-1 bg-slate-100 rounded text-xs text-slate-500 font-medium",children:["+",t.accessories.length-8," more"]})]})]})]}),t.comments&&e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),e.jsx("h4",{className:"text-sm font-medium text-amber-800",children:"Dockmaster Comments"})]}),e.jsx("p",{className:"text-sm text-amber-900 whitespace-pre-wrap",children:t.comments})]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-700",children:"Notes"}),t.notes_updated_by&&t.notes_updated_at&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Updated by ",t.notes_updated_by," on ",new Date(t.notes_updated_at).toLocaleDateString()]})]}),e.jsx("textarea",{value:g,onChange:S=>q(S.target.value),placeholder:"Add notes about this inventory boat...",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg text-sm resize-y bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-slate-900"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("button",{onClick:b,disabled:z||g.trim()===(t.notes||""),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors text-sm",children:z?"Saving...":"Save Note"}),e.jsx("p",{className:"text-xs text-slate-400",children:'Click "Save Note" to record your changes'})]})]}),e.jsx("div",{className:"p-4 bg-slate-50 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Current Location"}),e.jsx("p",{className:"text-lg font-bold text-slate-900",children:X.location?e.jsxs(e.Fragment,{children:[E,ee&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-400 mx-2",children:"•"}),ee]})]}):"Unassigned"})]}),s.length>0&&e.jsx("button",{onClick:()=>d(!0),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:X.location?"Move":"Assign"})]})}),e.jsxs("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-blue-600"}),e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Recent Moves"})]}),K?e.jsx("p",{className:"text-xs text-blue-600",children:"Loading..."}):L.length>0?e.jsx("div",{className:"space-y-1.5",children:L.slice(0,3).map((S,h)=>{var j;const i=C=>{if(!C||C==="pool")return C||"";const M=C.split("-");return M.length===2&&!isNaN(M[0])&&!isNaN(M[1])?`${parseInt(M[0])+1}-${parseInt(M[1])+1}`:C},_=S.fromLocation?`${S.fromLocation}${S.fromSlot?` (${i(S.fromSlot)})`:""}`:"Unassigned",de=S.toLocation?`${S.toLocation}${S.toSlot?` (${i(S.toSlot)})`:""}`:"Unassigned",ne=new Date(S.movedAt),ce=Ll(ne),be=((j=S.movedByUser)==null?void 0:j.name)||null;return e.jsxs("div",{className:"text-xs text-blue-800 flex items-start gap-1",children:[e.jsx("span",{className:"text-blue-400 flex-shrink-0",children:h===0?"→":"·"}),e.jsxs("span",{className:"truncate",children:[_," → ",de,e.jsxs("span",{className:"text-blue-500 ml-1",children:["(",ce,be?` by ${be}`:"",")"]})]})]},S.id||h)})}):e.jsx("p",{className:"text-xs text-blue-600",children:"No movement history yet"})]}),t.dockmasterId&&e.jsx("button",{onClick:ae,disabled:V,className:"w-full p-4 bg-purple-50 hover:bg-purple-100 border-2 border-purple-200 hover:border-purple-300 rounded-xl transition-colors text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-purple-900",children:"View Work Orders"}),e.jsx("p",{className:"text-xs text-purple-600",children:"Rigging & prep work orders"})]})]}),V?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-purple-600"}):e.jsx(St,{className:"w-5 h-5 text-purple-400"})]})}),A&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:A})}),e.jsxs("div",{className:"text-xs text-slate-400 text-center",children:[e.jsxs("p",{children:["Last synced: ",t.lastSynced?new Date(t.lastSynced).toLocaleString():"Unknown"]}),e.jsx("p",{className:"mt-1",children:"Data synced from Dockmaster • Read-only"})]})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 flex-shrink-0",children:e.jsx("button",{onClick:p,className:"w-full px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg transition-colors",children:"Close"})})]}),T&&e.jsx(Ct,{workOrders:I,boatName:t.name,lastSynced:Y,onClose:()=>v(!1),variant:"inventory"}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:N?"Select Slot":"Select Location"}),e.jsx("p",{className:"text-xs text-slate-500",children:N?`in ${N.name}`:"Choose where to place this boat"})]}),e.jsx("button",{onClick:()=>{d(!1),P(null)},className:"p-1 hover:bg-slate-100 rounded",children:e.jsx(ve,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:N?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>P(null),className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to locations"]}),N.layout==="u-shaped"&&e.jsx("button",{onClick:()=>H(D==="layout"?"concise":"layout"),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:D==="layout"?"Concise View":"Layout View"})]}),e.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Select a slot in ",e.jsx("strong",{children:N.name}),":"]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:e.jsx(ts,{location:N,boats:a,inventoryBoats:r,mode:"select",currentBoatId:t.id,onSlotClick:S=>Z(N,S),viewMode:D,showBoatNames:!0,interactive:!0})})]}):e.jsxs("div",{className:"space-y-2",children:[X.location&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Z(null,null),className:"w-full p-4 text-left rounded-lg border-2 border-red-300 bg-red-50 hover:border-red-400 hover:bg-red-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ve,{className:"w-4 h-4 text-red-600"}),e.jsx("p",{className:"font-bold text-red-900",children:"Remove from Location"})]}),e.jsxs("p",{className:"text-xs text-red-700",children:["Remove boat from ",X.location," and mark as unassigned"]})]}),e.jsx("div",{className:"border-t border-slate-200 my-3"})]}),l.length>0?l.map(S=>{const h=s.filter(ne=>ne.site_id===S.id);if(h.length===0)return null;const i=h.filter(ne=>ne.type==="shop"),_=h.filter(ne=>ne.type==="pool"),de=h.filter(ne=>ne.type==="rack-building"||ne.type==="parking-lot");return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-1 border-b border-indigo-200",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),e.jsx("p",{className:"text-sm font-semibold text-indigo-700",children:S.name})]}),e.jsxs("div",{className:"space-y-2 pl-2",children:[i.map(ne=>e.jsxs("button",{onClick:()=>P(ne),className:"w-full p-3 text-left rounded-lg border-2 border-slate-200 hover:border-orange-300 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:ne.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Workshop • ",Object.keys(ne.boats||{}).length," boats"]})]},ne.id)),_.map(ne=>e.jsxs("button",{onClick:()=>Z(ne,"pool"),className:"w-full p-3 text-left rounded-lg border-2 border-slate-200 hover:border-teal-300 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-teal-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:ne.name})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Pool location"})]},ne.id)),de.map(ne=>e.jsxs("button",{onClick:()=>P(ne),className:"w-full p-3 text-left rounded-lg border-2 border-slate-200 hover:border-blue-300 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${ne.type==="rack-building"?"bg-blue-500":"bg-purple-500"}`}),e.jsx("p",{className:"font-semibold text-slate-900",children:ne.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[ne.type.replace("-"," ")," • ",Object.keys(ne.boats||{}).length," boats"]})]},ne.id))]})]},S.id)}):e.jsxs(e.Fragment,{children:[s.filter(S=>S.type==="shop").map(S=>e.jsxs("button",{onClick:()=>P(S),className:"w-full p-3 text-left rounded-lg border-2 border-slate-200 hover:border-orange-300 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:S.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Workshop • ",Object.keys(S.boats||{}).length," boats"]})]},S.id)),s.filter(S=>S.type==="pool").map(S=>e.jsxs("button",{onClick:()=>Z(S,"pool"),className:"w-full p-3 text-left rounded-lg border-2 border-slate-200 hover:border-teal-300 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-teal-500"}),e.jsx("p",{className:"font-semibold text-slate-900",children:S.name})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Pool location"})]},S.id)),s.filter(S=>S.type==="rack-building"||S.type==="parking-lot").map(S=>e.jsxs("button",{onClick:()=>P(S),className:"w-full p-3 text-left rounded-lg border-2 border-slate-200 hover:border-blue-300 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${S.type==="rack-building"?"bg-blue-500":"bg-purple-500"}`}),e.jsx("p",{className:"font-semibold text-slate-900",children:S.name})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[S.type.replace("-"," ")," • ",Object.keys(S.boats||{}).length," boats"]})]},S.id))]})]})})]})})]})}function $e({icon:t,label:s,active:l,onClick:a}){return e.jsxs("button",{onClick:a,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${l?"bg-blue-100 text-blue-700":"text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:s})]})}function Re({title:t,value:s,subtitle:l,icon:a,color:r,onClick:o}){const m={blue:"from-blue-500 to-blue-600",purple:"from-purple-500 to-purple-600",orange:"from-orange-500 to-orange-600",green:"from-green-500 to-green-600"};return e.jsxs("div",{onClick:o,className:`bg-white rounded-xl shadow-md p-6 border border-slate-200 ${o?"cursor-pointer hover:shadow-lg transition-all":""}`,children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${m[r]} rounded-lg flex items-center justify-center mb-4`,children:e.jsx(a,{className:"w-6 h-6 text-white"})}),e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:t}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:s}),l&&e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:l})]})}function Ze({status:t,count:s,label:l}){return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`status-${t} h-24 rounded-lg flex items-center justify-center mb-2 shadow-sm`,children:e.jsx("span",{className:"text-4xl font-bold text-white",children:s})}),e.jsx("p",{className:"text-sm font-medium text-slate-700",children:l})]})}function ls({boat:t,onEdit:s,onDelete:l,compact:a}){const r={"needs-approval":"Needs Approval","needs-parts":"Needs Parts","parts-kit-pulled":"Parts Kit Pulled","on-deck":"On Deck","all-work-complete":"All Work Complete",archived:"Released"};return e.jsxs("div",{className:"boat-card bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden",children:[t.storageBoat?(()=>{const o=_e(t),m=t.fallStatus==="all-work-complete"&&t.winterStatus==="all-work-complete"&&t.springStatus==="all-work-complete",p=m?"flex-[1]":o==="fall"?"flex-[2]":"flex-[1]",u=m?"flex-[1]":o==="winter"?"flex-[2]":"flex-[1]",w=m?"flex-[1]":o==="spring"?"flex-[2]":"flex-[1]",d=o!=="fall"&&!m?"opacity-70":"",D=o!=="winter"&&!m?"opacity-70":"",H=o!=="spring"&&!m?"opacity-70":"";return e.jsxs("div",{className:"flex h-12",children:[e.jsx("div",{className:`status-${t.fallStatus} ${p} ${d} border-r border-white/20`}),e.jsx("div",{className:`status-${t.winterStatus} ${u} ${D} border-r border-white/20`}),e.jsx("div",{className:`status-${t.springStatus} ${w} ${H}`})]})})():e.jsx("div",{className:`status-${t.status} p-3`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:r[t.status]}),e.jsx("span",{className:"text-white text-xs opacity-90",children:t.qrCode})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-1",children:t.name}),e.jsx("p",{className:"text-slate-600 text-sm mb-3",children:t.model}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Xt,{className:"w-4 h-4"}),e.jsx("span",{children:t.owner})]}),t.location&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.location," (",t.slot,")"]})]}),t.nfcTag&&e.jsxs("div",{className:"flex items-center gap-2 text-purple-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"font-mono font-semibold",children:t.nfcTag})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-200",children:[e.jsx("div",{className:"flex gap-2 text-xs",children:t.storageBoat?e.jsx(e.Fragment,{children:(()=>{const o=_e(t);return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t[`${o}MechanicalsComplete`]||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t[`${o}MechanicalsComplete`]?"text-green-600 font-medium":"text-slate-500",children:"Mech"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t[`${o}CleanComplete`]||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t[`${o}CleanComplete`]?"text-green-600 font-medium":"text-slate-500",children:"Clean"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t[`${o}FiberglassComplete`]||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t[`${o}FiberglassComplete`]?"text-green-600 font-medium":"text-slate-500",children:"Fiber"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t[`${o}WarrantyComplete`]||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t[`${o}WarrantyComplete`]?"text-green-600 font-medium":"text-slate-500",children:"Warr"})]})]})})()}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t.mechanicalsComplete||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t.mechanicalsComplete?"text-green-600 font-medium":"text-slate-500",children:"Mech"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t.cleanComplete||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t.cleanComplete?"text-green-600 font-medium":"text-slate-500",children:"Clean"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t.fiberglassComplete||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t.fiberglassComplete?"text-green-600 font-medium":"text-slate-500",children:"Fiber"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:t.warrantyComplete||!1,readOnly:!0,className:"w-3 h-3 rounded pointer-events-none"}),e.jsx("span",{className:t.warrantyComplete?"text-green-600 font-medium":"text-slate-500",children:"Warr"})]})]})}),t.storageBoat?(()=>{const o=_e(t),m=t[`${o}MechanicalsComplete`],p=t[`${o}CleanComplete`],u=t[`${o}FiberglassComplete`],w=t[`${o}WarrantyComplete`];return(!m||!p||!u||!w)&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[!m&&e.jsx("span",{className:"px-2 py-0.5 bg-orange-100 text-orange-700 text-[10px] font-medium rounded-full",children:"Needs Mech"}),!p&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-medium rounded-full",children:"Needs Clean"}),!u&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 text-[10px] font-medium rounded-full",children:"Needs Fiber"}),!w&&e.jsx("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-[10px] font-medium rounded-full",children:"Needs Warr"})]})})():(!t.mechanicalsComplete||!t.cleanComplete||!t.fiberglassComplete||!t.warrantyComplete)&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[!t.mechanicalsComplete&&e.jsx("span",{className:"px-2 py-0.5 bg-orange-100 text-orange-700 text-[10px] font-medium rounded-full",children:"Needs Mech"}),!t.cleanComplete&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-medium rounded-full",children:"Needs Clean"}),!t.fiberglassComplete&&e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 text-[10px] font-medium rounded-full",children:"Needs Fiber"}),!t.warrantyComplete&&e.jsx("span",{className:"px-2 py-0.5 bg-teal-100 text-teal-700 text-[10px] font-medium rounded-full",children:"Needs Warr"})]})]}),!a&&e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t border-slate-200",children:[e.jsxs("button",{onClick:s,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium rounded-lg transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4"}),"View Details"]}),e.jsxs("button",{onClick:l,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-red-50 hover:bg-red-100 text-red-600 font-medium rounded-lg transition-colors",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Delete"]})]})]})]})}function Al({boats:t,locations:s,sites:l=[],onNavigate:a,onUpdateBoats:r,onUpdateLocations:o,onMoveBoat:m,currentUser:p}){const[u,w]=x.useState(null),{removeBoat:d}=at({onMoveBoat:m,onSuccess:()=>w(null)});x.useEffect(()=>{if(u){const y=t.find(A=>A.id===u.id);y&&JSON.stringify(y)!==JSON.stringify(u)&&w({...y,currentLocation:u.currentLocation,currentSlot:u.currentSlot})}},[t]);const D={needsApproval:t.filter(y=>y.status==="needs-approval").length,needsParts:t.filter(y=>y.status==="needs-parts").length,partsKitPulled:t.filter(y=>y.status==="parts-kit-pulled").length,onDeck:t.filter(y=>y.status==="on-deck").length,allWorkComplete:t.filter(y=>y.status==="all-work-complete").length},H=t.filter(y=>y.status!=="archived").length,N=s.length,P=s.reduce((y,A)=>{if(A.type==="pool")return y;const G=A.layout==="u-shaped";return y+(G?A.rows*2+A.columns:A.rows*A.columns)},0),T=s.reduce((y,A)=>A.type==="pool"?y+(A.pool_boats||A.poolBoats||[]).length:y+Object.keys(A.boats||{}).length,0),v=P>0?Math.round(T/P*100):0,I=y=>{const A=y.location?s.find(Y=>Y.name===y.location):null,G=A?Object.keys(A.boats||{}).find(Y=>A.boats[Y]===y.id):null;w({...y,currentLocation:A,currentSlot:G||((A==null?void 0:A.type)==="pool"?"pool":null)})},se=y=>{r(t.map(A=>A.id===y.id?y:A)),w(y)},V=async(y,A,G)=>{if(y.isInventory&&m){try{await m(y.id,(A==null?void 0:A.id)||null,G||null,!0),w(A?{...y,location:A.name,slot:G,currentLocation:A,currentSlot:G}:null)}catch(W){console.error("Error moving inventory boat:",W),alert("Failed to move boat. Please try again.")}return}let Y=[...s];if(y.location){const W=s.find(K=>K.name===y.location);if(W)if(W.type==="pool"){const K=W.pool_boats||W.poolBoats||[],$={...W,pool_boats:K.filter(g=>g!==y.id)};Y=Y.map(g=>g.id===W.id?$:g)}else{const K={...W,boats:{...W.boats}},$=Object.keys(K.boats).find(g=>K.boats[g]===y.id);$&&delete K.boats[$],Y=Y.map(g=>g.id===W.id?K:g)}}let le={...y};if(A)if(A.type==="pool"){const W=A.pool_boats||A.poolBoats||[],K={...A,pool_boats:[...W,y.id]};Y=Y.map($=>$.id===A.id?K:$),le.location=A.name,le.slot="pool"}else{const W=Y.find(q=>q.id===A.id),K={...W,boats:{...W.boats,[G]:y.id}};Y=Y.map(q=>q.id===A.id?K:q);const[$,g]=G.split("-").map(Number);le.location=A.name,le.slot=`${$+1}-${g+1}`}else le.location=null,le.slot=null;await o(Y),r(t.map(W=>W.id===y.id?le:W));const L=A?Y.find(W=>W.id===A.id):null;w({...le,currentLocation:L,currentSlot:G})};return e.jsxs("div",{className:"space-y-8 animate-slide-in",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-slate-600",children:"Overview of your boat management system"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Re,{title:"Total Boats",value:H,icon:Ne,color:"blue",onClick:()=>a("boats")}),e.jsx(Re,{title:"Storage Locations",value:N,icon:Ae,color:"purple",onClick:()=>a("locations")}),e.jsx(Re,{title:"Occupancy Rate",value:`${v}%`,subtitle:`${T} / ${P} slots`,icon:dt,color:"orange",onClick:()=>a("locations")}),e.jsx(Re,{title:"Work Complete",value:D.allWorkComplete,icon:Ne,color:"green"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-slate-200",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-6",children:"Boat Status Overview"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(Ze,{status:"needs-approval",count:D.needsApproval,label:"Needs Approval"}),e.jsx(Ze,{status:"needs-parts",count:D.needsParts,label:"Needs Parts"}),e.jsx(Ze,{status:"parts-kit-pulled",count:D.partsKitPulled,label:"Parts Kit Pulled"}),e.jsx(Ze,{status:"on-deck",count:D.onDeck,label:"On Deck"}),e.jsx(Ze,{status:"all-work-complete",count:D.allWorkComplete,label:"All Work Complete"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Recent Boats"}),e.jsxs("button",{onClick:()=>a("boats"),className:"text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center gap-1",children:["View All",e.jsx(St,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.slice(0,6).map(y=>e.jsx("div",{onClick:()=>I(y),className:"cursor-pointer hover:scale-[1.02] transition-transform",children:e.jsx(ls,{boat:y,onEdit:()=>{},onDelete:()=>{},compact:!0})},y.id))})]}),u&&u.isInventory&&e.jsx(xt,{boat:u,locations:s,sites:l,boats:t.filter(y=>!y.isInventory),inventoryBoats:t.filter(y=>y.isInventory),onMoveBoat:V,onUpdateBoat:se,onClose:()=>w(null)}),u&&!u.isInventory&&e.jsx(ut,{boat:u,locations:s,sites:l,boats:t.filter(y=>!y.isInventory),inventoryBoats:t.filter(y=>y.isInventory),onRemove:()=>d(u),onUpdateBoat:se,onMoveBoat:V,onClose:()=>w(null),currentUser:p})]})}function as({boat:t,locations:s,onSave:l,onCancel:a}){const[r,o]=x.useState(t||{name:"",model:"",owner:"",status:"needs-approval",location:"",slot:"",workOrderNumber:"",mechanicalsComplete:!1,cleanComplete:!1,fiberglassComplete:!1,warrantyComplete:!1}),m=r.mechanicalsComplete&&r.cleanComplete&&r.fiberglassComplete&&r.warrantyComplete,p=w=>{if(w.preventDefault(),r.status==="all-work-complete"&&!m){alert("Cannot mark as complete! All work phases (Mechanicals, Clean, Fiberglass, Warranty) must be completed first.");return}l(r)},u=w=>{if(w==="all-work-complete"&&!m){alert("Cannot mark as complete! All work phases (Mechanicals, Clean, Fiberglass) must be completed first.");return}o({...r,status:w})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 animate-slide-in max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:t?"Edit Boat":"Add New Boat"}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-slate-100 rounded transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Boat Name"}),e.jsx("input",{type:"text",value:r.name,onChange:w=>o({...r,name:w.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Sea Ray Sundancer",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Model"}),e.jsx("input",{type:"text",value:r.model,onChange:w=>o({...r,model:w.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 320 Sundancer",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Owner"}),e.jsx("input",{type:"text",value:r.owner,onChange:w=>o({...r,owner:w.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Owner name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Work Order Number"}),e.jsx("input",{type:"text",value:r.workOrderNumber||"",onChange:w=>o({...r,workOrderNumber:w.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., WO-12345"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Optional: Track work order associated with this boat"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Status"}),e.jsxs("select",{value:r.status,onChange:w=>u(w.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"needs-approval",children:"Needs Approval"}),e.jsx("option",{value:"needs-parts",children:"Needs Parts"}),e.jsx("option",{value:"parts-kit-pulled",children:"Parts Kit Pulled"}),e.jsx("option",{value:"on-deck",children:"On Deck"}),e.jsxs("option",{value:"all-work-complete",disabled:!m,children:["All Work Complete ",m?"":"(requires all phases)"]})]}),!m&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:'Complete all work phases to enable "All Work Complete" status'})]}),e.jsxs("div",{className:"border-t border-slate-200 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Work Phases"}),e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Check phases that are complete or not needed. All phases must be verified and billed before marking status as complete."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.mechanicalsComplete||!1,onChange:w=>{const d={...r,mechanicalsComplete:w.target.checked};!w.target.checked&&r.status==="all-work-complete"&&(d.status="on-deck"),o(d)},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:"Mechanicals Complete"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.cleanComplete||!1,onChange:w=>{const d={...r,cleanComplete:w.target.checked};!w.target.checked&&r.status==="all-work-complete"&&(d.status="on-deck"),o(d)},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:"Clean Complete"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.fiberglassComplete||!1,onChange:w=>{const d={...r,fiberglassComplete:w.target.checked};!w.target.checked&&r.status==="all-work-complete"&&(d.status="on-deck"),o(d)},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:"Fiberglass Complete"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.warrantyComplete||!1,onChange:w=>{const d={...r,warrantyComplete:w.target.checked};!w.target.checked&&r.status==="all-work-complete"&&(d.status="on-deck"),o(d)},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:"Warranty Complete"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:t?"Save Changes":"Add Boat"})]})]})]})})}var ot={};function rs({dockmasterConfig:t,onImport:s,onCancel:l}){const[a,r]=x.useState(""),[o,m]=x.useState([]),[p,u]=x.useState(!1),[w,d]=x.useState(!1),[D,H]=x.useState(""),N=async T=>{if(T.preventDefault(),!!a.trim()){u(!0),H("");try{const v=ot.REACT_APP_SUPABASE_URL,I=ot.REACT_APP_SUPABASE_ANON_KEY;if(console.log("Environment check:"),console.log("- VITE_SUPABASE_URL:",void 0),console.log("- supabaseUrl:",v),console.log("- Has anon key:",!!I),!v||!I)throw new Error("Supabase environment variables not configured. Check your .env file.");const se=`${v}/functions/v1/dockmaster-search`;console.log("Searching via Edge Function:",se);const V=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${I}`},body:JSON.stringify({searchString:a})});if(console.log("Search response status:",V.status),!V.ok){const G=await V.json();throw console.error("Search error response:",G),new Error(G.error||`Search failed: ${V.status}`)}const y=await V.json();console.log("Search results:",y);const A=Array.isArray(y)?y:y?[y]:[];console.log("Processed results:",A),m(A)}catch(v){console.error("Error searching boats:",v),H(v.message||"Failed to search boats. Please check your credentials and try again.")}finally{u(!1)}}},P=async(T,v,I)=>{d(!0),H("");try{const se=ot.REACT_APP_SUPABASE_URL,V=ot.REACT_APP_SUPABASE_ANON_KEY,y=`${se}/functions/v1/dockmaster-retrieve`;console.log("Retrieving boat via Edge Function:",T);const A=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V}`},body:JSON.stringify({boatId:T})});if(!A.ok){const le=await A.json();throw console.error("Retrieve error response:",le),new Error(le.error||`Failed to retrieve boat: ${A.status}`)}const G=await A.json();console.log("Retrieved boat data:",G);const Y={name:G.name||"Unknown",model:G.model||"",make:G.make||"",year:G.year||"",owner:(v||"Unknown").trim(),dockmasterId:T,customerId:I||G.ownerId||"",hullId:G.hin||"",status:"needs-approval",mechanicalsComplete:!1,cleanComplete:!1,fiberglassComplete:!1,warrantyComplete:!1,workOrderNumber:""};s(Y),l()}catch(se){console.error("Error importing boat:",se),H(se.message||"Failed to import boat. Please try again.")}finally{d(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[85vh] flex flex-col animate-slide-in",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Import Boat from Dockmaster"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-slate-100 rounded transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:N,className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by boat name, owner, or HIN...",value:a,onChange:T=>r(T.target.value),className:"w-full pl-10 pr-24 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,disabled:p}),e.jsx("button",{type:"submit",disabled:p||!a.trim(),className:"absolute right-2 top-1/2 transform -translate-y-1/2 px-4 py-1 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white text-sm font-medium rounded transition-colors",children:p?"Searching...":"Search"})]}),D&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:D})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{minHeight:"200px",maxHeight:"calc(85vh - 140px)"},children:o.length===0&&!p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ne,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:a?"No boats found. Try a different search.":"Enter a search term to find boats in Dockmaster"})]}):e.jsx("div",{className:"space-y-2",children:o.map(T=>e.jsx("button",{onClick:()=>P(T.boatId,T.ownerName,T.ownerId),disabled:w,className:"w-full p-3 border-2 border-slate-200 hover:border-green-500 rounded-lg text-left transition-all hover:shadow-md hover:bg-green-50 disabled:opacity-50",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate",children:T.boatName||"Unknown Boat"}),e.jsxs("p",{className:"text-sm text-slate-600 truncate",children:["Owner: ",T.ownerName||"Unknown"]}),T.hin&&e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:["HIN: ",T.hin]}),(T.arrivalDate||T.departureDate)&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[T.arrivalDate&&`Arrival: ${T.arrivalDate}`,T.arrivalDate&&T.departureDate&&" • ",T.departureDate&&`Departure: ${T.departureDate}`]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:"Import"})})]})},T.boatId))})})]})})}function $l(t,s){return s==="all"?t:t.filter(l=>kl(l)===s)}function El(t,s){return s==="all"?t:t.filter(l=>{if(l.storageBoat){const o=`${_e(l)}${s.charAt(0).toUpperCase()+s.slice(1)}Complete`;return!l[o]}const a=`${s}Complete`;return!l[a]})}function Ol(t,s){return!s||s.length===0?t:t.filter(l=>l.location?s.includes(l.location):!1)}function Il(t,s,l){return!s||s.length===0?t:t.filter(a=>{if(!a.location)return!1;const r=l.find(o=>o.name===a.location);return r&&s.includes(r.site_id)})}function Ml(t,s){if(!s||s.trim()==="")return t;const l=s.toLowerCase().trim();return t.filter(a=>{var r,o,m,p,u,w;return((r=a.name)==null?void 0:r.toLowerCase().includes(l))||((o=a.model)==null?void 0:o.toLowerCase().includes(l))||((m=a.owner)==null?void 0:m.toLowerCase().includes(l))||((p=a.hullId)==null?void 0:p.toLowerCase().includes(l))||((u=a.dockmasterId)==null?void 0:u.toLowerCase().includes(l))||((w=a.workOrderNumber)==null?void 0:w.toLowerCase().includes(l))})}function Pl(t,s,l=[]){let a=t;return s.searchQuery&&(a=Ml(a,s.searchQuery)),s.status&&(a=$l(a,s.status)),s.workPhase&&(a=El(a,s.workPhase)),s.locations&&(a=Ol(a,s.locations)),s.sites&&(a=Il(a,s.sites,l)),a}function Fl({boats:t,locations:s,sites:l=[],onUpdateBoats:a,dockmasterConfig:r,onMoveBoat:o,currentUser:m}){const[p,u]=x.useState(""),[w,d]=x.useState("all"),[D,H]=x.useState("all"),[N,P]=x.useState([]),[T,v]=x.useState([]),[I,se]=x.useState(!1),[V,y]=x.useState(!1),[A,G]=x.useState(null),[Y,le]=x.useState(null),[L,W]=x.useState(!1),{removeBoat:K}=at({onMoveBoat:o,onSuccess:()=>{}});x.useEffect(()=>{if(Y&&Y.id){const b=t.find(Z=>Z.id===Y.id);if(b){const Z=b.location?s.find(ge=>ge.name===b.location):null,ue=Z?Object.keys(Z.boats||{}).find(ge=>Z.boats[ge]===b.id):null;le({...b,currentLocation:Z,currentSlot:ue})}}},[t,s]);const $=b=>{P(Z=>Z.includes(b)?Z.filter(ue=>ue!==b):[...Z,b])},g=b=>{const Z=T.includes(b)?T.filter(ue=>ue!==b):[...T,b];if(v(Z),Z.includes(b)){const ue=b==="unassigned"?["unassigned"]:s.filter(ge=>ge.site_id===b).map(ge=>ge.name);P(ge=>[...new Set([...ge,...ue])])}else{const ue=b==="unassigned"?["unassigned"]:s.filter(ge=>ge.site_id===b).map(ge=>ge.name);P(ge=>ge.filter(xe=>!ue.includes(xe)))}},q=()=>{v([])},z=t.filter(b=>{const Z=b.status==="archived";return!(I&&!Z||!I&&Z)});let O=D;D==="needs-mechanicals"?O="mechanicals":D==="needs-clean"?O="clean":D==="needs-fiberglass"?O="fiberglass":D==="needs-warranty"?O="warranty":(D==="all-complete"||D==="all")&&(O="all");const B=Pl(z,{searchQuery:p,status:w,workPhase:O,locations:N.length>0?N:null,sites:T.length>0?T:null},s),X=async b=>{try{const Z=await ze.importOrUpdateBoat({name:b.name,model:b.model,make:b.make,hullId:b.hullId,dockmasterId:b.dockmasterId,owner:b.owner,customerId:b.customerId,year:b.year,length:b.length,workOrderNumber:b.workOrderNumber,qrCode:b.qrCode,nfcTag:b.nfcTag},{targetStatus:"needs-approval",preserveLocation:!1}),ue=await Ce.getAll();a(ue),y(!1)}catch(Z){console.error("Error adding/importing boat:",Z),alert(`Failed to add boat: ${Z.message}`)}},ae=b=>{confirm("Are you sure you want to delete this boat?")&&a(t.filter(Z=>Z.id!==b))},E=b=>{const Z=b.location?s.find(ge=>ge.name===b.location):null,ue=Z?Object.keys(Z.boats||{}).find(ge=>(Z.boats||{})[ge]===b.id):null;le({...b,currentLocation:Z,currentSlot:ue})},ee=async b=>{le(b),await a(t.map(Z=>Z.id===b.id?b:Z))},oe=async(b,Z,ue)=>{o&&await o(b.id,(Z==null?void 0:Z.id)||null,ue||null,b.isInventory||!1)};return e.jsxs("div",{className:"space-y-6 animate-slide-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Boats"}),e.jsx("p",{className:"text-slate-600",children:I?"View archived boats":"Manage your boat inventory"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>se(!I),className:`flex items-center gap-2 px-4 py-2 font-medium rounded-lg transition-colors shadow-md ${I?"bg-slate-600 hover:bg-slate-700 text-white":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:I?"Show Active":"Show Archived"}),!I&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-md",children:[e.jsx(We,{className:"w-5 h-5"}),"Add Boat"]}),e.jsxs("button",{onClick:()=>W(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors shadow-md",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Import"]})]})]})]}),!I&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-4 border border-slate-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Work Needed"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>H(D==="needs-mechanicals"?"all":"needs-mechanicals"),className:`p-3 rounded-lg border-2 transition-all ${D==="needs-mechanicals"?"border-orange-400 bg-orange-50":"border-slate-200 bg-white hover:border-orange-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-600",children:"Mechanicals"}),e.jsx("div",{className:"w-6 h-6 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("svg",{className:"w-4 h-4 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.filter(b=>{if(b.status==="archived")return!1;if(b.storageBoat){const Z=_e(b);return!b[`${Z}MechanicalsComplete`]}return!b.mechanicalsComplete}).length})]}),e.jsxs("button",{onClick:()=>H(D==="needs-clean"?"all":"needs-clean"),className:`p-3 rounded-lg border-2 transition-all ${D==="needs-clean"?"border-blue-400 bg-blue-50":"border-slate-200 bg-white hover:border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-600",children:"Clean"}),e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})})})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.filter(b=>{if(b.status==="archived")return!1;if(b.storageBoat){const Z=_e(b);return!b[`${Z}CleanComplete`]}return!b.cleanComplete}).length})]}),e.jsxs("button",{onClick:()=>H(D==="needs-fiberglass"?"all":"needs-fiberglass"),className:`p-3 rounded-lg border-2 transition-all ${D==="needs-fiberglass"?"border-purple-400 bg-purple-50":"border-slate-200 bg-white hover:border-purple-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-600",children:"Fiberglass"}),e.jsx("div",{className:"w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.filter(b=>{if(b.status==="archived")return!1;if(b.storageBoat){const Z=_e(b);return!b[`${Z}FiberglassComplete`]}return!b.fiberglassComplete}).length})]}),e.jsxs("button",{onClick:()=>H(D==="needs-warranty"?"all":"needs-warranty"),className:`p-3 rounded-lg border-2 transition-all ${D==="needs-warranty"?"border-teal-400 bg-teal-50":"border-slate-200 bg-white hover:border-teal-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-600",children:"Warranty"}),e.jsx("div",{className:"w-6 h-6 bg-teal-100 rounded-full flex items-center justify-center",children:e.jsx(He,{className:"w-4 h-4 text-teal-600"})})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.filter(b=>{if(b.status==="archived")return!1;if(b.storageBoat){const Z=_e(b);return!b[`${Z}WarrantyComplete`]}return!b.warrantyComplete}).length})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 border border-slate-200 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Filter by Site"]}),T.length>0&&e.jsx("button",{onClick:q,className:"text-xs text-green-600 hover:text-green-700 font-medium",children:"Clear sites"})]}),T.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 pb-3 border-b border-slate-200",children:T.map(b=>{const Z=b==="unassigned"?{name:"Unassigned"}:l.find(ue=>ue.id===b);return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-green-100 text-green-700 text-sm font-medium rounded-full",children:[(Z==null?void 0:Z.name)||"Unknown",e.jsx("button",{onClick:()=>g(b),className:"hover:bg-green-200 rounded-full p-0.5 transition-colors",children:e.jsx(ve,{className:"w-3 h-3"})})]},b)})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all ${T.includes("unassigned")?"border-green-500 bg-green-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:T.includes("unassigned"),onChange:()=>g("unassigned"),className:"w-4 h-4 text-green-600 rounded focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:"Unassigned"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.filter(b=>!b.site_id).length," locations"]})]})]}),l.sort((b,Z)=>(b.sort_order||0)-(Z.sort_order||0)).map(b=>{const Z=s.filter(ge=>ge.site_id===b.id),ue=t.filter(ge=>ge.location&&Z.some(xe=>xe.name===ge.location)).length;return e.jsxs("label",{className:`flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all ${T.includes(b.id)?"border-green-500 bg-green-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:T.includes(b.id),onChange:()=>g(b.id),className:"w-4 h-4 text-green-600 rounded focus:ring-2 focus:ring-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:b.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[ue," boat",ue!==1?"s":""," • ",Z.length," loc",Z.length!==1?"s":""]})]})]},b.id)})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Filter by Location"}),N.length>0&&e.jsx("button",{onClick:()=>P([]),className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"Clear locations"})]}),N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 pb-3 border-b border-slate-200",children:N.map(b=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-blue-100 text-blue-700 text-sm font-medium rounded-full",children:[b==="unassigned"?"Unassigned":b,e.jsx("button",{onClick:()=>$(b),className:"hover:bg-blue-200 rounded-full p-0.5 transition-colors",children:e.jsx(ve,{className:"w-3 h-3"})})]},b))}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all hover:border-slate-300 hover:bg-slate-50",children:[e.jsx("input",{type:"checkbox",checked:N.includes("unassigned"),onChange:()=>$("unassigned"),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Unassigned"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.filter(b=>!b.location).length," boats"]})]})]}),s.filter(b=>b.type==="rack-building").map(b=>e.jsxs("label",{className:`flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all ${N.includes(b.name)?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:N.includes(b.name),onChange:()=>$(b.name),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:b.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.filter(Z=>Z.location===b.name).length," boats"]})]})]},b.id)),s.filter(b=>b.type==="parking-lot").map(b=>e.jsxs("label",{className:`flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all ${N.includes(b.name)?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:N.includes(b.name),onChange:()=>$(b.name),className:"w-4 h-4 text-purple-600 rounded focus:ring-2 focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:b.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.filter(Z=>Z.location===b.name).length," boats"]})]})]},b.id)),s.filter(b=>b.type==="shop").map(b=>e.jsxs("label",{className:`flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all ${N.includes(b.name)?"border-orange-500 bg-orange-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:N.includes(b.name),onChange:()=>$(b.name),className:"w-4 h-4 text-orange-600 rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:b.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.filter(Z=>Z.location===b.name).length," boats"]})]})]},b.id)),s.filter(b=>b.type==="pool").map(b=>e.jsxs("label",{className:`flex items-center gap-2 p-3 border-2 rounded-lg cursor-pointer transition-all ${N.includes(b.name)?"border-teal-500 bg-teal-50":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:N.includes(b.name),onChange:()=>$(b.name),className:"w-4 h-4 text-teal-600 rounded focus:ring-2 focus:ring-teal-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:b.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Pool • ",t.filter(Z=>Z.location===b.name).length," boats"]})]})]},b.id))]}),N.length===0&&e.jsx("p",{className:"text-xs text-slate-500 mt-3 text-center",children:"💡 Tip: Select multiple locations to find boats across different areas"})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-4 border border-slate-200",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search boats by name, model, or owner...",value:p,onChange:b=>u(b.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{value:w,onChange:b=>d(b.target.value),className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"needs-approval",children:"Needs Approval"}),e.jsx("option",{value:"needs-parts",children:"Needs Parts"}),e.jsx("option",{value:"parts-kit-pulled",children:"Parts Kit Pulled"}),e.jsx("option",{value:"on-deck",children:"On Deck"}),e.jsx("option",{value:"all-work-complete",children:"All Work Complete"})]}),e.jsxs("select",{value:D,onChange:b=>H(b.target.value),className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Work Phases"}),e.jsx("option",{value:"needs-mechanicals",children:"Needs Mechanicals"}),e.jsx("option",{value:"needs-clean",children:"Needs Clean"}),e.jsx("option",{value:"needs-fiberglass",children:"Needs Fiberglass"}),e.jsx("option",{value:"needs-warranty",children:"Needs Warranty"}),e.jsx("option",{value:"all-complete",children:"All Phases Complete"})]})]}),(w!=="all"||D!=="all"||p||N.length>0)&&e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-200",children:[e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",e.jsx("span",{className:"font-semibold text-slate-900",children:B.length})," of ",e.jsx("span",{className:"font-semibold text-slate-900",children:t.length})," boats"]}),e.jsx("button",{onClick:()=>{u(""),d("all"),H("all"),P([]),v([])},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Clear all filters"})]})]})}),(w!=="all"||D!=="all"||N.length>0)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"Active Filters"}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[w!=="all"&&e.jsxs("span",{className:"text-blue-800",children:[e.jsx("strong",{children:"Status:"})," ",w.replace(/-/g," ")]}),D!=="all"&&e.jsxs("span",{className:"text-blue-800",children:[w!=="all"&&"•"," ",e.jsx("strong",{children:"Work:"})," ",D.replace(/-/g," ").replace("needs ","")]}),N.length>0&&e.jsxs("span",{className:"text-blue-800",children:[(w!=="all"||D!=="all")&&"•"," ",e.jsx("strong",{children:"Locations:"})," ",N.length," selected"]})]})]})]})})]}),B.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 border border-slate-200 text-center",children:[e.jsx(Ne,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500 mb-4",children:t.length===0?"No boats found":"No boats match your filters"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(b=>e.jsx(ls,{boat:b,onEdit:()=>E(b),onDelete:()=>ae(b.id)},b.id))}),V&&e.jsx(as,{boat:null,locations:s,onSave:X,onCancel:()=>y(!1)}),L&&e.jsx(rs,{dockmasterConfig:r,onImport:X,onCancel:()=>W(!1)}),Y&&e.jsx(ut,{boat:Y,locations:s,sites:l,boats:t,inventoryBoats:[],onRemove:()=>K(Y),onUpdateBoat:ee,onMoveBoat:oe,onClose:()=>le(null),currentUser:m})]})}function ns({onMoveBoat:t,onSuccess:s,onError:l}){const[a,r]=x.useState(!1),[o,m]=x.useState(null);return{assignBoat:x.useCallback(async(u,w,d=null,D=!1)=>{const H=typeof u=="object"?u.id:u;if(!H){const N=new Error("Invalid boat ID");m(N),l&&l(N);return}if(!w){const N=new Error("Invalid location ID");m(N),l&&l(N);return}if(!t){const N=new Error("onMoveBoat callback not provided");m(N),l&&l(N);return}r(!0),m(null);try{console.log("[useAssignBoat] Assigning boat:",{boatOrId:typeof u=="object"?u.id:u,locationId:w,slotId:d,isInventory:D}),await t(u,w,d,D),console.log("[useAssignBoat] Boat assigned successfully"),s&&s({boatId:H,locationId:w,slotId:d,isInventory:D})}catch(N){console.error("[useAssignBoat] Error assigning boat:",N),m(N),l?l(N):alert(`Failed to assign boat: ${N.message}`)}finally{r(!1)}},[t,s,l]),isAssigning:a,error:o}}function os({onMoveBoat:t,onSuccess:s,onError:l}){const[a,r]=x.useState(null),[o,m]=x.useState(null),[p,u]=x.useState(!1),[w,d]=x.useState(!1),D=x.useCallback((T,v,I,se)=>{T.dataTransfer.effectAllowed="move",T.dataTransfer.setData("text/plain",v.id),r(v),m({location:I,slotId:se}),u(!0),console.log("[useBoatDragDrop] Drag started:",{boatId:v.id,location:I==null?void 0:I.name,slotId:se})},[]),H=x.useCallback(()=>{r(null),m(null),u(!1),console.log("[useBoatDragDrop] Drag ended")},[]),N=x.useCallback(async(T,v,I,se)=>{if(T.preventDefault(),!a||w)return;d(!0);const V=`${I}-${se}`;if(v.boats&&v.boats[V]){alert("This slot is already occupied!"),r(null),m(null),u(!1),d(!1);return}try{console.log("[useBoatDragDrop] Dropping boat on grid:",{boatId:a.id,targetLocation:v.name,slot:V}),await t(a.id,v.id,V,a.isInventory||!1),console.log("[useBoatDragDrop] Grid drop successful"),s&&s({boat:a,location:v,slot:V})}catch(y){console.error("[useBoatDragDrop] Error during grid drop:",y),l?l(y):alert(`Failed to move boat: ${y.message}`)}finally{r(null),m(null),u(!1),d(!1)}},[a,w,t,s,l]),P=x.useCallback(async T=>{if(!(!a||w)){d(!0);try{console.log("[useBoatDragDrop] Dropping boat on pool:",{boatId:a.id,poolId:T}),await t(a.id,T,"pool",a.isInventory||!1),console.log("[useBoatDragDrop] Pool drop successful"),s&&s({boat:a,locationId:T,slot:"pool"})}catch(v){console.error("[useBoatDragDrop] Error during pool drop:",v),l?l(v):alert(`Failed to move boat: ${v.message}`)}finally{r(null),m(null),u(!1),d(!1)}}},[a,w,t,s,l]);return{draggingBoat:a,draggingFrom:o,isDragging:p,isProcessing:w,handleDragStart:D,handleDragEnd:H,handleGridDrop:N,handlePoolDrop:P}}function is({boats:t,allBoats:s,onAssign:l,onCancel:a,onCreateBoat:r,onImportBoat:o,locations:m}){const[p,u]=x.useState(""),[w,d]=x.useState(!1),[D,H]=x.useState(!1),N=t.filter(v=>v.name.toLowerCase().includes(p.toLowerCase())||v.model.toLowerCase().includes(p.toLowerCase())||v.owner.toLowerCase().includes(p.toLowerCase())||v.hullId&&v.hullId.toLowerCase().includes(p.toLowerCase())||v.dockmasterId&&v.dockmasterId.toLowerCase().includes(p.toLowerCase())),P=async v=>{if(r){const I=await r(v);I&&l(I)}d(!1)},T=async v=>{if(o){const I=await o(v);I&&l(I)}H(!1)};return w?e.jsx(as,{boat:null,locations:m||[],onSave:P,onCancel:()=>d(!1)}):D?e.jsx(rs,{dockmasterConfig:{},onImport:T,onCancel:()=>H(!1)}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[85vh] flex flex-col animate-slide-in",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Assign Boat to Slot"}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-slate-100 rounded transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>d(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Create New Boat"]}),e.jsxs("button",{onClick:()=>H(!0),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Import from Dockmaster"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, model, owner, Hull ID, or Dockmaster ID...",value:p,onChange:v=>u(v.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:[N.length," boat",N.length!==1?"s":""," available"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{minHeight:"200px",maxHeight:"calc(85vh - 200px)"},children:N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ne,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 mb-4",children:p?"No boats match your search":"No boats available"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Create a new boat or import from Dockmaster above"})]}):e.jsx("div",{className:"space-y-2",children:N.map(v=>e.jsx("button",{onClick:()=>l(v.id),className:"w-full p-3 border-2 border-slate-200 hover:border-blue-500 rounded-lg text-left transition-all hover:shadow-md hover:bg-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate",children:v.name}),v.isInventory&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-medium rounded",children:"Inventory"})]}),e.jsx("p",{className:"text-sm text-slate-600 truncate",children:v.model}),e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:["Owner: ",v.owner]}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[v.hullId&&e.jsxs("p",{className:"text-xs text-slate-600",children:[e.jsx("span",{className:"font-medium",children:"Hull ID:"})," ",v.hullId]}),v.dockmasterId&&e.jsxs("p",{className:"text-xs text-slate-600",children:[e.jsx("span",{className:"font-medium",children:"DM ID:"})," ",v.dockmasterId]})]}),v.location&&e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Currently at: ",v.location," (",v.slot,")"]})]}),v.isInventory?e.jsx("div",{className:"px-2.5 py-1 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full text-xs font-medium text-white flex-shrink-0",children:v.salesStatus||"INV"}):e.jsx("div",{className:`px-2.5 py-1 status-${v.status} rounded-full text-xs font-medium text-white flex-shrink-0`,children:v.status.replace(/-/g," ").substring(0,12)})]})},v.id))})})]})})}function Mt({location:t,sites:s=[],onSave:l,onCancel:a}){const[r,o]=x.useState(t||{name:"",type:"rack-building",layout:"grid",rows:4,columns:8}),m=u=>{u.preventDefault();const w={name:r.name,type:r.type,layout:r.type==="pool"?"grid":r.layout||"grid",rows:r.type==="pool"?1:r.rows,columns:r.type==="pool"?1:r.columns,site_id:r.site_id||null};r.id&&(w.id=r.id),r.boats&&(w.boats=r.boats),l(w)},p=r.layout==="u-shaped"?r.rows*2+r.columns:r.rows*r.columns;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 animate-slide-in max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:t?"Edit Location":"Add New Location"}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-slate-100 rounded transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Location Name"}),e.jsx("input",{type:"text",value:r.name,onChange:u=>o({...r,name:u.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Rack Building A",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Site"}),e.jsxs("select",{value:r.site_id||"",onChange:u=>o({...r,site_id:u.target.value||null}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),s.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Group this location under a physical site (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Type"}),e.jsxs("select",{value:r.type,onChange:u=>{const w=u.target.value;o({...r,type:w})},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"rack-building",children:"Rack Building"}),e.jsx("option",{value:"parking-lot",children:"Parking Lot"}),e.jsx("option",{value:"shop",children:"Shop"}),e.jsx("option",{value:"pool",children:"Pool (No Grid)"})]}),r.type==="pool"&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"A flexible container for boats without assigned slots. Great for boat shows, transit, or temporary staging."})]}),r.type!=="pool"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Layout Style"}),e.jsxs("select",{value:r.layout||"grid",onChange:u=>o({...r,layout:u.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"grid",children:"Grid (Full)"}),e.jsx("option",{value:"u-shaped",children:"U-Shaped (Perimeter)"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:r.layout==="u-shaped"?"Boats placed along three edges (left, right, bottom)":"Boats fill entire rectangular area"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:r.layout==="u-shaped"?"Unit Depth":"Rows"}),e.jsx("input",{type:"number",min:"1",max:"20",value:r.rows,onChange:u=>o({...r,rows:parseInt(u.target.value)||1}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),r.layout==="u-shaped"&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Height of U"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:r.layout==="u-shaped"?"Unit Width":"Columns"}),e.jsx("input",{type:"number",min:"1",max:"20",value:r.columns,onChange:u=>o({...r,columns:parseInt(u.target.value)||1}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),r.layout==="u-shaped"&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Width of U"})]})]}),e.jsxs("div",{className:"border-2 border-slate-200 rounded-lg p-3 bg-slate-50",children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 mb-2",children:"Preview:"}),e.jsx("div",{className:"text-xs text-slate-600 space-y-1",children:r.layout==="u-shaped"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Left side: ",r.rows," slots"]}),e.jsxs("p",{children:["• Bottom: ",r.columns," slots"]}),e.jsxs("p",{children:["• Right side: ",r.rows," slots"]}),e.jsxs("p",{className:"font-semibold mt-2 pt-2 border-t border-slate-300",children:["Total: ",p," slots"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Grid: ",r.rows," rows × ",r.columns," columns"]}),e.jsxs("p",{className:"font-semibold mt-2 pt-2 border-t border-slate-300",children:["Total: ",p," slots"]})]})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:t?"Save Changes":"Add Location"})]})]})]})})}function Rl({sites:t,locations:s,onAddSite:l,onUpdateSite:a,onDeleteSite:r,onReorderSites:o,onClose:m}){const[p,u]=x.useState(null),[w,d]=x.useState(""),[D,H]=x.useState(!1),[N,P]=x.useState(""),[T,v]=x.useState(""),[I,se]=x.useState(null),[V,y]=x.useState(null),A=g=>s.filter(q=>q.site_id===g).length,G=g=>{u(g.id),d(g.name),v("")},Y=async()=>{if(!w.trim()){v("Site name cannot be empty");return}try{await a(p,{name:w.trim()}),u(null),d(""),v("")}catch(g){v("Failed to update site: "+g.message)}},le=()=>{u(null),d(""),v("")},L=async g=>{const q=A(g.id);if(q>0){v(`Cannot delete "${g.name}" because it has ${q} location${q===1?"":"s"} assigned to it. Please reassign or delete those locations first.`);return}if(confirm(`Are you sure you want to delete the site "${g.name}"?`))try{await r(g.id),v("")}catch(z){v("Failed to delete site: "+z.message)}},W=async()=>{if(!N.trim()){v("Site name cannot be empty");return}try{const g=t.reduce((q,z)=>Math.max(q,z.sort_order||0),0);await l({name:N.trim(),sort_order:g+1}),H(!1),P(""),v("")}catch(g){v("Failed to add site: "+g.message)}},K=()=>{H(!1),P(""),v("")},$=async(g,q)=>{if(g===q)return;const z=[...t],[O]=z.splice(g,1);z.splice(q,0,O);const B=z.map(X=>X.id);try{await o(B),v("")}catch(X){console.error("Failed to reorder sites:",X),v("Failed to reorder sites. Please try again.")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center",children:e.jsx(et,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Manage Sites"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Organize locations by physical site"})]})]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-slate-600"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[T&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:T}),!D&&e.jsxs("button",{onClick:()=>H(!0),className:"w-full mb-4 p-4 border-2 border-dashed border-slate-300 hover:border-indigo-400 hover:bg-indigo-50 rounded-lg transition-colors flex items-center justify-center gap-2 text-slate-600 hover:text-indigo-600",children:[e.jsx(We,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Add New Site"})]}),D&&e.jsxs("div",{className:"mb-4 p-4 bg-indigo-50 border-2 border-indigo-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"New Site Name"}),e.jsx("input",{type:"text",value:N,onChange:g=>P(g.target.value),onKeyDown:g=>{g.key==="Enter"&&W(),g.key==="Escape"&&K()},placeholder:"e.g., South Warehouse",className:"w-full px-3 py-2 border border-slate-300 rounded-lg mb-3",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:W,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors",children:"Add Site"}),e.jsx("button",{onClick:K,className:"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(et,{className:"w-12 h-12 mx-auto mb-3 text-slate-300"}),e.jsx("p",{className:"font-medium",children:"No sites yet"}),e.jsx("p",{className:"text-sm",children:"Add your first site to organize locations"})]}):t.map((g,q)=>{const z=A(g.id),O=p===g.id,B=I===q,X=V===q;return e.jsx("div",{draggable:!O,onDragStart:ae=>{O||(se(q),ae.dataTransfer.effectAllowed="move")},onDragOver:ae=>{O||(ae.preventDefault(),ae.dataTransfer.dropEffect="move",y(q))},onDragLeave:()=>{y(null)},onDrop:ae=>{ae.preventDefault(),I!==null&&I!==q&&!O&&$(I,q),se(null),y(null)},onDragEnd:()=>{se(null),y(null)},className:`
                      p-4 border rounded-lg transition-all
                      ${B?"opacity-50 bg-slate-100":"bg-slate-50"}
                      ${X?"border-indigo-500 border-2 bg-indigo-50":"border-slate-200"}
                      ${O?"":"hover:bg-slate-100 hover:shadow-md cursor-grab active:cursor-grabbing"}
                    `,children:O?e.jsxs("div",{children:[e.jsx("input",{type:"text",value:w,onChange:ae=>d(ae.target.value),onKeyDown:ae=>{ae.key==="Enter"&&Y(),ae.key==="Escape"&&le()},className:"w-full px-3 py-2 border border-slate-300 rounded-lg mb-3",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Y,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Save"}),e.jsx("button",{onClick:le,className:"px-3 py-1.5 bg-slate-200 hover:bg-slate-300 text-slate-700 text-sm font-medium rounded-lg transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 text-slate-400 hover:text-slate-600 cursor-grab active:cursor-grabbing",children:e.jsx(ml,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:g.name})]}),e.jsxs("p",{className:"text-sm text-slate-600 ml-4",children:[z," location",z===1?"":"s"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ae=>{ae.stopPropagation(),G(g)},className:"p-2 hover:bg-slate-200 rounded-lg transition-colors",title:"Edit site",children:e.jsx(Ue,{className:"w-4 h-4 text-slate-600"})}),e.jsx("button",{onClick:ae=>{ae.stopPropagation(),L(g)},className:"p-2 hover:bg-red-100 rounded-lg transition-colors",title:z>0?"Cannot delete - has locations":"Delete site",children:e.jsx(Ve,{className:`w-4 h-4 ${z>0?"text-slate-300":"text-red-600"}`})})]})]})},g.id)})})]}),e.jsx("div",{className:"p-6 border-t border-slate-200 bg-slate-50",children:e.jsx("button",{onClick:m,className:"w-full px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors",children:"Close"})})]})})}function jt({location:t,boats:s,onBoatClick:l,onAddBoat:a,onEdit:r,onDelete:o,onRemove:m,isDragging:p,onDragStart:u,onDragEnd:w,onDragOver:d,onDrop:D,currentUser:H}){const[N,P]=x.useState(""),v=(t.pool_boats||t.poolBoats||[]).map(y=>s.find(A=>A.id===y)).filter(Boolean),I=v.filter(y=>{var G,Y,le,L,W,K,$,g,q,z;if(!N)return!0;const A=N.toLowerCase();return((G=y.name)==null?void 0:G.toLowerCase().includes(A))||((Y=y.model)==null?void 0:Y.toLowerCase().includes(A))||((le=y.make)==null?void 0:le.toLowerCase().includes(A))||((L=y.owner)==null?void 0:L.toLowerCase().includes(A))||((W=y.hullId)==null?void 0:W.toLowerCase().includes(A))||((K=y.dockmasterId)==null?void 0:K.toLowerCase().includes(A))||(($=y.workOrderNumber)==null?void 0:$.toLowerCase().includes(A))||((g=y.year)==null?void 0:g.toString().toLowerCase().includes(A))||((q=y.status)==null?void 0:q.toLowerCase().includes(A))||((z=y.salesStatus)==null?void 0:z.toLowerCase().includes(A))}),se=y=>{y.preventDefault(),y.dataTransfer.dropEffect="move",d&&d(y)},V=y=>{y.preventDefault(),y.stopPropagation(),D&&D(t.id,"pool")};return e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border-2 border-slate-200 hover:border-teal-400 transition-colors",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-gradient-to-r from-teal-500 to-teal-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-white text-lg",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&H&&(H.role==="admin"||H.role==="manager")&&e.jsx("button",{onClick:r,className:"p-1.5 hover:bg-white/20 rounded transition-colors",title:"Edit location",children:e.jsx(hl,{className:"w-4 h-4 text-white"})}),(o||m)&&H&&(H.role==="admin"||H.role==="manager")&&e.jsx("button",{onClick:o||m,className:"p-1.5 hover:bg-white/20 rounded transition-colors",title:"Delete location",children:e.jsx(Ve,{className:"w-4 h-4 text-white"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("p",{className:"text-teal-100",children:"Pool • Flexible Layout"}),e.jsxs("p",{className:"text-white font-medium",children:[v.length," boat",v.length!==1?"s":""]})]})]}),v.length>5&&e.jsx("div",{className:"p-3 border-b border-slate-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search boats...",value:N,onChange:y=>P(y.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"})]})}),e.jsx("div",{className:`p-4 min-h-[150px] ${p?"bg-teal-50 border-2 border-dashed border-teal-400":"bg-slate-50"}`,onDragOver:se,onDrop:V,children:I.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-slate-400",children:[e.jsx(Ne,{className:"w-10 h-10 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:p?"Drop boat here":v.length===0?"No boats in pool":"No matches"}),!p&&a&&e.jsx("button",{onClick:a,className:"mt-2 text-sm text-teal-600 hover:text-teal-700 font-medium",children:"+ Add boat"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:I.map(y=>e.jsx(Dl,{boat:y,onClick:l,draggable:!!u,onDragStart:u?A=>u(A,y,t.name):void 0,onDragEnd:w},y.id))}),!p&&a&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx("button",{onClick:a,className:"text-sm text-teal-600 hover:text-teal-700 font-medium",children:"+ Add boat"})})]})}),e.jsx("div",{className:"px-4 py-2 bg-slate-100 border-t border-slate-200",children:e.jsx("p",{className:"text-xs text-slate-500 text-center",children:"💡 Drag boats in or out of this pool"})})]})}function cs({location:t,boats:s,inventoryBoats:l,onSlotClick:a,onBoatClick:r,draggingBoat:o,onDragStart:m,onDragEnd:p,onDrop:u,onClose:w}){var le;const[d,D]=x.useState("layout"),H=[...s||[],...l||[]],N=t.layout==="u-shaped",P=N?t.rows*2+t.columns:t.rows*t.columns,T=Object.keys(t.boats||{}).length,v=P>0?Math.round(T/P*100):0,I=L=>{L.preventDefault(),L.dataTransfer.dropEffect="move"},se=L=>L?L.isInventory?{HA:"bg-gradient-to-br from-green-500 to-green-600",HS:"bg-gradient-to-br from-emerald-600 to-emerald-700",OA:"bg-gradient-to-br from-blue-500 to-blue-600",OS:"bg-gradient-to-br from-blue-600 to-blue-700",FA:"bg-gradient-to-br from-amber-500 to-amber-600",FS:"bg-gradient-to-br from-amber-600 to-amber-700",S:"bg-gradient-to-br from-purple-500 to-purple-600",R:"bg-gradient-to-br from-indigo-500 to-indigo-600",FP:"bg-gradient-to-br from-slate-500 to-slate-600"}[L.salesStatus]||"bg-gradient-to-br from-blue-500 to-blue-600":`status-${L.status}`:"",V=(L,W,K)=>{if(!L)return e.jsxs("div",{className:"text-slate-400 pointer-events-none",children:[e.jsx("div",{className:"text-3xl mb-1",children:"+"}),e.jsxs("p",{className:"text-sm",children:[W+1,"-",K+1]})]});if(L.isInventory){const $={HA:"AVAIL",HS:"SOLD",OA:"ORDER",OS:"ORD-S",FA:"FUTURE",FS:"FUT-S",S:"SOLD",R:"RSVD",FP:"FP"};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white font-bold text-base leading-tight pointer-events-none truncate w-full px-1",children:L.name}),e.jsxs("p",{className:"text-white/80 text-sm pointer-events-none truncate w-full",children:[L.year," ",L.model]}),e.jsx("div",{className:"flex items-center gap-1 mt-1 pointer-events-none",children:e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs text-white font-bold",children:$[L.salesStatus]||L.salesStatus||"INV"})})]})}if(L.storageBoat){const $=_e(L),g=L.fallStatus==="all-work-complete"&&L.winterStatus==="all-work-complete"&&L.springStatus==="all-work-complete",q=g?"flex-[1]":$==="fall"?"flex-[2]":"flex-[1]",z=g?"flex-[1]":$==="winter"?"flex-[2]":"flex-[1]",O=g?"flex-[1]":$==="spring"?"flex-[2]":"flex-[1]",B=$!=="fall"&&!g?"opacity-70":"",X=$!=="winter"&&!g?"opacity-70":"",ae=$!=="spring"&&!g?"opacity-70":"";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute inset-0 flex rounded-xl overflow-hidden pointer-events-none",children:[e.jsx("div",{className:`${q} h-full status-${L.fallStatus} ${B} border-r border-white/20`}),e.jsx("div",{className:`${z} h-full status-${L.winterStatus} ${X} border-r border-white/20`}),e.jsx("div",{className:`${O} h-full status-${L.springStatus} ${ae}`})]}),e.jsx("p",{className:"text-white font-bold text-lg leading-tight pointer-events-none truncate w-full px-1 relative z-10",children:L.owner}),L.workOrderNumber&&e.jsxs("p",{className:"text-white text-sm font-mono font-semibold pointer-events-none truncate w-full relative z-10",children:["WO: ",L.workOrderNumber]}),e.jsxs("div",{className:"flex gap-1.5 mt-1 pointer-events-none relative z-10",children:[e.jsx(Oe,{className:`w-5 h-5 ${L[`${$}MechanicalsComplete`]?"text-white":"text-white/30"}`,title:"Mechanicals"}),e.jsx(Je,{className:`w-5 h-5 ${L[`${$}CleanComplete`]?"text-white":"text-white/30"}`,title:"Clean"}),e.jsx(Te,{className:`w-5 h-5 ${L[`${$}FiberglassComplete`]?"text-white":"text-white/30"}`,title:"Fiberglass"}),e.jsx(He,{className:`w-5 h-5 ${L[`${$}WarrantyComplete`]?"text-white":"text-white/30"}`,title:"Warranty"}),e.jsx(tt,{className:`w-5 h-5 ${L[`${$}InvoicedComplete`]?"text-white":"text-white/30"}`,title:"Invoiced"})]}),e.jsx("p",{className:"text-white text-xs opacity-75 pointer-events-none truncate w-full mt-1 relative z-10",children:L.name})]})}return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white font-bold text-lg leading-tight pointer-events-none truncate w-full px-1",children:L.owner}),L.workOrderNumber&&e.jsxs("p",{className:"text-white text-sm font-mono font-semibold pointer-events-none truncate w-full",children:["WO: ",L.workOrderNumber]}),e.jsxs("div",{className:"flex gap-1.5 mt-1 pointer-events-none",children:[e.jsx(Oe,{className:`w-5 h-5 ${L.mechanicalsComplete?"text-white":"text-white/30"}`,title:"Mechanicals"}),e.jsx(Je,{className:`w-5 h-5 ${L.cleanComplete?"text-white":"text-white/30"}`,title:"Clean"}),e.jsx(Te,{className:`w-5 h-5 ${L.fiberglassComplete?"text-white":"text-white/30"}`,title:"Fiberglass"}),e.jsx(He,{className:`w-5 h-5 ${L.warrantyComplete?"text-white":"text-white/30"}`,title:"Warranty"}),e.jsx(tt,{className:`w-5 h-5 ${L.invoicedComplete?"text-white":"text-white/30"}`,title:"Invoiced"})]}),e.jsx("p",{className:"text-white text-xs opacity-75 pointer-events-none truncate w-full mt-1",children:L.name})]})},y=(L,W,K=!0)=>{var O;if(!K)return e.jsx("div",{className:"aspect-square"},`${L}-${W}`);const $=`${L}-${W}`,g=(O=t.boats)==null?void 0:O[$],q=H.find(B=>B.id===g),z=o!==null;return e.jsx("div",{draggable:!!q,title:q?"Drag to move • Click for details":"Click to assign boat",onDragStart:B=>{q&&m&&m(B,q,t,$)},onDragEnd:p,onDragOver:I,onDrop:B=>{u&&u(B,t,L,W)},onClick:B=>{B.stopPropagation(),q&&r?r(q):!q&&a&&a(t,L,W)},className:`aspect-square border-2 rounded-xl flex flex-col items-center justify-center text-center transition-all min-w-[140px] min-h-[140px] group ${q?q.storageBoat?"border-transparent shadow-md cursor-grab active:cursor-grabbing hover:scale-105 p-0 relative":`${se(q)} border-transparent shadow-md cursor-grab active:cursor-grabbing hover:scale-105 p-3`:z?"border-blue-400 bg-blue-50 cursor-pointer p-3":"border-slate-300 bg-white hover:border-blue-400 hover:bg-blue-50 cursor-pointer p-3"}`,children:V(q,L,W)},$)},A=(L,W)=>{var z;const K=`${L}-${W}`,$=(z=t.boats)==null?void 0:z[K],g=H.find(O=>O.id===$),q=o!==null;return e.jsx("div",{draggable:!!g,title:g?"Drag to move • Click for details":"Click to assign boat",onDragStart:O=>{g&&m&&m(O,g,t,K)},onDragEnd:p,onDragOver:I,onDrop:O=>{u&&u(O,t,L,W)},onClick:O=>{O.stopPropagation(),g&&r?r(g):!g&&a&&a(t,L,W)},className:`border-2 rounded-xl flex flex-col items-center justify-center text-center transition-all overflow-hidden group ${g?g.storageBoat?"border-transparent shadow-md cursor-grab active:cursor-grabbing hover:scale-105 p-0 relative":`${se(g)} border-transparent shadow-md cursor-grab active:cursor-grabbing hover:scale-105 p-2`:q?"border-blue-400 bg-blue-50 cursor-pointer p-2":"border-slate-300 bg-white hover:border-blue-400 hover:bg-blue-50 cursor-pointer p-2"}`,style:{width:"140px",height:"140px",flexShrink:0},children:V(g,L,W)},K)},G=()=>{const L=[];for(let W=0;W<t.rows;W++)for(let K=0;K<t.columns;K++)if(N){const $=K===0,g=K===t.columns-1,q=W===t.rows-1,z=$||g||q;L.push(y(W,K,z))}else L.push(y(W,K,!0));return L},Y=()=>{const L=[],W=[],K=[];for(let g=0;g<t.rows-1;g++)L.push({row:g,col:0});for(let g=0;g<t.columns;g++)W.push({row:t.rows-1,col:g});for(let g=0;g<t.rows-1;g++)K.push({row:g,col:t.columns-1});const $=(g,q)=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-600 mb-2 px-1",children:g}),e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(auto-fill, 140px)"},children:q.map(({row:z,col:O})=>A(z,O))})]});return e.jsxs("div",{className:"p-2",children:[$(`Left Arm (${L.length} slots)`,L),$(`Bottom (${W.length} slots)`,W),$(`Right Arm (${K.length} slots)`,K)]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-7xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-slate-100 to-slate-200 border-b border-slate-300 rounded-t-2xl flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:t.name}),e.jsxs("p",{className:"text-sm text-slate-600",children:[(le=t.type)==null?void 0:le.replace("-"," ")," • ",t.rows," × ",t.columns,N&&" (U-shaped)"," • ",T,"/",P," slots (",v,"%)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[N&&e.jsxs("div",{className:"flex bg-white rounded-lg shadow p-1 gap-1",children:[e.jsxs("button",{onClick:()=>D("layout"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${d==="layout"?"bg-blue-500 text-white":"text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(Ut,{className:"w-4 h-4"}),"Layout"]}),e.jsxs("button",{onClick:()=>D("concise"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${d==="concise"?"bg-blue-500 text-white":"text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(Zt,{className:"w-4 h-4"}),"Concise"]})]}),e.jsx("button",{onClick:w,className:"p-2 bg-white hover:bg-slate-100 rounded-lg transition-colors shadow",children:e.jsx(ve,{className:"w-6 h-6 text-slate-600"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 sm:p-6 bg-slate-50",children:N&&d==="concise"?Y():e.jsx(e.Fragment,{children:t.columns<=2?e.jsx("div",{className:"flex items-center justify-center min-h-full p-2",children:e.jsx("div",{className:"grid gap-5",style:{gridTemplateColumns:`repeat(${t.columns}, minmax(140px, 180px))`,maxWidth:`${t.columns*200}px`},children:G()})}):e.jsx("div",{className:"inline-block min-w-full p-2",children:e.jsx("div",{className:"grid gap-5",style:{gridTemplateColumns:`repeat(${t.columns}, minmax(140px, 1fr))`},children:G()})})})}),e.jsx("div",{className:"p-4 bg-slate-100 border-t border-slate-200 rounded-b-2xl",children:e.jsx("p",{className:"text-sm text-slate-500 text-center",children:"Drag boats to move them between slots • Click empty slots to assign boats"})})]})})}function ds({location:t,boats:s,inventoryBoats:l,onSlotClick:a,onBoatClick:r,draggingBoat:o,onDragStart:m,onDragEnd:p,onDrop:u,onMaximize:w,onEdit:d,onDelete:D,onRemove:H,currentUser:N}){var $;const[P,T]=x.useState("layout"),v=[...s||[],...l||[]],I=t.layout==="u-shaped",se=I?t.rows*2+t.columns:t.rows*t.columns,V=Object.keys(t.boats||{}).length,y=se>0?Math.round(V/se*100):0,A=g=>{g.preventDefault(),g.dataTransfer.dropEffect="move"},G=g=>g?g.isInventory?{HA:"bg-gradient-to-br from-green-500 to-green-600",HS:"bg-gradient-to-br from-emerald-600 to-emerald-700",OA:"bg-gradient-to-br from-blue-500 to-blue-600",OS:"bg-gradient-to-br from-blue-600 to-blue-700",FA:"bg-gradient-to-br from-amber-500 to-amber-600",FS:"bg-gradient-to-br from-amber-600 to-amber-700",S:"bg-gradient-to-br from-purple-500 to-purple-600",R:"bg-gradient-to-br from-indigo-500 to-indigo-600",FP:"bg-gradient-to-br from-slate-500 to-slate-600"}[g.salesStatus]||"bg-gradient-to-br from-blue-500 to-blue-600":`status-${g.status}`:"",Y=(g,q,z)=>{if(!g)return e.jsxs("div",{className:"text-slate-400 pointer-events-none",children:[e.jsx("div",{className:"text-[clamp(1.25rem,2.5vw,2rem)] mb-0.5",children:"+"}),e.jsxs("p",{className:"text-[clamp(0.6rem,1.2vw,0.75rem)] leading-tight",children:[q+1,"-",z+1]})]});if(g.isInventory){const O={HA:"AVAIL",HS:"SOLD",OA:"ORDER",OS:"ORD-S",FA:"FUTURE",FS:"FUT-S",S:"SOLD",R:"RSVD",FP:"FP"};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white font-bold text-[clamp(0.65rem,1.5vw,0.875rem)] leading-tight pointer-events-none truncate w-full px-1",children:g.name}),e.jsxs("p",{className:"text-white/80 text-[clamp(0.55rem,1.1vw,0.75rem)] pointer-events-none truncate w-full",children:[g.year," ",g.model]}),e.jsx("div",{className:"flex items-center gap-1 mt-1 pointer-events-none",children:e.jsx("span",{className:"px-1.5 py-0.5 bg-white/20 rounded text-[clamp(0.5rem,1vw,0.625rem)] text-white font-bold",children:O[g.salesStatus]||g.salesStatus||"INV"})})]})}if(g.storageBoat){const O=_e(g),B=g.fallStatus==="all-work-complete"&&g.winterStatus==="all-work-complete"&&g.springStatus==="all-work-complete",X=B?"flex-[1]":O==="fall"?"flex-[2]":"flex-[1]",ae=B?"flex-[1]":O==="winter"?"flex-[2]":"flex-[1]",E=B?"flex-[1]":O==="spring"?"flex-[2]":"flex-[1]",ee=O!=="fall"&&!B?"opacity-70":"",oe=O!=="winter"&&!B?"opacity-70":"",b=O!=="spring"&&!B?"opacity-70":"";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute inset-0 flex rounded-lg overflow-hidden pointer-events-none",children:[e.jsx("div",{className:`${X} h-full status-${g.fallStatus} ${ee} border-r border-white/20`}),e.jsx("div",{className:`${ae} h-full status-${g.winterStatus} ${oe} border-r border-white/20`}),e.jsx("div",{className:`${E} h-full status-${g.springStatus} ${b}`})]}),e.jsx("p",{className:"text-white font-bold text-[clamp(0.75rem,1.8vw,1.125rem)] leading-tight pointer-events-none truncate w-full px-1 relative z-10",children:g.owner}),g.workOrderNumber&&e.jsxs("p",{className:"text-white text-[clamp(0.6rem,1.2vw,0.875rem)] font-mono font-semibold pointer-events-none truncate w-full relative z-10",children:["WO: ",g.workOrderNumber]}),e.jsxs("div",{className:"flex gap-1 mt-1 pointer-events-none relative z-10",children:[e.jsx(Oe,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g[`${O}MechanicalsComplete`]?"text-white":"text-white/30"}`,title:"Mechanicals"}),e.jsx(Je,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g[`${O}CleanComplete`]?"text-white":"text-white/30"}`,title:"Clean"}),e.jsx(Te,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g[`${O}FiberglassComplete`]?"text-white":"text-white/30"}`,title:"Fiberglass"}),e.jsx(He,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g[`${O}WarrantyComplete`]?"text-white":"text-white/30"}`,title:"Warranty"})]}),e.jsx("p",{className:"text-white text-[clamp(0.5rem,1vw,0.625rem)] opacity-75 pointer-events-none truncate w-full mt-0.5 relative z-10",children:g.name})]})}return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white font-bold text-[clamp(0.75rem,1.8vw,1.125rem)] leading-tight pointer-events-none truncate w-full px-1",children:g.owner}),g.workOrderNumber&&e.jsxs("p",{className:"text-white text-[clamp(0.6rem,1.2vw,0.875rem)] font-mono font-semibold pointer-events-none truncate w-full",children:["WO: ",g.workOrderNumber]}),e.jsxs("div",{className:"flex gap-1 mt-1 pointer-events-none",children:[e.jsx(Oe,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g.mechanicalsComplete?"text-white":"text-white/30"}`,title:"Mechanicals"}),e.jsx(Je,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g.cleanComplete?"text-white":"text-white/30"}`,title:"Clean"}),e.jsx(Te,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g.fiberglassComplete?"text-white":"text-white/30"}`,title:"Fiberglass"}),e.jsx(He,{className:`w-[clamp(0.75rem,1.5vw,1.125rem)] h-[clamp(0.75rem,1.5vw,1.125rem)] ${g.warrantyComplete?"text-white":"text-white/30"}`,title:"Warranty"})]}),e.jsx("p",{className:"text-white text-[clamp(0.5rem,1vw,0.625rem)] opacity-75 pointer-events-none truncate w-full mt-0.5",children:g.name})]})},le=()=>{var q;const g=[];for(let z=0;z<t.rows;z++)for(let O=0;O<t.columns;O++){const B=O===0,X=O===t.columns-1,ae=z===t.rows-1;if(!(B||X||ae)&&I){g.push(e.jsx("div",{className:"aspect-square"},`${z}-${O}`));continue}const ee=`${z}-${O}`,oe=(q=t.boats)==null?void 0:q[ee],b=v.find(ue=>ue.id===oe),Z=o!==null;g.push(e.jsx("div",{draggable:!!b,title:b?"Drag to move • Click for details":"Click to assign boat",onDragStart:ue=>{b&&m&&m(ue,b,t,ee)},onDragEnd:p,onDragOver:A,onDrop:ue=>{u&&u(ue,t,z,O)},onClick:ue=>{ue.stopPropagation(),b&&r?r(b):!b&&a&&a(t,z,O)},className:`location-slot aspect-square border-2 rounded-lg flex flex-col items-center justify-center text-center transition-all group ${b?b.storageBoat?"border-transparent shadow-sm cursor-grab active:cursor-grabbing hover:scale-105 p-0 relative":`${G(b)} border-transparent shadow-sm cursor-grab active:cursor-grabbing hover:scale-105 p-2`:Z?"border-blue-400 bg-blue-50 cursor-pointer p-2":"border-slate-300 bg-white hover:border-blue-400 hover:bg-blue-50 cursor-pointer p-2"}`,children:Y(b,z,O)},ee))}return g},L=()=>Array.from({length:t.rows}).map((g,q)=>Array.from({length:t.columns}).map((z,O)=>{var ee;const B=`${q}-${O}`,X=(ee=t.boats)==null?void 0:ee[B],ae=v.find(oe=>oe.id===X),E=o!==null;return e.jsx("div",{draggable:!!ae,title:ae?"Drag to move • Click for details":"Click to assign boat",onDragStart:oe=>{ae&&m&&m(oe,ae,t,B)},onDragEnd:p,onDragOver:A,onDrop:oe=>{u&&u(oe,t,q,O)},onClick:oe=>{oe.stopPropagation(),ae&&r?r(ae):!ae&&a&&a(t,q,O)},className:`location-slot aspect-square border-2 rounded-lg flex flex-col items-center justify-center text-center transition-all group ${ae?ae.storageBoat?"border-transparent shadow-sm cursor-grab active:cursor-grabbing hover:scale-105 p-0 relative":`${G(ae)} border-transparent shadow-sm cursor-grab active:cursor-grabbing hover:scale-105 p-2`:E?"border-blue-400 bg-blue-50 cursor-pointer p-2":"border-slate-300 bg-white hover:border-blue-400 hover:bg-blue-50 cursor-pointer p-2"}`,children:Y(ae,q,O)},B)})),W=(g,q)=>{var ae;const z=`${g}-${q}`,O=(ae=t.boats)==null?void 0:ae[z],B=v.find(E=>E.id===O),X=o!==null;return e.jsx("div",{draggable:!!B,title:B?"Drag to move • Click for details":"Click to assign boat",onDragStart:E=>{B&&m&&m(E,B,t,z)},onDragEnd:p,onDragOver:A,onDrop:E=>{u&&u(E,t,g,q)},onClick:E=>{E.stopPropagation(),B&&r?r(B):!B&&a&&a(t,g,q)},className:`location-slot border-2 rounded-lg flex flex-col items-center justify-center text-center transition-all overflow-hidden group ${B?B.storageBoat?"border-transparent shadow-sm cursor-grab active:cursor-grabbing hover:scale-105 p-0 relative":`${G(B)} border-transparent shadow-sm cursor-grab active:cursor-grabbing hover:scale-105 p-1.5`:X?"border-blue-400 bg-blue-50 cursor-pointer p-1.5":"border-slate-300 bg-white hover:border-blue-400 hover:bg-blue-50 cursor-pointer p-1.5"}`,style:{width:"100px",height:"100px",flexShrink:0},children:Y(B,g,q)},z)},K=()=>{const g=[],q=[],z=[];for(let B=0;B<t.rows-1;B++)g.push({row:B,col:0});for(let B=0;B<t.columns;B++)q.push({row:t.rows-1,col:B});for(let B=0;B<t.rows-1;B++)z.push({row:B,col:t.columns-1});const O=(B,X)=>e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 mb-1.5 px-0.5",children:B}),e.jsx("div",{className:"grid gap-1.5",style:{gridTemplateColumns:"repeat(auto-fill, 100px)"},children:X.map(({row:ae,col:E})=>W(ae,E))})]});return e.jsxs("div",{children:[O(`Left Arm (${g.length})`,g),O(`Bottom (${q.length})`,q),O(`Right Arm (${z.length})`,z)]})};return e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900",children:t.name}),I&&e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"U-Shaped Layout"})]}),e.jsxs("div",{className:"flex gap-1",children:[w&&e.jsx("button",{onClick:w,className:"p-1.5 hover:bg-white rounded-lg transition-colors",title:"Expand view",children:e.jsx(ul,{className:"w-4 h-4 text-slate-600"})}),d&&N&&(N.role==="admin"||N.role==="manager")&&e.jsx("button",{onClick:d,className:"p-1.5 hover:bg-white rounded-lg transition-colors",title:"Edit",children:e.jsx(Ue,{className:"w-4 h-4 text-slate-600"})}),(D||H)&&N&&(N.role==="admin"||N.role==="manager")&&e.jsx("button",{onClick:D||H,className:"p-1.5 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(Ve,{className:"w-4 h-4 text-red-600"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("p",{className:"text-slate-600 capitalize",children:[($=t.type)==null?void 0:$.replace("-"," ")," • ",t.rows," × ",t.columns,I&&" (perimeter)"]}),e.jsxs("p",{className:"text-slate-700 font-medium",children:[V,"/",se," (",y,"%)"]})]}),I&&e.jsxs("div",{className:"flex mt-3 bg-slate-200 rounded-lg p-0.5",children:[e.jsxs("button",{onClick:()=>T("layout"),className:`flex-1 flex items-center justify-center gap-1 px-2 py-1 rounded-md text-xs font-medium transition-colors ${P==="layout"?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(Ut,{className:"w-3 h-3"}),"Layout"]}),e.jsxs("button",{onClick:()=>T("concise"),className:`flex-1 flex items-center justify-center gap-1 px-2 py-1 rounded-md text-xs font-medium transition-colors ${P==="concise"?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(Zt,{className:"w-3 h-3"}),"Concise"]})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50",children:[I&&P==="concise"?e.jsx("div",{className:"overflow-x-auto",children:K()}):e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full",children:e.jsx("div",{className:"grid gap-1.5",style:{gridTemplateColumns:`repeat(${t.columns}, minmax(100px, 100px))`},children:I?le():L()})})}),e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200",children:e.jsx("p",{className:"text-xs text-slate-500 text-center",children:"💡 Drag boats to move them between slots"})})]})]})}function Ke({title:t,icon:s,color:l,locations:a,boats:r,inventoryBoats:o,onSlotClick:m,onBoatClick:p,draggingBoat:u,onDragStart:w,onDragEnd:d,onDrop:D,onMaximize:H,onEdit:N,onDelete:P}){const T={blue:"from-blue-500 to-blue-600",purple:"from-purple-500 to-purple-600",orange:"from-orange-500 to-orange-600"};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-10 h-10 bg-gradient-to-br ${T[l]} rounded-lg flex items-center justify-center`,children:e.jsx(s,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:t})]}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:a.map(v=>e.jsx(ds,{location:v,boats:r,inventoryBoats:o,onSlotClick:m,onBoatClick:p,draggingBoat:u,onDragStart:w,onDragEnd:d,onDrop:D,onMaximize:()=>H(v),onEdit:N?()=>N(v):void 0,onDelete:P?()=>P(v.id):void 0},v.id))})]})}function Tl({locations:t,sites:s=[],boats:l,onUpdateLocations:a,onUpdateBoats:r,onMoveBoat:o,onAddSite:m,onUpdateSite:p,onDeleteSite:u,onReorderSites:w,currentUser:d}){const D=l.filter(n=>!n.isInventory),H=l.filter(n=>n.isInventory),[N,P]=x.useState(!1),[T,v]=x.useState(null),[I,se]=x.useState(!1),[V,y]=x.useState(!1),[A,G]=x.useState(null),[Y,le]=x.useState(null),[L,W]=x.useState(null),[K,$]=x.useState(!1),[g,q]=x.useState(null),[z,O]=x.useState(new Set(s.map(n=>n.id))),B=x.useRef(0),{removeBoat:X}=at({onMoveBoat:o,onSuccess:()=>W(null)}),{assignBoat:ae}=ns({onMoveBoat:o,onSuccess:()=>{se(!1),G(null),le(null),$(!1)}}),{draggingBoat:E,isDragging:ee,handleDragStart:oe,handleDragEnd:b,handleGridDrop:Z,handlePoolDrop:ue}=os({onMoveBoat:o});x.useEffect(()=>{O(n=>{const f=new Set(n);return s.forEach(c=>f.add(c.id)),f})},[s]),x.useEffect(()=>{if(g){const n=t.find(f=>f.id===g.id);n&&q(n)}},[t,g==null?void 0:g.id]);const ge=n=>{O(f=>{const c=new Set(f);return c.has(n)?c.delete(n):c.add(n),c})};x.useEffect(()=>{if(L){const n=l.find(f=>f.id===L.id);n&&JSON.stringify(n)!==JSON.stringify(L)&&W({...n,currentLocation:L.currentLocation,currentSlot:L.currentSlot})}},[l]),x.useEffect(()=>{const n=c=>{B.current=c.clientY},f=c=>{var k;(k=c.touches)!=null&&k[0]&&(B.current=c.touches[0].clientY)};return window.addEventListener("mousemove",n),window.addEventListener("touchmove",f,{passive:!0}),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("touchmove",f)}},[]),x.useEffect(()=>{if(!ee)return;console.log("Auto-scroll started - isDraggingActive:",ee);const n=setInterval(()=>{const f=B.current,c=window.innerHeight,k=100,F=15;console.log("Checking scroll - mouseY:",f,"windowHeight:",c),f<k?(console.log("Scrolling UP"),window.scrollBy({top:-F,behavior:"auto"})):f>c-k&&(console.log("Scrolling DOWN"),window.scrollBy({top:F,behavior:"auto"}))},16);return()=>{console.log("Auto-scroll stopped"),clearInterval(n)}},[ee]);const xe=n=>{const f={...n,boats:{}};n.type==="pool"&&(f.pool_boats=[]),delete f.poolBoats,delete f.id,a([...t,f]),P(!1)},ye=n=>{const f=t.map(c=>c.id===n.id?n:c);a(f),v(null)},U=n=>{if(confirm("Are you sure you want to delete this location?")){const f=t.find(c=>c.id===n);if(f&&Object.keys(f.boats).length>0){const c=l.map(k=>k.location===f.name?{...k,location:null,slot:null}:k);r(c)}a(t.filter(c=>c.id!==n))}},J=(n,f,c)=>{const k=`${f}-${c}`,F=n.boats?n.boats[k]:null;if(F){const te=l.find(me=>me.id===F);te&&W({...te,currentLocation:n,currentSlot:k})}else G(n),le({row:f,col:c,slotId:k}),se(!0)},re=n=>{W(n)},ie=async n=>{const f={...n,id:`boat-${Date.now()}`,qrCode:`BBG-${Date.now().toString(36).toUpperCase()}`,status:n.status||"needs-approval",mechanicalsComplete:!1,cleanComplete:!1,fiberglassComplete:!1,warrantyComplete:!1},c=[...l,f];return await r(c),f},fe=async n=>{try{const f={...n,qr_code:n.qrCode||`BBG-${Date.now().toString(36).toUpperCase()}`,status:n.status||"needs-approval",mechanicals_complete:!1,clean_complete:!1,fiberglass_complete:!1,warranty_complete:!1},c=await ze.importOrUpdateBoat(f,{targetStatus:"needs-approval",preserveLocation:!1});console.log("[LocationsView] Boat saved to database:",c.id);const k=[...l.filter(F=>F.id!==c.id),c];return await r(k),c}catch(f){throw console.error("[LocationsView] Error importing boat:",f),f}},Q=async n=>{if(!A||K)return;$(!0);const f=typeof n=="object"?n:l.find(F=>F.id===n);if(!f){console.error("[Assign] Boat not found:",n),$(!1);return}let c=null;if(A.type==="pool")c="pool";else{if(!Y){console.error("[Assign] No slot selected for grid assignment"),$(!1);return}if(typeof Y.row!="number"||typeof Y.col!="number"){console.error("[Assign] Invalid slot coordinates:",Y),alert("Invalid slot selection. Please try again."),$(!1);return}c=Y.slotId}const k=window.scrollY;await ae(f,A.id,c,f.isInventory),setTimeout(()=>{window.scrollTo(0,k)},100)},S=n=>{r(l.map(f=>f.id===n.id?n:f)),W(n)},h=async(n,f,c)=>{if($(!0),n.isInventory&&o){try{await o(n.id,(f==null?void 0:f.id)||null,c||null,!0),W(f?{...n,location:f.name,slot:c,currentLocation:f,currentSlot:c}:null)}catch(te){console.error("Error moving inventory boat:",te),alert("Failed to move boat. Please try again.")}$(!1);return}let k=[...t];if(n.location){const te=t.find(me=>me.name===n.location);if(te)if(te.type==="pool"){const me=te.pool_boats||te.poolBoats||[],pe={...te,pool_boats:me.filter(je=>je!==n.id)};k=k.map(je=>je.id===te.id?pe:je)}else{const me={...te,boats:{...te.boats}},pe=Object.keys(me.boats).find(je=>me.boats[je]===n.id);pe&&delete me.boats[pe],k=k.map(je=>je.id===te.id?me:je)}}let F={...n};if(f)if(f.type==="pool"){const te=f.pool_boats||f.poolBoats||[],me={...f,pool_boats:[...te,n.id]};k=k.map(pe=>pe.id===f.id?me:pe),F.location=f.name,F.slot="pool"}else{const te=k.find(De=>De.id===f.id),me={...te,boats:{...te.boats,[c]:n.id}};k=k.map(De=>De.id===f.id?me:De);const[pe,je]=c.split("-").map(Number);F.location=f.name,F.slot=`${pe+1}-${je+1}`}else F.location=null,F.slot=null;try{await a(k),await r(l.map(me=>me.id===n.id?F:me));const te=f?k.find(me=>me.id===f.id):null;W({...F,currentLocation:te,currentSlot:c})}catch(te){console.error("Error moving boat:",te),alert("Failed to move boat. Please try again.")}$(!1)},i=new Set;t.forEach(n=>{Object.values(n.boats||{}).forEach(f=>i.add(f)),(n.pool_boats||n.poolBoats||[]).forEach(f=>i.add(f))});const _=l.filter(n=>n.status!=="archived"&&!i.has(n.id)),ne=[...s].sort((n,f)=>(n.sort_order||0)-(f.sort_order||0)).map(n=>{const f=t.filter(c=>c.site_id===n.id);return{site:n,racks:f.filter(c=>c.type==="rack-building"),parking:f.filter(c=>c.type==="parking-lot"),workshops:f.filter(c=>c.type==="shop"),pools:f.filter(c=>c.type==="pool")}}),ce=t.filter(n=>!n.site_id),be=ce.filter(n=>n.type==="rack-building"),j=ce.filter(n=>n.type==="parking-lot"),C=ce.filter(n=>n.type==="shop"),M=ce.filter(n=>n.type==="pool");return e.jsxs("div",{className:"space-y-6 animate-slide-in",children:[K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-40",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Updating boat location..."})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Storage Locations"}),e.jsx("p",{className:"text-slate-600",children:"Manage boat storage facilities and site organization"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[((d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager")&&e.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors shadow-md",children:[e.jsx(We,{className:"w-5 h-5"}),"Add Location"]}),((d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager")&&e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors shadow-md",children:[e.jsx(et,{className:"w-5 h-5"}),"Manage Sites"]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"How to use:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Drag & Drop:"})," Drag boats from unassigned or between slots to organize"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Click Boats:"})," Click on any boat to view details and remove from location"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Click Empty Slots:"})," Click empty slots to assign a boat"]})]})]})]})}),ne.map(({site:n,racks:f,parking:c,workshops:k,pools:F})=>{const te=z.has(n.id),me=f.length+c.length+k.length+F.length;return me===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-indigo-100 border-2 border-indigo-200 rounded-xl p-4 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>ge(n.id),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(nl,{className:`w-6 h-6 text-indigo-600 transition-transform flex-shrink-0 ${te?"rotate-180":""}`}),e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(et,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:n.name}),e.jsxs("p",{className:"text-sm text-slate-600",children:[me," location",me!==1?"s":""]})]})]})}),te&&e.jsxs("div",{className:"space-y-6 pl-4 border-l-4 border-indigo-200",children:[f.length>0&&e.jsx(Ke,{title:"Rack Buildings",icon:dt,color:"blue",locations:f,boats:l,onSlotClick:J,onBoatClick:pe=>W(pe),onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?v:void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?U:void 0,onDragStart:oe,onDrop:Z,onDragEnd:b,draggingBoat:E,onMaximize:q,currentUser:d}),c.length>0&&e.jsx(Ke,{title:"Parking Lots",icon:Ae,color:"purple",locations:c,boats:l,onSlotClick:J,onBoatClick:pe=>W(pe),onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?v:void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?U:void 0,onDragStart:oe,onDrop:Z,onDragEnd:b,draggingBoat:E,onMaximize:q,currentUser:d}),k.length>0&&e.jsx(Ke,{title:"Service Workshops",icon:st,color:"orange",locations:k,boats:l,onSlotClick:J,onBoatClick:pe=>W(pe),onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?v:void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?U:void 0,onDragStart:oe,onDrop:Z,onDragEnd:b,draggingBoat:E,onMaximize:q,currentUser:d}),F.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-teal-600 rounded-lg flex items-center justify-center",children:e.jsx(Ne,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"Pools"})]}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:F.map(pe=>e.jsx(jt,{location:pe,boats:l,onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?()=>v(pe):void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?()=>U(pe.id):void 0,onDragStart:oe,onDrop:ue,onDragEnd:b,isDragging:!!E,onBoatClick:je=>{W(je)},onAddBoat:()=>{G(pe),le("pool"),se(!0)},currentUser:d},pe.id))})]})]})]},n.id)}),ce.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-50 to-slate-100 border-2 border-slate-300 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-slate-400 to-slate-500 rounded-lg flex items-center justify-center",children:e.jsx(Ae,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"Unassigned Locations"}),e.jsxs("p",{className:"text-sm text-slate-600",children:[ce.length," location",ce.length!==1?"s":""," without a site"]})]})]})}),e.jsxs("div",{className:"space-y-6 pl-4 border-l-4 border-slate-300",children:[be.length>0&&e.jsx(Ke,{title:"Rack Buildings",icon:dt,color:"blue",locations:be,boats:l,onSlotClick:J,onBoatClick:n=>W(n),onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?v:void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?U:void 0,onDragStart:oe,onDrop:Z,onDragEnd:b,draggingBoat:E,onMaximize:q,currentUser:d}),j.length>0&&e.jsx(Ke,{title:"Parking Lots",icon:Ae,color:"purple",locations:j,boats:l,onSlotClick:J,onBoatClick:n=>W(n),onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?v:void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?U:void 0,onDragStart:oe,onDrop:Z,onDragEnd:b,draggingBoat:E,onMaximize:q,currentUser:d}),C.length>0&&e.jsx(Ke,{title:"Service Workshops",icon:st,color:"orange",locations:C,boats:l,onSlotClick:J,onBoatClick:n=>W(n),onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?v:void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?U:void 0,onDragStart:oe,onDrop:Z,onDragEnd:b,draggingBoat:E,onMaximize:q,currentUser:d}),M.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-teal-600 rounded-lg flex items-center justify-center",children:e.jsx(Ne,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"Pools"})]}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:M.map(n=>e.jsx(jt,{location:n,boats:l,onEdit:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?()=>v(n):void 0,onDelete:(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="manager"?()=>U(n.id):void 0,onDragStart:oe,onDrop:ue,onDragEnd:b,isDragging:!!E,onBoatClick:f=>{W(f)},onAddBoat:()=>{G(n),le("pool"),se(!0)},currentUser:d},n.id))})]})]})]}),t.length===0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 border border-slate-200 text-center",children:[e.jsx(Ae,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"No storage locations yet"}),e.jsx("button",{onClick:()=>P(!0),className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors",children:"Create First Location"})]}),N&&e.jsx(Mt,{location:null,sites:s,onSave:xe,onCancel:()=>P(!1)}),T&&e.jsx(Mt,{location:T,sites:s,onSave:ye,onCancel:()=>v(null)}),I&&e.jsx(is,{boats:_,allBoats:l,locations:t,onAssign:Q,onCreateBoat:ie,onImportBoat:fe,onCancel:()=>{se(!1),G(null),le(null)}}),L&&L.isInventory&&e.jsx(xt,{boat:L,locations:t,sites:s,boats:l,inventoryBoats:H,onMoveBoat:h,onUpdateBoat:S,onClose:()=>W(null)}),L&&!L.isInventory&&e.jsx(ut,{boat:L,locations:t,sites:s,boats:l,inventoryBoats:H,onRemove:()=>X(L),onUpdateBoat:S,onMoveBoat:h,onClose:()=>W(null),currentUser:d}),g&&e.jsx(cs,{location:g,boats:D,inventoryBoats:H,onSlotClick:J,onBoatClick:re,onDragStart:oe,onDrop:Z,onDragEnd:b,draggingBoat:E,onClose:()=>q(null)}),V&&e.jsx(Rl,{sites:s,locations:t,onAddSite:m,onUpdateSite:p,onDeleteSite:u,onReorderSites:w,onClose:()=>y(!1)})]})}function Wl({boats:t,locations:s,onUpdateBoats:l,onUpdateLocations:a}){const[r,o]=x.useState(null),[m,p]=x.useState(""),[u,w]=x.useState(""),[d,D]=x.useState(!1),[H,N]=x.useState(!1),[P,T]=x.useState(!1),[v,I]=x.useState(null),[se,V]=x.useState(!1),[y,A]=x.useState(""),[G,Y]=x.useState(0),[le,L]=x.useState(!1),[W,K]=x.useState(""),[$,g]=x.useState(0),[q,z]=x.useState(!1),[O,B]=x.useState(""),[X,ae]=x.useState([]),E=x.useRef(null),ee=x.useRef(null),oe=x.useRef(null),b=x.useRef(null),Z=x.useRef(!1),ue=x.useRef(!1);x.useEffect(()=>{(async()=>{if(!(!H||P)){console.log("[Camera] Initializing camera...");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Camera access is not supported on this browser. Please use a modern browser like Chrome, Safari, or Firefox."),N(!1);return}console.log("[Camera] Requesting camera permission...");const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});console.log("[Camera] Stream obtained:",i),console.log("[Camera] Video tracks:",i.getVideoTracks()),oe.current=i,E.current?(console.log("[Camera] Setting video source..."),E.current.srcObject=i,E.current.onloadedmetadata=()=>{console.log("[Camera] Video metadata loaded, playing..."),E.current.play().then(()=>{console.log("[Camera] Video playing successfully"),ue.current=!0,T(!0)}).catch(_=>{console.error("[Camera] Video play error:",_),alert("Failed to start video playback: "+_.message),N(!1)})}):(console.error("[Camera] videoRef.current is null!"),alert("Camera initialization error. Please try again."),N(!1))}catch(i){console.error("Camera access error:",i),N(!1);let _="Camera access failed. ";i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?_+="Permission denied. Please allow camera access in your browser settings.":i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?_+="No camera found on this device.":i.name==="NotReadableError"||i.name==="TrackStartError"?_+="Camera is already in use by another application.":i.name==="OverconstrainedError"?_+="Camera does not meet the requirements.":i.name==="NotSupportedError"?_+="Camera access requires HTTPS connection.":_+="Please check your browser permissions and try again. Error: "+i.message,alert(_)}}})()},[H,P]);const ge=()=>{console.log("[Camera] Start camera button clicked"),N(!0)},xe=()=>{console.log("[Camera] Stopping camera..."),b.current&&(clearInterval(b.current),b.current=null),oe.current&&(oe.current.getTracks().forEach(i=>i.stop()),oe.current=null),E.current&&(E.current.srcObject=null),N(!1),ue.current=!1,T(!1),K("")},ye=(h=!1)=>{const i=E.current,_=ee.current;if(i&&_){const de=_.getContext("2d"),ne=i.videoWidth*.8,ce=i.videoHeight*.15,be=(i.videoWidth-ne)/2,j=(i.videoHeight-ce)/2;_.width=ne,_.height=ce,de.drawImage(i,be,j,ne,ce,0,0,ne,ce);const C=_.toDataURL("image/jpeg",.9);return h||(I(C),xe()),C}return null},U=async()=>{if(!(Z.current||!ue.current||!E.current)){Z.current=!0,K("Scanning...");try{const h=ye(!0);if(!h){Z.current=!1;return}const{data:i,error:_}=await R.functions.invoke("ocr-hull-id",{body:{imageBase64:h}});if(_){console.log("Auto-scan OCR error:",_.message),K("Scanning..."),Z.current=!1;return}if(!i.success||!i.text){K("Point at Hull ID tag..."),Z.current=!1;return}const de=i.text,ne=i.confidence||0;de.length===12&&ne>=70?(console.log("Auto-scan found valid Hull ID:",de,"confidence:",ne),xe(),I(h),A(de),Y(ne),await re(de)):de.length>=8?K(`Detected: ${de} (${de.length}/12 chars)`):de.length>0?K(`Reading: ${de}...`):K("Point at Hull ID tag...")}catch(h){console.log("Auto-scan error:",h.message),K("Scanning...")}finally{Z.current=!1}}};x.useEffect(()=>(P&&!b.current&&(console.log("[AutoScan] Starting auto-scan interval"),K("Point at Hull ID tag..."),b.current=setInterval(()=>{U()},2e3),setTimeout(()=>U(),500)),()=>{b.current&&(clearInterval(b.current),b.current=null)}),[P]);const J=async h=>{V(!0),A("");try{const{data:i,error:_}=await R.functions.invoke("ocr-hull-id",{body:{imageBase64:h}});if(_)throw console.error("OCR function error:",_),new Error(_.message||"OCR service error");if(!i.success)throw new Error(i.error||"Failed to process image");const de=i.text||"",ne=i.confidence||0;A(de),Y(ne),de.length>=8?await re(de):(alert("Could not read a valid Hull ID. Please try again or use manual search."),z(!0))}catch(i){console.error("OCR error:",i),alert("Failed to process image. Please try again."),z(!0)}finally{V(!1)}},re=async h=>{try{L(!0);let i=await Ce.getByHullId(h);i||(i=await kt.getByHullId(h)),i?(o(i),D(!0),i.status==="archived"?A(`✓ Found: ${i.name} (ARCHIVED)`):A(`✓ Found: ${i.name}`)):(alert(`No boat found with Hull ID: ${h}
Use manual search below.`),z(!0),B(h))}catch(i){console.error("Search error:",i),alert("Error searching for boat. Please try again.")}finally{L(!1)}},ie=async()=>{const h=O.trim();if(!h){alert("Please enter a search term");return}L(!0);try{const{data:i,error:_}=await R.from("boats").select("*").or(`name.ilike.%${h}%,owner.ilike.%${h}%,hull_id.ilike.%${h}%,model.ilike.%${h}%`).neq("status","archived").limit(20);_&&console.error("Customer boat search error:",_);const{data:de,error:ne}=await R.from("inventory_boats").select("*").or(`name.ilike.%${h}%,hull_id.ilike.%${h}%,model.ilike.%${h}%,manufacturer.ilike.%${h}%`).limit(20);ne&&console.error("Inventory boat search error:",ne);const ce=[...(i||[]).map(be=>({...be,hullId:be.hull_id,boatType:"customer"})),...(de||[]).map(be=>({...be,hullId:be.hull_id,boatType:"inventory"}))];ae(ce),ce.length===0&&alert(`No boats found matching "${h}"`)}catch(i){console.error("Search error:",i),alert("Error searching. Please try again.")}finally{L(!1)}},fe=h=>{o(h),D(!0),z(!1),ae([]),B("")},Q=async()=>{if(!r||!m){alert("Please select a location");return}const h=r.status==="archived";if(h&&!window.confirm(`"${r.name}" is currently archived.

Moving it to a location will unarchive it and set status to "Needs Approval".

Do you want to continue?`))return;const i=s.find(ce=>ce.name===m);if(!i)return;if(r.location){const ce=s.find(be=>be.name===r.location);if(ce&&r.slot){const be={...ce,boats:{...ce.boats}};delete be.boats[r.slot],await a(s.map(j=>j.id===ce.id?be:j))}}let _=u;if(!_){const ce=i.layout==="u-shaped";let be=null;for(let j=0;j<i.rows&&!be;j++)for(let C=0;C<i.columns&&!be;C++){const M=`${j}-${C}`;if(ce){const n=C===0,f=C===i.columns-1,c=j===i.rows-1;if(!(n||f||c))continue}i.boats&&i.boats[M]||(be=M)}if(be)_=be;else{alert("No available slots in this location");return}}const de={...i,boats:{...i.boats,[_]:r.id}};h?await ze.unarchiveBoat(r.id,{targetStatus:"needs-approval",location:i.name,slot:_}):await Ce.update(r.id,{location:i.name,slot:_}),await a(s.map(ce=>ce.id===i.id?de:ce));const ne=await Ce.getAll();l(ne),alert(`✓ ${r.name} moved to ${i.name} (${_})`),S()},S=()=>{xe(),o(null),p(""),w(""),D(!1),I(null),A(""),Y(0),ae([])};return e.jsxs("div",{className:"space-y-6 animate-slide-in",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Scan Hull ID Tag"}),e.jsx("p",{className:"text-slate-600",children:"Use your camera to scan the boat's Hull ID tag"})]}),!d&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 border border-slate-200",children:[!v&&!H&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(vt,{className:"w-16 h-16 text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Point your camera at the boat's Hull ID tag"}),e.jsx("button",{onClick:ge,disabled:le,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-slate-300 transition-colors",children:"Open Camera"})]}),H&&e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:E,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full rounded-lg"}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[42.5%] bg-black/50"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[42.5%] bg-black/50"}),e.jsx("div",{className:"absolute top-[42.5%] bottom-[42.5%] left-0 w-[10%] bg-black/50"}),e.jsx("div",{className:"absolute top-[42.5%] bottom-[42.5%] right-0 w-[10%] bg-black/50"}),e.jsxs("div",{className:"absolute border-2 border-blue-400 rounded-lg",style:{width:"80%",height:"15%",top:"42.5%",left:"10%"},children:[e.jsx("div",{className:"absolute -top-1 -left-1 w-6 h-6 border-t-4 border-l-4 border-blue-400 rounded-tl-lg"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 border-t-4 border-r-4 border-blue-400 rounded-tr-lg"}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-6 h-6 border-b-4 border-l-4 border-blue-400 rounded-bl-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 border-b-4 border-r-4 border-blue-400 rounded-br-lg"})]})]}),e.jsx("div",{className:"absolute bottom-20 left-0 right-0 text-center",children:e.jsx("div",{className:`inline-block px-4 py-2 rounded-full text-white text-sm font-medium ${W.includes("Detected")?"bg-green-600":"bg-black/70"}`,children:W||"Initializing camera..."})}),e.jsx("div",{className:"absolute top-4 left-0 right-0 text-center",children:e.jsx("div",{className:"inline-block px-4 py-2 bg-black/70 rounded-full text-white text-sm",children:"Position Hull ID tag in the box"})})]}),e.jsxs("div",{className:"mt-4 flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>{const h=ye(!1);h&&J(h)},disabled:se,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-slate-400 transition-colors",children:"Capture Now"}),e.jsx("button",{onClick:xe,className:"px-6 py-3 bg-slate-500 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"Cancel"})]})]}),se&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Reading Hull ID..."})]}),v&&!se&&e.jsxs("div",{children:[e.jsx("img",{src:v,alt:"Captured",className:"w-full rounded-lg mb-4"}),y&&e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg mb-4",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Detected Hull ID:"}),e.jsx("p",{className:"text-2xl font-mono font-bold text-slate-900",children:y}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Confidence: ",Math.round(G),"%"]})]}),e.jsx("button",{onClick:()=>{I(null),A(""),ge()},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Scan Again"})]}),q&&e.jsxs("div",{className:"mt-6 border-t border-slate-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Manual Search"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",value:O,onChange:h=>B(h.target.value),onKeyPress:h=>h.key==="Enter"&&ie(),placeholder:"Search by name, owner, or Hull ID...",className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:ie,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Search"})]}),X.length>0&&e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:X.map(h=>e.jsxs("button",{onClick:()=>fe(h),className:"w-full p-3 border border-slate-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-bold text-slate-900",children:h.name}),h.boatType==="inventory"&&e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded",children:"Inventory"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:[h.model," ",h.owner?`• ${h.owner}`:h.manufacturer?`• ${h.manufacturer}`:""]}),h.hullId&&e.jsxs("p",{className:"text-xs text-slate-500 font-mono mt-1",children:["Hull ID: ",h.hullId]})]},`${h.boatType}-${h.id}`))})]}),e.jsx("canvas",{ref:ee,style:{display:"none"}})]}),d&&r&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:`status-${r.status} p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(Ne,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:r.name}),e.jsxs("p",{className:"text-white/90",children:[r.model,r.hullId&&e.jsxs(e.Fragment,{children:[" • ",e.jsxs("span",{className:"font-mono text-sm",children:["Hull: ",r.hullId]})]})]})]})]}),e.jsx("button",{onClick:S,className:"p-3 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-6 h-6 text-white"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900 mb-4",children:"Current Location"}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg border-2 border-slate-200",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Currently At"}),e.jsx("p",{className:"text-xl font-bold text-slate-900",children:r.location?e.jsxs(e.Fragment,{children:[r.location," ",e.jsxs("span",{className:"text-slate-600",children:["• Slot ",r.slot]})]}):e.jsx("span",{className:"text-orange-600",children:"Not Assigned"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900 mb-4",children:"Move To New Location"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Location"}),e.jsxs("select",{value:m,onChange:h=>{p(h.target.value),w("")},className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg",children:[e.jsx("option",{value:"",children:"Choose a location..."}),s.map(h=>{const i=Object.keys(h.boats).length,de=(h.layout==="u-shaped"?h.rows*2+h.columns:h.rows*h.columns)-i;return e.jsxs("option",{value:h.name,children:[h.name," (",de," slots available)"]},h.id)})]})]}),m&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Slot will be auto-assigned to first available position."]})}),e.jsxs("button",{onClick:Q,disabled:!m||le,className:"w-full px-6 py-4 bg-green-600 hover:bg-green-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold text-lg rounded-lg transition-colors shadow-md",children:["✓ Confirm Move to ",m||"Location"]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Boat Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600",children:"Owner"}),e.jsx("p",{className:"font-semibold text-slate-900",children:r.owner})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600",children:"Status"}),e.jsx("p",{className:"font-semibold text-slate-900 capitalize",children:r.status.replace(/-/g," ")})]})]})]}),e.jsx("button",{onClick:S,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white font-semibold rounded-lg transition-colors",children:"Scan Another Boat"})]})]})]})}function ql({locations:t,sites:s=[],boats:l,userPreferences:a,currentUser:r,onSavePreferences:o,onUpdateLocations:m,onUpdateBoats:p,onMoveBoat:u}){const[w,d]=x.useState(a.selectedLocations||t.map(j=>j.id)),[D,H]=x.useState(a.locationOrder||t.map(j=>j.id)),[N,P]=x.useState(null),[T,v]=x.useState(!1),[I,se]=x.useState(!1),[V,y]=x.useState(!1),[A,G]=x.useState(!1),[Y,le]=x.useState(null),[L,W]=x.useState(null),[K,$]=x.useState(null),[g,q]=x.useState(null),z=x.useRef(0),{removeBoat:O}=at({onMoveBoat:u,onSuccess:()=>$(null)}),{assignBoat:B}=ns({onMoveBoat:u,onSuccess:()=>{G(!1),le(null),W(null),y(!1)}}),{draggingBoat:X,isDragging:ae,handleDragStart:E,handleDragEnd:ee,handleGridDrop:oe,handlePoolDrop:b}=os({onMoveBoat:u});x.useEffect(()=>{if(K){const j=l.find(C=>C.id===K.id);j&&JSON.stringify(j)!==JSON.stringify(K)&&$({...j,currentLocation:K.currentLocation,currentSlot:K.currentSlot})}},[l]),x.useEffect(()=>{const j=M=>{z.current=M.clientY},C=M=>{var n;(n=M.touches)!=null&&n[0]&&(z.current=M.touches[0].clientY)};return window.addEventListener("mousemove",j),window.addEventListener("touchmove",C,{passive:!0}),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("touchmove",C)}},[]),x.useEffect(()=>{if(!ae)return;console.log("MyView auto-scroll started - isDragging:",ae);const j=setInterval(()=>{const C=z.current,M=window.innerHeight,n=100,f=15;console.log("MyView checking scroll - mouseY:",C,"windowHeight:",M),C<n?(console.log("MyView scrolling UP"),window.scrollBy({top:-f,behavior:"auto"})):C>M-n&&(console.log("MyView scrolling DOWN"),window.scrollBy({top:f,behavior:"auto"}))},16);return()=>{console.log("MyView auto-scroll stopped"),clearInterval(j)}},[ae]),x.useEffect(()=>{if(a.selectedLocations?d(a.selectedLocations):t.length>0&&d(t.map(j=>j.id)),a.locationOrder&&a.locationOrder.length>0){const j=new Set(a.locationOrder),C=[...a.locationOrder];t.forEach(M=>{j.has(M.id)||C.push(M.id)}),H(C)}else t.length>0&&H(t.map(j=>j.id))},[t,a]);const Z=j=>{const C=w.includes(j)?w.filter(M=>M!==j):[...w,j];d(C),v(!0)},ue=(j,C)=>{P(C),j.dataTransfer.effectAllowed="move"},ge=j=>{j.preventDefault(),j.dataTransfer.dropEffect="move"},xe=(j,C)=>{if(j.preventDefault(),!N||N===C)return;const M=[...D],n=M.indexOf(N),f=M.indexOf(C);M.splice(n,1),M.splice(f,0,N),H(M),P(null),v(!0)},ye=()=>{o({selectedLocations:w,locationOrder:D}),v(!1),se(!1)},U=()=>{const j=t.map(M=>M.id),C=t.map(M=>M.id);d(j),H(C),v(!0)};x.useEffect(()=>{if(g){const j=t.find(C=>C.id===g.id);j&&JSON.stringify(j.boats)!==JSON.stringify(g.boats)&&q(j)}},[t,g]);const J=(j,C,M)=>{const n=`${C}-${M}`,f=j.boats?j.boats[n]:null;if(f){const c=l.find(k=>k.id===f);c&&$({...c,currentLocation:j,currentSlot:n})}else le(j),W({row:C,col:M,slotId:n}),G(!0)},re=j=>{$(j)},ie=async j=>{const C={...j,id:`boat-${Date.now()}`,qrCode:`BBG-${Date.now().toString(36).toUpperCase()}`,status:j.status||"needs-approval",mechanicalsComplete:!1,cleanComplete:!1,fiberglassComplete:!1,warrantyComplete:!1},M=[...l,C];return await p(M),C},fe=async j=>{try{const C={...j,qr_code:j.qrCode||`BBG-${Date.now().toString(36).toUpperCase()}`,status:j.status||"needs-approval",mechanicals_complete:!1,clean_complete:!1,fiberglass_complete:!1,warranty_complete:!1},M=await ze.importOrUpdateBoat(C,{targetStatus:"needs-approval",preserveLocation:!1});console.log("[MyViewEditor] Boat saved to database:",M.id);const n=[...l.filter(f=>f.id!==M.id),M];return await p(n),M}catch(C){throw console.error("[MyViewEditor] Error importing boat:",C),C}},Q=async j=>{if(!Y||V)return;y(!0);const C=typeof j=="object"?j:l.find(f=>f.id===j);if(!C){console.error("[Assign] Boat not found:",j),y(!1);return}let M=null;if(Y.type==="pool")M="pool";else{if(!L){console.error("[Assign] No slot selected for grid assignment"),y(!1);return}if(typeof L.row!="number"||typeof L.col!="number"){console.error("[MyView Assign] Invalid slot coordinates:",L),alert("Invalid slot selection. Please try again."),y(!1);return}M=L.slotId}const n=window.scrollY;await B(C,Y.id,M,C.isInventory),setTimeout(()=>{window.scrollTo(0,n)},100)},S=async(j,C,M)=>{if(y(!0),j.isInventory&&u){try{await u(j.id,(C==null?void 0:C.id)||null,M||null,!0),$(C?{...j,location:C.name,slot:M,currentLocation:C,currentSlot:M}:null)}catch(c){console.error("Error moving inventory boat:",c),alert("Failed to move boat. Please try again.")}y(!1);return}let n=[...t];if(j.location){const c=t.find(k=>k.name===j.location);if(c)if(c.type==="pool"){const k=c.pool_boats||c.poolBoats||[],F={...c,pool_boats:k.filter(te=>te!==j.id)};n=n.map(te=>te.id===c.id?F:te)}else{const k={...c,boats:{...c.boats}},F=Object.keys(k.boats).find(te=>k.boats[te]===j.id);F&&delete k.boats[F],n=n.map(te=>te.id===c.id?k:te)}}let f={...j};if(C)if(C.type==="pool"){const c=C.pool_boats||C.poolBoats||[],k={...C,pool_boats:[...c,j.id]};n=n.map(F=>F.id===C.id?k:F),f.location=C.name,f.slot="pool"}else{const c=n.find(me=>me.id===C.id),k={...c,boats:{...c.boats,[M]:j.id}};n=n.map(me=>me.id===C.id?k:me);const[F,te]=M.split("-").map(Number);f.location=C.name,f.slot=`${F+1}-${te+1}`}else f.location=null,f.slot=null;try{await m(n),await p(l.map(k=>k.id===j.id?f:k));const c=C?n.find(k=>k.id===C.id):null;$({...f,currentLocation:c,currentSlot:M})}catch(c){console.error("Error moving boat:",c),alert("Failed to move boat. Please try again.")}y(!1)},h=new Set;t.forEach(j=>{Object.values(j.boats).forEach(C=>h.add(C))});const i=l.filter(j=>j.status!=="archived"&&!h.has(j.id)),_=D.map(j=>t.find(C=>C.id===j)).filter(Boolean),de=new Set(D),ne=t.filter(j=>!de.has(j.id)),ce=[..._,...ne],be=ce.filter(j=>w.includes(j.id));return e.jsxs("div",{className:"space-y-6 animate-slide-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"My View"}),e.jsx("p",{className:"text-slate-600",children:"Your personalized location dashboard"})]}),e.jsxs("button",{onClick:()=>se(!I),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-md",children:[e.jsx(st,{className:"w-5 h-5"}),I?"Hide Customizer":"Customize View"]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(yt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"Personal Workspace"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["Showing ",be.length," of ",t.length,' locations based on your preferences. Click "Customize View" to change which locations appear here.']})]})]})}),I&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md border-2 border-blue-300 overflow-hidden animate-slide-in",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Customize Your View"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Check locations to show, uncheck to hide • Drag to reorder"})]}),T&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:U,className:"px-4 py-2 border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-white transition-colors",children:"Reset"}),e.jsx("button",{onClick:ye,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-md",children:"Save Changes"})]})]})}),e.jsx("div",{className:"p-4 space-y-2",children:ce.map(j=>e.jsxs("div",{draggable:!0,onDragStart:C=>ue(C,j.id),onDragOver:ge,onDrop:C=>xe(C,j.id),className:`flex items-center gap-4 p-4 rounded-lg border-2 transition-all cursor-move ${N===j.id?"border-blue-400 bg-blue-50 opacity-50":"border-slate-200 bg-white hover:border-slate-300 hover:shadow-sm"}`,children:[e.jsx("div",{className:"flex-shrink-0 text-slate-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8h16M4 16h16"})})}),e.jsx("input",{type:"checkbox",checked:w.includes(j.id),onChange:()=>Z(j.id),className:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 cursor-pointer",onClick:C=>C.stopPropagation()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:j.name}),e.jsxs("p",{className:"text-sm text-slate-600 capitalize",children:[j.type," • ",j.rows," × ",j.columns,j.layout==="u-shaped"&&" (U-shaped)"]})]}),w.includes(j.id)?e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full flex-shrink-0",children:"Visible"}):e.jsx("span",{className:"px-3 py-1 bg-slate-100 text-slate-500 text-xs font-medium rounded-full flex-shrink-0",children:"Hidden"})]},j.id))})]}),be.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"My Locations"}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",be.length," location",be.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:be.map(j=>{if(j.type==="pool"){const C=(j.pool_boats||[]).map(M=>l.find(n=>n.id===M)).filter(Boolean);return e.jsx(jt,{location:j,boats:C,onBoatClick:M=>{$({...M,currentLocation:j,currentSlot:"pool"})},onAddBoat:()=>{le(j),W("pool"),G(!0)},isDragging:ae,onDragStart:(M,n)=>E(M,n,j,"pool"),onDragEnd:ee,onDragOver:M=>M.preventDefault(),onDrop:()=>b(j.id)},j.id)}return e.jsx(ds,{location:j,boats:l.filter(C=>!C.isInventory),inventoryBoats:l.filter(C=>C.isInventory),onSlotClick:(C,M,n)=>{const f=`${M}-${n}`;le(j),W({row:M,col:n,slotId:f}),G(!0)},onBoatClick:C=>{const M=Object.keys(j.boats||{}).find(n=>j.boats[n]===C.id);$({...C,currentLocation:j,currentSlot:M})},draggingBoat:X,onDragStart:(C,M,n,f)=>E(C,M,j,f),onDragEnd:ee,onDrop:(C,M,n,f)=>oe(C,j,n,f),onMaximize:()=>{const C=t.find(M=>M.id===j.id);q(C||j)}},j.id)})})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 border border-slate-200 text-center",children:[e.jsx(Ae,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500 mb-2",children:"No locations in your view"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:'Click "Customize View" to select locations to display'}),e.jsx("button",{onClick:()=>se(!0),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Customize View"})]}),T&&I&&e.jsxs("div",{className:"fixed bottom-6 right-6 bg-orange-500 text-white px-6 py-3 rounded-lg shadow-lg animate-slide-in",children:[e.jsx("p",{className:"font-medium",children:"You have unsaved changes"}),e.jsx("p",{className:"text-sm opacity-90",children:'Click "Save Changes" to apply'})]}),A&&e.jsx(is,{boats:i,allBoats:l.filter(j=>j.status!=="archived"),locations:t,onAssign:Q,onCreateBoat:ie,onImportBoat:fe,onCancel:()=>{G(!1),le(null),W(null)}}),K&&K.isInventory&&e.jsx(xt,{boat:K,locations:t,sites:s,onMoveBoat:S,onUpdateBoat:j=>{const C=l.map(M=>M.id===j.id?j:M);p(C),$(j)},onClose:()=>$(null)}),K&&!K.isInventory&&e.jsx(ut,{boat:K,locations:t,sites:s,boats:l,inventoryBoats:[],onRemove:()=>O(K),onUpdateBoat:j=>{const C=l.map(M=>M.id===j.id?j:M);p(C),$(j)},onMoveBoat:S,onClose:()=>$(null),currentUser:r}),g&&e.jsx(cs,{location:g,boats:l.filter(j=>!j.isInventory),inventoryBoats:l.filter(j=>j.isInventory),onSlotClick:J,onBoatClick:re,onDragStart:E,onDrop:oe,onDragEnd:ee,draggingBoat:X,onClose:()=>q(null)})]})}function Hl({boat:t,onView:s,locations:l=[]}){const r={HA:{label:"On Hand Available",color:"bg-green-500"},HS:{label:"On Hand Sold",color:"bg-emerald-600"},OA:{label:"On Order Available",color:"bg-blue-500"},OS:{label:"On Order Sold",color:"bg-blue-600"},FA:{label:"Future Available",color:"bg-amber-500"},FS:{label:"Future Sold",color:"bg-amber-600"},S:{label:"Sold",color:"bg-purple-500"},R:{label:"Reserved",color:"bg-indigo-500"},FP:{label:"Floor Planned",color:"bg-slate-500"}}[t.salesStatus]||{label:t.salesStatus||"Unknown",color:"bg-slate-400"},{enrichedBoat:o}=ss(t,l),{displayLocation:m,displaySlot:p}=_t(o,l);return e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:`${r.color} p-3`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-semibold text-sm",children:r.label}),e.jsx("span",{className:"text-white text-xs opacity-90 font-mono",children:t.qrCode||`INV-${t.dockmasterId}`})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-1",children:t.name}),e.jsxs("p",{className:"text-slate-600 text-sm mb-3",children:[t.year," ",t.model]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("span",{children:t.make||"Unknown Make"})]}),o.location&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsxs("span",{children:[m,p&&` • ${p}`]})]}),t.hullId&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})}),e.jsx("span",{className:"font-mono text-xs",children:t.hullId})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full",children:"Inventory"}),t.length&&e.jsx("span",{className:"px-2 py-1 bg-slate-100 text-slate-600 text-xs font-medium rounded-full",children:t.length}),e.jsx("span",{className:`px-2 py-1 text-xs font-bold rounded-full ${r.color} text-white`,children:t.salesStatus})]})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200",children:e.jsxs("button",{onClick:s,className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 font-medium rounded-lg transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4"}),"View Details"]})})]})]})}function zl({inventoryBoats:t,boats:s=[],locations:l,sites:a=[],lastSync:r,onSyncNow:o,dockmasterConfig:m,onUpdateInventoryBoats:p,onUpdateSingleBoat:u,onMoveBoat:w,currentUser:d}){const[D,H]=x.useState(""),[N,P]=x.useState(null),[T,v]=x.useState(!1),[I,se]=x.useState("all"),[V,y]=x.useState("all"),[A,G]=x.useState("all"),[Y,le]=x.useState("all");at({onMoveBoat:w,onSuccess:()=>P(null)}),x.useEffect(()=>{if(N&&N.id){const E=t.find(ee=>ee.id===N.id);E&&P(ee=>({...E,currentLocation:ee==null?void 0:ee.currentLocation,currentSlot:ee==null?void 0:ee.currentSlot}))}},[t]);const L=[...new Set(t.map(E=>E.year).filter(Boolean))].sort((E,ee)=>ee-E),W=[...new Set(t.map(E=>E.make).filter(Boolean))].sort(),K=[...new Set(t.map(E=>E.model).filter(Boolean))].sort(),$=[...new Set(t.map(E=>E.salesStatus).filter(Boolean))].sort(),g=t.filter(E=>{var xe,ye,U,J,re,ie,fe;const ee=D.toLowerCase(),oe=((xe=E.name)==null?void 0:xe.toLowerCase().includes(ee))||((ye=E.model)==null?void 0:ye.toLowerCase().includes(ee))||((U=E.owner)==null?void 0:U.toLowerCase().includes(ee))||((J=E.hullId)==null?void 0:J.toLowerCase().includes(ee))||((re=E.hull_id)==null?void 0:re.toLowerCase().includes(ee))||((ie=E.dockmasterId)==null?void 0:ie.toLowerCase().includes(ee))||((fe=E.dockmaster_id)==null?void 0:fe.toLowerCase().includes(ee)),b=I==="all"||E.year===parseInt(I),Z=V==="all"||E.make===V,ue=A==="all"||E.model===A,ge=Y==="all"||E.salesStatus===Y;return oe&&b&&Z&&ue&&ge}),q=async()=>{v(!0),await o(!0),v(!1)},z=E=>{P(E)},O=async E=>{if(P(E),u){const ee=t.find(oe=>oe.id===E.id);if(ee){const oe={};for(const b in E)JSON.stringify(E[b])!==JSON.stringify(ee[b])&&(oe[b]=E[b]);Object.keys(oe).length>0&&await u(E.id,oe)}}},B=async(E,ee,oe)=>{w&&(await w(E.id,(ee==null?void 0:ee.id)||null,oe||null,!0),P(ee?{...E,location:ee.name,slot:oe,currentLocation:ee,currentSlot:oe}:{...E,location:null,slot:null,currentLocation:null,currentSlot:null}))},X=m&&m.username,ae=r?Math.floor((Date.now()-new Date(r).getTime())/6e4):null;return e.jsxs("div",{className:"space-y-6 animate-slide-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Inventory Boats"}),e.jsx("p",{className:"text-slate-600",children:"Auto-synced from Dockmaster API"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:q,disabled:T,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium rounded-lg transition-colors shadow-md",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sync Now"]})})})]}),!X&&t.length===0&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-orange-900 mb-2",children:"Dockmaster API Not Configured"}),e.jsx("p",{className:"text-orange-800 mb-4",children:"To sync inventory boats, you need to configure your Dockmaster API credentials in Settings."}),e.jsx("button",{onClick:()=>window.location.hash="settings",className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors",children:"Go to Settings"})]})]})}),t.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:"Auto-Sync: Every 30 minutes"}),e.jsx("p",{className:"text-sm text-blue-700",children:r?`Last synced ${ae} minute${ae!==1?"s":""} ago`:"Never synced - waiting for first sync"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:t.length}),e.jsx("p",{className:"text-sm text-blue-700",children:"Inventory Boats"})]})]})}),t.length>0&&e.jsx("div",{className:"bg-white rounded-xl shadow-md p-4 border border-slate-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, model, or owner...",value:D,onChange:E=>H(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Year"}),e.jsxs("select",{value:I,onChange:E=>se(E.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Years"}),L.map(E=>e.jsx("option",{value:E,children:E},E))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Make"}),e.jsxs("select",{value:V,onChange:E=>y(E.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Makes"}),W.map(E=>e.jsx("option",{value:E,children:E},E))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Model"}),e.jsxs("select",{value:A,onChange:E=>G(E.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Models"}),K.map(E=>e.jsx("option",{value:E,children:E},E))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Sales Status"}),e.jsxs("select",{value:Y,onChange:E=>le(E.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Statuses"}),$.map(E=>e.jsx("option",{value:E,children:E},E))]})]})]}),(I!=="all"||V!=="all"||A!=="all"||Y!=="all"||D)&&e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-200",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.jsxs("span",{className:"text-slate-600",children:["Showing ",g.length," of ",t.length," boats"]})}),e.jsx("button",{onClick:()=>{se("all"),y("all"),G("all"),le("all"),H("")},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Clear All Filters"})]})]})}),e.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-3",children:"How Inventory Sync Works"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-blue-600",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900 mb-1",children:"API Call"}),e.jsx("p",{className:"text-slate-600",children:"Calls Dockmaster /api/v1/UnitSales/RetrieveOtherInventory every 30 minutes"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-green-600",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900 mb-1",children:"Sales Status Filter"}),e.jsx("p",{className:"text-slate-600",children:"Only boats with approved Sales Status codes appear (HA, HS, OA, OS, FA, FS, S, R, FP)"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-purple-600",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900 mb-1",children:"Auto Update"}),e.jsx("p",{className:"text-slate-600",children:"SD (Sold Delivered) boats are automatically removed from view"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-300",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-700 mb-2",children:"Sales Status Codes:"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-blue-600",children:"HA"}),e.jsx("span",{className:"text-slate-600",children:"On Hand Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-blue-600",children:"HS"}),e.jsx("span",{className:"text-slate-600",children:"On Hand Sold"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-green-600",children:"OA"}),e.jsx("span",{className:"text-slate-600",children:"On Order Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-green-600",children:"OS"}),e.jsx("span",{className:"text-slate-600",children:"On Order Sold"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-purple-600",children:"FA"}),e.jsx("span",{className:"text-slate-600",children:"Future Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-purple-600",children:"FS"}),e.jsx("span",{className:"text-slate-600",children:"Future Sold"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-orange-600",children:"S"}),e.jsx("span",{className:"text-slate-600",children:"Sold"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-yellow-600",children:"R"}),e.jsx("span",{className:"text-slate-600",children:"Reserved"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-indigo-600",children:"FP"}),e.jsx("span",{className:"text-slate-600",children:"Floor Planned"})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2 md:col-span-1",children:[e.jsx("span",{className:"font-mono font-bold text-red-600 line-through",children:"SD"}),e.jsx("span",{className:"text-slate-500 italic",children:"Sold Delivered (hidden)"})]})]})]})]}),t.length>0&&e.jsx("div",{className:"bg-white rounded-xl shadow-md p-4 border border-slate-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, model, or hull ID...",value:D,onChange:E=>H(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),g.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 border border-slate-200 text-center",children:[e.jsx(Ne,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),t.length===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-slate-500 mb-2",children:"No inventory boats synced yet"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:'Click "Sync Now" to sync inventory boats from Dockmaster'}),e.jsx("button",{onClick:q,disabled:T,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:T?"Syncing...":"Sync Now"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-slate-500 mb-2",children:"No boats match your search"}),e.jsx("button",{onClick:()=>H(""),className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:"Clear search"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(E=>e.jsx(Hl,{boat:E,onView:()=>z(E),locations:l},E.id))}),N&&e.jsx(xt,{boat:N,locations:l,sites:a,boats:s.filter(E=>!E.isInventory),inventoryBoats:t,onMoveBoat:B,onUpdateBoat:O,onClose:()=>P(null),currentUser:d})]})}const Vl="modulepreload",Yl=function(t){return"/"+t},Pt={},Kl=function(s,l,a){let r=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),p=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));r=Promise.allSettled(l.map(u=>{if(u=Yl(u),u in Pt)return;Pt[u]=!0;const w=u.endsWith(".css"),d=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const D=document.createElement("link");if(D.rel=w?"stylesheet":Vl,w||(D.as="script"),D.crossOrigin="",D.href=u,p&&D.setAttribute("nonce",p),document.head.appendChild(D),w)return new Promise((H,N)=>{D.addEventListener("load",H),D.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(m){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=m,window.dispatchEvent(p),!p.defaultPrevented)throw m}return r.then(m=>{for(const p of m||[])p.status==="rejected"&&o(p.reason);return s().catch(o)})};var Ft={};function Rt({user:t,onSave:s,onCancel:l}){const[a,r]=x.useState(t?{...t,password:""}:{name:"",username:"",email:"",password:"",role:"user"}),[o,m]=x.useState(!1),[p,u]=x.useState(""),w=async d=>{d.preventDefault(),u(""),m(!0);try{if(t)s(a);else{if(!a.email)throw new Error("Email is required");if(!a.password||a.password.length<6)throw new Error("Password must be at least 6 characters");const{supabase:D}=await Kl(async()=>{const{supabase:v}=await Promise.resolve().then(()=>Ts);return{supabase:v}},void 0),H=Ft.REACT_APP_SUPABASE_URL,N=Ft.REACT_APP_SUPABASE_ANON_KEY,P=await fetch(`${H}/functions/v1/create-user`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N}`},body:JSON.stringify({email:a.email,password:a.password,name:a.name,username:a.username,role:a.role})});if(!P.ok){const v=await P.json();throw new Error(v.error||"Failed to create user")}const T=await P.json();console.log("User created:",T),s(T.user)}}catch(D){console.error("Error saving user:",D),u(D.message)}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 animate-slide-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:t?"Edit User":"Add New User"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-slate-100 rounded transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-slate-500"})})]}),p&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:p})}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:d=>r({...a,name:d.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Full name",required:!0,disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Username"}),e.jsx("input",{type:"text",value:a.username,onChange:d=>r({...a,username:d.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"username",required:!0,disabled:o})]}),!t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:d=>r({...a,email:d.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"user@boatsbygeorge.com",required:!0,disabled:o}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Must be a @boatsbygeorge.com email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:t?"Password (leave blank to keep current)":"Password"}),e.jsx("input",{type:"password",value:a.password,onChange:d=>r({...a,password:d.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Password",required:!t,minLength:6,disabled:o}),!t&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Minimum 6 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Role"}),e.jsxs("select",{value:a.role,onChange:d=>r({...a,role:d.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium rounded-lg transition-colors",disabled:o,children:o?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),t?"Saving...":"Creating..."]}):t?"Save Changes":"Create User"})]})]})]})})}function Gl({dockmasterConfig:t,onSaveConfig:s,currentUser:l,users:a,onUpdateUsers:r,onReloadUsers:o}){const[m,p]=x.useState(t||{username:"",password:""}),[u,w]=x.useState(!1),[d,D]=x.useState("profile"),[H,N]=x.useState(!1),[P,T]=x.useState(null),[v,I]=x.useState(!1),[se,V]=x.useState(""),[y,A]=x.useState(""),[G,Y]=x.useState(""),[le,L]=x.useState(!1),W=(l==null?void 0:l.role)==="admin",{updatePassword:K}=lt(),$=async()=>{await s(m),w(!0),setTimeout(()=>w(!1),3e3)},g=async B=>{o&&await o(),N(!1)},q=B=>{r(a.map(X=>X.id===B.id?B:X)),T(null)},z=B=>{if(B===l.id){alert("You cannot delete your own account!");return}confirm("Are you sure you want to delete this user?")&&r(a.filter(X=>X.id!==B))},O=async B=>{if(B.preventDefault(),Y(""),L(!1),se.length<6){Y("Password must be at least 6 characters");return}if(se!==y){Y("Passwords do not match");return}try{const{error:X}=await K(se);X?Y(X.message||"Failed to update password"):(L(!0),V(""),A(""),setTimeout(()=>{I(!1),L(!1)},2e3))}catch{Y("An error occurred while updating password")}};return e.jsxs("div",{className:"space-y-6 animate-slide-in",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Settings"}),e.jsx("p",{className:"text-slate-600",children:"Manage your system configuration"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-slate-200",children:[e.jsx("button",{onClick:()=>D("profile"),className:`flex-1 px-6 py-3 font-medium transition-colors ${d==="profile"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-slate-600 hover:bg-slate-50"}`,children:"My Profile"}),W&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D("users"),className:`flex-1 px-6 py-3 font-medium transition-colors ${d==="users"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-slate-600 hover:bg-slate-50"}`,children:"User Management"}),e.jsx("button",{onClick:()=>D("dockmaster"),className:`flex-1 px-6 py-3 font-medium transition-colors ${d==="dockmaster"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-slate-600 hover:bg-slate-50"}`,children:"Dockmaster API"})]})]}),e.jsxs("div",{className:"p-6",children:[d==="profile"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-6",children:"My Profile"}),e.jsxs("div",{className:"space-y-4 max-w-2xl",children:[e.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Name"}),e.jsx("p",{className:"font-semibold text-slate-900",children:l.name})]}),e.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Username"}),e.jsxs("p",{className:"font-semibold text-slate-900",children:["@",l.username]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Role"}),e.jsx("p",{className:"font-semibold text-slate-900 capitalize",children:l.role})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-slate-200",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900 mb-4",children:"Change Password"}),v?e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"New Password"}),e.jsx("input",{type:"password",value:se,onChange:B=>V(B.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter new password",required:!0,minLength:6,disabled:le}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Minimum 6 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),e.jsx("input",{type:"password",value:y,onChange:B=>A(B.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Confirm new password",required:!0,minLength:6,disabled:le})]}),G&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:G})}),le&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-700",children:"Password updated successfully!"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:le,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Update Password"}),e.jsx("button",{type:"button",onClick:()=>{I(!1),V(""),A(""),Y(""),L(!1)},disabled:le,className:"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]}):e.jsx("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Change Password"})]})]})]}),d==="users"&&W&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"User Management"}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:[e.jsx(We,{className:"w-5 h-5"}),"Add User"]})]}),e.jsx("div",{className:"space-y-3",children:a.map(B=>e.jsx("div",{className:"p-4 border border-slate-200 rounded-lg hover:border-slate-300 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Xt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:B.name}),e.jsxs("p",{className:"text-sm text-slate-600",children:["@",B.username]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${B.role==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:B.role}),e.jsx("button",{onClick:()=>T(B),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-4 h-4 text-slate-600"})}),e.jsx("button",{onClick:()=>z(B.id),className:"p-2 hover:bg-red-50 rounded-lg transition-colors",disabled:B.id===l.id,children:e.jsx(Ve,{className:`w-4 h-4 ${B.id===l.id?"text-slate-300":"text-red-600"}`})})]})]})},B.id))})]}),d==="dockmaster"&&W&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-6",children:"Dockmaster API Configuration"}),e.jsxs("div",{className:"space-y-4 max-w-2xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Username"}),e.jsx("input",{type:"text",value:m.username,onChange:B=>p({...m,username:B.target.value}),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Your Dockmaster username"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",value:m.password,onChange:B=>p({...m,password:B.target.value}),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Your Dockmaster password"})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:$,className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors shadow-md",children:"Save Configuration"})}),u&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg",children:"✓ Configuration saved successfully!"}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium mb-2",children:"About Dockmaster Integration:"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Enter your Dockmaster API credentials to enable importing customer and inventory boats directly into your system."})]})]})]})]})]}),H&&e.jsx(Rt,{user:null,onSave:g,onCancel:()=>N(!1)}),P&&e.jsx(Rt,{user:P,onSave:q,onCancel:()=>T(null)})]})}function Tt({title:t,show:s,onSave:l,onCancel:a,saving:r}){const[o,m]=x.useState({name:(s==null?void 0:s.name)||"New Boat Show",venue:(s==null?void 0:s.venue)||"",showDate:(s==null?void 0:s.showDate)||"",widthFt:(s==null?void 0:s.widthFt)||100,heightFt:(s==null?void 0:s.heightFt)||80,notes:(s==null?void 0:s.notes)||""}),p=u=>{if(u.preventDefault(),!o.name.trim()){alert("Please enter a show name");return}l(o)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:[e.jsx("div",{className:"p-6 border-b border-slate-200",children:e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:t})}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Show Name *"}),e.jsx("input",{type:"text",value:o.name,onChange:u=>m({...o,name:u.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Miami Boat Show 2026"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Venue"}),e.jsx("input",{type:"text",value:o.venue,onChange:u=>m({...o,venue:u.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Convention Center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Show Date"}),e.jsx("input",{type:"date",value:o.showDate,onChange:u=>m({...o,showDate:u.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Width (feet)"}),e.jsx("input",{type:"number",value:o.widthFt,onChange:u=>m({...o,widthFt:parseFloat(u.target.value)||100}),min:"10",max:"1000",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Height (feet)"}),e.jsx("input",{type:"number",value:o.heightFt,onChange:u=>m({...o,heightFt:parseFloat(u.target.value)||100}),min:"10",max:"1000",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:o.notes,onChange:u=>m({...o,notes:u.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional notes..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:r?"Saving...":"Save"})]})]})]})})}const Qe={boat:{label:"Boat",icon:ct,color:"#3b82f6"},dock:{label:"Dock",icon:Te,color:"#8b5cf6",defaultWidth:20,defaultHeight:6},steps:{label:"Steps",icon:Ne,color:"#f59e0b",defaultWidth:3,defaultHeight:4},plant:{label:"Plant",icon:dl,color:"#22c55e",defaultWidth:3,defaultHeight:3},furniture:{label:"Furniture",icon:sl,color:"#ec4899",defaultWidth:4,defaultHeight:4},tent:{label:"Tent/Canopy",icon:wl,color:"#06b6d4",defaultWidth:10,defaultHeight:10},banner:{label:"Banner/Sign",icon:cl,color:"#ef4444",defaultWidth:8,defaultHeight:2},table:{label:"Table",icon:bl,color:"#6366f1",defaultWidth:6,defaultHeight:3}};function Jl({inventoryBoats:t=[]}){var C,M;const[s,l]=x.useState([]),[a,r]=x.useState(null),[o,m]=x.useState([]),[p,u]=x.useState(null),[w,d]=x.useState(!0),[D,H]=x.useState(!1),[N,P]=x.useState(!1),[T,v]=x.useState(!1),[I,se]=x.useState(1),[V,y]=x.useState({x:0,y:0}),[A,G]=x.useState(!1),[Y,le]=x.useState(!0),[L,W]=x.useState("boats"),[K,$]=x.useState(""),[g,q]=x.useState(null),[z,O]=x.useState({x:0,y:0}),[B,X]=x.useState(!1),ae=x.useRef(null),E=x.useRef(null),ee=10;x.useEffect(()=>{oe()},[]),x.useEffect(()=>{a?b(a.id):m([])},[a==null?void 0:a.id]);const oe=async()=>{try{d(!0);const n=await ke.getAll();l(n),n.length>0&&!a&&r(n[0])}catch(n){console.error("Error loading shows:",n)}finally{d(!1)}},b=async n=>{try{const f=await ke.getItems(n);m(f)}catch(f){console.error("Error loading items:",f)}},Z=async n=>{try{H(!0);const f=await ke.create(n);l([...s,f]),r(f),P(!1)}catch(f){console.error("Error creating show:",f),alert("Failed to create show")}finally{H(!1)}},ue=async n=>{try{H(!0);const f=await ke.update(a.id,n);l(s.map(c=>c.id===f.id?f:c)),r(f),v(!1)}catch(f){console.error("Error updating show:",f),alert("Failed to update show")}finally{H(!1)}},ge=async n=>{if(confirm("Delete this boat show and all its items?"))try{await ke.delete(n);const f=s.filter(c=>c.id!==n);l(f),(a==null?void 0:a.id)===n&&r(f[0]||null)}catch(f){console.error("Error deleting show:",f),alert("Failed to delete show")}},xe=async n=>{if(a){if(o.some(f=>f.inventoryBoatId===n.id)){alert("This boat is already in the show layout");return}try{const f=await ke.addItem(a.id,{itemType:"boat",inventoryBoatId:n.id,x:10,y:10,rotation:0,widthFt:parseFloat(n.beam)||10,heightFt:parseFloat(n.length)||25,label:n.name,zIndex:o.length});m([...o,f]),u(f)}catch(f){console.error("Error adding boat:",f),alert("Failed to add boat to layout")}}},ye=async n=>{if(!a)return;const f=Qe[n];try{const c=await ke.addItem(a.id,{itemType:n,x:10,y:10,rotation:0,widthFt:f.defaultWidth,heightFt:f.defaultHeight,label:f.label,color:f.color,zIndex:o.length});m([...o,c]),u(c)}catch(c){console.error("Error adding item:",c),alert("Failed to add item to layout")}},U=async(n,f,c)=>{try{const k=await ke.updateItem(n,{x:f,y:c});m(o.map(F=>F.id===n?k:F)),(p==null?void 0:p.id)===n&&u(k)}catch(k){console.error("Error updating position:",k)}},J=async(n,f)=>{try{const c=await ke.updateItem(n,{rotation:f});m(o.map(k=>k.id===n?c:k)),(p==null?void 0:p.id)===n&&u(c)}catch(c){console.error("Error updating rotation:",c)}},re=async(n,f,c)=>{try{const k=await ke.updateItem(n,{widthFt:f,heightFt:c});m(o.map(F=>F.id===n?k:F)),(p==null?void 0:p.id)===n&&u(k)}catch(k){console.error("Error updating size:",k)}},ie=async n=>{try{await ke.removeItem(n),m(o.filter(f=>f.id!==n)),(p==null?void 0:p.id)===n&&u(null)}catch(f){console.error("Error deleting item:",f)}},fe=async n=>{if(n.itemType!=="boat")try{const f=await ke.addItem(a.id,{itemType:n.itemType,x:n.x+5,y:n.y+5,rotation:n.rotation,widthFt:n.widthFt,heightFt:n.heightFt,label:n.label+" (copy)",color:n.color,zIndex:o.length});m([...o,f]),u(f)}catch(f){console.error("Error duplicating:",f)}},Q=async n=>{const f=Math.max(...o.map(c=>c.zIndex||0));try{const c=await ke.updateItem(n.id,{zIndex:f+1});m(o.map(k=>k.id===n.id?c:k)),(p==null?void 0:p.id)===n.id&&u(c)}catch(c){console.error("Error updating z-index:",c)}},S=async n=>{const f=Math.min(...o.map(c=>c.zIndex||0));try{const c=await ke.updateItem(n.id,{zIndex:f-1});m(o.map(k=>k.id===n.id?c:k)),(p==null?void 0:p.id)===n.id&&u(c)}catch(c){console.error("Error updating z-index:",c)}},h=()=>a?{width:a.widthFt*ee,height:a.heightFt*ee}:{width:1e3,height:800},i=(n,f)=>{const c=E.current;if(!c)return{x:0,y:0};const k=c.getBoundingClientRect();return{x:(n-k.left-V.x)/I/ee,y:(f-k.top-V.y)/I/ee}},_=(n,f)=>{if(n.button!==0)return;n.stopPropagation(),u(f);const c=i(n.clientX,n.clientY);O({x:c.x-f.x,y:c.y-f.y}),q(f),X(!0)},de=x.useCallback(n=>{if(B&&g&&a){const f=i(n.clientX,n.clientY);let c=Math.round(f.x-z.x),k=Math.round(f.y-z.y);c=Math.max(0,Math.min(c,a.widthFt-(g.widthFt||10))),k=Math.max(0,Math.min(k,a.heightFt-(g.heightFt||10))),m(o.map(F=>F.id===g.id?{...F,x:c,y:k}:F)),(p==null?void 0:p.id)===g.id&&u({...p,x:c,y:k})}else A&&y({x:V.x+n.movementX,y:V.y+n.movementY})},[B,g,z,A,V,o,p,a]),ne=x.useCallback(async()=>{if(B&&g){const n=o.find(f=>f.id===g.id);n&&await U(n.id,n.x,n.y)}X(!1),q(null),G(!1)},[B,g,o]);x.useEffect(()=>{if(B||A)return window.addEventListener("mousemove",de),window.addEventListener("mouseup",ne),()=>{window.removeEventListener("mousemove",de),window.removeEventListener("mouseup",ne)}},[B,A,de,ne]);const ce=()=>{const n=ae.current;if(!n)return;const f=window.open("","_blank");f.document.write(`<html><head><title>${(a==null?void 0:a.name)||"Boat Show Layout"}</title><style>body{margin:0;padding:20px;font-family:sans-serif}.header{text-align:center;margin-bottom:20px}.canvas-container{display:flex;justify-content:center}@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact}}</style></head><body><div class="header"><h1>${(a==null?void 0:a.name)||"Boat Show Layout"}</h1>${a!=null&&a.venue?`<p>Venue: ${a.venue}</p>`:""}${a!=null&&a.showDate?`<p>Date: ${new Date(a.showDate).toLocaleDateString()}</p>`:""}<p>Dimensions: ${a==null?void 0:a.widthFt}' × ${a==null?void 0:a.heightFt}'</p></div><div class="canvas-container">${n.outerHTML}</div></body></html>`),f.document.close(),f.print()},be=t.filter(n=>{var f,c,k;return!K||((f=n.name)==null?void 0:f.toLowerCase().includes(K.toLowerCase()))||((c=n.model)==null?void 0:c.toLowerCase().includes(K.toLowerCase()))||((k=n.make)==null?void 0:k.toLowerCase().includes(K.toLowerCase()))}),j=new Set(o.filter(n=>n.inventoryBoatId).map(n=>n.inventoryBoatId));return w?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"h-[calc(100vh-180px)] flex flex-col animate-slide-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Boat Show Planner"}),e.jsx("p",{className:"text-slate-600",children:"Design your boat show layout with drag and drop"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:ce,className:"flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Print"]}),e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Edit Show"]})]}),e.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"New Show"]})]})]}),s.length>0&&e.jsx("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto pb-2",children:s.map(n=>e.jsxs("button",{onClick:()=>r(n),className:`flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-all whitespace-nowrap ${(a==null?void 0:a.id)===n.id?"border-blue-500 bg-blue-50 text-blue-700":"border-slate-200 bg-white hover:border-blue-300 text-slate-700"}`,children:[e.jsx("span",{className:"font-medium",children:n.name}),n.showDate&&e.jsx("span",{className:"text-xs text-slate-500",children:new Date(n.showDate).toLocaleDateString()}),e.jsx("button",{onClick:f=>{f.stopPropagation(),ge(n.id)},className:"p-1 hover:bg-red-100 rounded text-slate-400 hover:text-red-600",children:e.jsx(ve,{className:"w-3 h-3"})})]},n.id))}),a?e.jsxs("div",{className:"flex flex-1 gap-4 min-h-0",children:[e.jsxs("div",{className:"flex-1 bg-slate-100 rounded-xl overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2 bg-white rounded-lg shadow-md p-1",children:[e.jsx("button",{onClick:()=>se(Math.min(I+.1,2)),className:"p-2 hover:bg-slate-100 rounded",title:"Zoom in",children:e.jsx(vl,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm font-medium text-slate-600 w-12 text-center",children:[Math.round(I*100),"%"]}),e.jsx("button",{onClick:()=>se(Math.max(I-.1,.3)),className:"p-2 hover:bg-slate-100 rounded",title:"Zoom out",children:e.jsx(yl,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-6 bg-slate-200"}),e.jsx("button",{onClick:()=>le(!Y),className:`p-2 rounded ${Y?"bg-blue-100 text-blue-600":"hover:bg-slate-100"}`,title:"Toggle grid",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{se(1),y({x:0,y:0})},className:"p-2 hover:bg-slate-100 rounded",title:"Reset view",children:e.jsx($t,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute top-4 right-4 z-10 bg-white rounded-lg shadow-md px-3 py-2",children:e.jsxs("p",{className:"text-sm font-medium text-slate-700",children:[a.widthFt,"' × ",a.heightFt,"'"]})}),e.jsx("div",{ref:E,className:"w-full h-full overflow-auto cursor-grab active:cursor-grabbing",onMouseDown:n=>{(n.target===E.current||n.target===ae.current)&&(G(!0),u(null))},children:e.jsx("div",{style:{transform:`translate(${V.x}px, ${V.y}px) scale(${I})`,transformOrigin:"0 0",padding:"40px"},children:e.jsxs("svg",{ref:ae,width:h().width,height:h().height,className:"bg-white shadow-lg",style:{border:"2px solid #cbd5e1"},children:[Y&&e.jsxs("g",{children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"minorGrid",width:ee,height:ee,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:`M ${ee} 0 L 0 0 0 ${ee}`,fill:"none",stroke:"#e2e8f0",strokeWidth:"0.5"})}),e.jsxs("pattern",{id:"majorGrid",width:ee*10,height:ee*10,patternUnits:"userSpaceOnUse",children:[e.jsx("rect",{width:ee*10,height:ee*10,fill:"url(#minorGrid)"}),e.jsx("path",{d:`M ${ee*10} 0 L 0 0 0 ${ee*10}`,fill:"none",stroke:"#cbd5e1",strokeWidth:"1"})]})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#majorGrid)"})]}),o.sort((n,f)=>(n.zIndex||0)-(f.zIndex||0)).map(n=>{const f=(n.widthFt||10)*ee,c=(n.heightFt||10)*ee,k=n.x*ee,F=n.y*ee,te=(p==null?void 0:p.id)===n.id,me=Qe[n.itemType]||Qe.furniture,pe=n.boat,je=pe?`${pe.year||""} ${pe.name}`.trim():n.label,De=n.itemType==="boat"?"#3b82f6":n.color||me.color;return e.jsxs("g",{transform:`translate(${k+f/2}, ${F+c/2}) rotate(${n.rotation||0}) translate(${-f/2}, ${-c/2})`,onMouseDown:Ye=>_(Ye,n),style:{cursor:"move"},children:[n.itemType==="boat"?e.jsx("path",{d:`M ${f*.1} 0 L ${f*.9} 0 L ${f} ${c*.5} L ${f*.9} ${c} L ${f*.1} ${c} L 0 ${c*.5} Z`,fill:De,stroke:te?"#1d4ed8":"#2563eb",strokeWidth:te?3:1}):e.jsx("rect",{width:f,height:c,fill:De,stroke:te?"#1d4ed8":"rgba(0,0,0,0.2)",strokeWidth:te?3:1,rx:n.itemType==="plant"?f/2:4,ry:n.itemType==="plant"?c/2:4}),e.jsx("text",{x:f/2,y:c/2,textAnchor:"middle",dominantBaseline:"middle",fill:"white",fontSize:Math.min(f,c)*.15,fontWeight:"bold",style:{pointerEvents:"none",userSelect:"none"},children:je==null?void 0:je.substring(0,20)}),e.jsxs("text",{x:f/2,y:c/2+Math.min(f,c)*.2,textAnchor:"middle",dominantBaseline:"middle",fill:"rgba(255,255,255,0.8)",fontSize:Math.min(f,c)*.1,style:{pointerEvents:"none",userSelect:"none"},children:[n.widthFt,"'×",n.heightFt,"'"]}),te&&e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:-4,y:-4,width:8,height:8,fill:"#1d4ed8"}),e.jsx("rect",{x:f-4,y:-4,width:8,height:8,fill:"#1d4ed8"}),e.jsx("rect",{x:-4,y:c-4,width:8,height:8,fill:"#1d4ed8"}),e.jsx("rect",{x:f-4,y:c-4,width:8,height:8,fill:"#1d4ed8"})]})]},n.id)})]})})})]}),e.jsxs("div",{className:"w-80 bg-white rounded-xl shadow-md border border-slate-200 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-slate-200",children:[e.jsx("button",{onClick:()=>W("boats"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${L==="boats"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"}`,children:"Boats"}),e.jsx("button",{onClick:()=>W("items"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${L==="items"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"}`,children:"Items"}),e.jsx("button",{onClick:()=>W("selected"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${L==="selected"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"}`,children:"Selected"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[L==="boats"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search boats...",value:K,onChange:n=>$(n.target.value),className:"w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"space-y-2",children:be.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No boats found"}):be.map(n=>{const f=j.has(n.id);return e.jsxs("button",{onClick:()=>!f&&xe(n),disabled:f,className:`w-full p-3 rounded-lg border text-left transition-all ${f?"border-green-200 bg-green-50 opacity-60":"border-slate-200 bg-white hover:border-blue-400 hover:shadow-sm"}`,children:[e.jsx("p",{className:"font-medium text-slate-900 text-sm truncate",children:n.name}),e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:[n.year," ",n.make," ",n.model]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:[n.length||"?","' × ",n.beam||"?","'"]}),f&&e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"✓ In layout"})]})]},n.id)})})]}),L==="items"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Click to add to layout"}),Object.entries(Qe).filter(([n])=>n!=="boat").map(([n,f])=>{const c=f.icon;return e.jsxs("button",{onClick:()=>ye(n),className:"w-full flex items-center gap-3 p-3 rounded-lg border border-slate-200 hover:border-blue-400 hover:shadow-sm transition-all",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:f.color},children:e.jsx(c,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-slate-900 text-sm",children:f.label}),e.jsxs("p",{className:"text-xs text-slate-500",children:[f.defaultWidth,"' × ",f.defaultHeight,"'"]})]})]},n)})]}),L==="selected"&&e.jsx("div",{children:p?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg",children:[e.jsx("p",{className:"font-medium text-slate-900",children:((C=p.boat)==null?void 0:C.name)||p.label||((M=Qe[p.itemType])==null?void 0:M.label)}),e.jsx("p",{className:"text-xs text-slate-500 capitalize",children:p.itemType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-700 mb-1 block",children:"Position"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500",children:"X (ft)"}),e.jsx("input",{type:"number",value:Math.round(p.x),onChange:n=>U(p.id,parseFloat(n.target.value)||0,p.y),className:"w-full px-2 py-1 border border-slate-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Y (ft)"}),e.jsx("input",{type:"number",value:Math.round(p.y),onChange:n=>U(p.id,p.x,parseFloat(n.target.value)||0),className:"w-full px-2 py-1 border border-slate-300 rounded text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-700 mb-1 block",children:"Size"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Width (ft)"}),e.jsx("input",{type:"number",value:p.widthFt||"",onChange:n=>re(p.id,parseFloat(n.target.value)||1,p.heightFt),className:"w-full px-2 py-1 border border-slate-300 rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Height (ft)"}),e.jsx("input",{type:"number",value:p.heightFt||"",onChange:n=>re(p.id,p.widthFt,parseFloat(n.target.value)||1),className:"w-full px-2 py-1 border border-slate-300 rounded text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-700 mb-1 block",children:"Rotation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>J(p.id,(p.rotation||0)-15),className:"p-2 bg-slate-100 hover:bg-slate-200 rounded-lg",children:e.jsx(pl,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:p.rotation||0,onChange:n=>J(p.id,parseFloat(n.target.value)||0),className:"flex-1 px-2 py-1 border border-slate-300 rounded text-sm text-center"}),e.jsx("span",{className:"text-sm text-slate-500",children:"°"}),e.jsx("button",{onClick:()=>J(p.id,(p.rotation||0)+15),className:"p-2 bg-slate-100 hover:bg-slate-200 rounded-lg",children:e.jsx(fl,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex gap-1 mt-2",children:[0,45,90,135,180,270].map(n=>e.jsxs("button",{onClick:()=>J(p.id,n),className:`flex-1 py-1 text-xs rounded ${p.rotation===n?"bg-blue-100 text-blue-700 font-medium":"bg-slate-100 hover:bg-slate-200 text-slate-600"}`,children:[n,"°"]},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-700 mb-1 block",children:"Layer"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Q(p),className:"flex-1 flex items-center justify-center gap-1 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm",children:[e.jsx(al,{className:"w-4 h-4"}),"Front"]}),e.jsxs("button",{onClick:()=>S(p),className:"flex-1 flex items-center justify-center gap-1 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm",children:[e.jsx(ll,{className:"w-4 h-4"}),"Back"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t border-slate-200",children:[p.itemType!=="boat"&&e.jsxs("button",{onClick:()=>fe(p),className:"flex-1 flex items-center justify-center gap-1 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-sm",children:[e.jsx(il,{className:"w-4 h-4"}),"Duplicate"]}),e.jsxs("button",{onClick:()=>ie(p.id),className:"flex-1 flex items-center justify-center gap-1 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg text-sm",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Remove"]})]})]}):e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx($t,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"Click an item on the canvas to select it"})]})})]}),L!=="selected"&&o.length>0&&e.jsxs("div",{className:"border-t border-slate-200 p-4",children:[e.jsxs("p",{className:"text-xs font-medium text-slate-700 mb-2",children:["In Layout (",o.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[o.slice(0,10).map(n=>{var f,c,k;return e.jsx("button",{onClick:()=>{u(n),W("selected")},className:`px-2 py-1 text-xs rounded-full ${(p==null?void 0:p.id)===n.id?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:((c=(f=n.boat)==null?void 0:f.name)==null?void 0:c.substring(0,10))||((k=n.label)==null?void 0:k.substring(0,10))||n.itemType},n.id)}),o.length>10&&e.jsxs("span",{className:"px-2 py-1 text-xs text-slate-400",children:["+",o.length-10," more"]})]})]})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-slate-50 rounded-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ct,{className:"w-16 h-16 mx-auto mb-4 text-slate-300"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-2",children:"No Boat Shows Yet"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Create your first boat show layout to get started"}),e.jsxs("button",{onClick:()=>P(!0),className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(We,{className:"w-5 h-5"}),"Create Boat Show"]})]})}),N&&e.jsx(Tt,{title:"Create New Boat Show",onSave:Z,onCancel:()=>P(!1),saving:D}),T&&a&&e.jsx(Tt,{title:"Edit Boat Show",show:a,onSave:ue,onCancel:()=>v(!1),saving:D})]})}const Ul=`
@media print {
  /* Hide non-printable elements */
  .no-print {
    display: none !important;
  }

  /* Reset page margins */
  @page {
    margin: 0.5in;
    size: landscape;
  }

  /* Ensure table fits on page */
  .print-table {
    width: 100%;
    font-size: 10pt;
    border-collapse: collapse;
  }

  .print-table th,
  .print-table td {
    border: 1px solid #ccc;
    padding: 6px 8px;
    text-align: left;
  }

  .print-table th {
    background-color: #f3f4f6 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Checkbox styling for print */
  .print-checkbox {
    width: 14px;
    height: 14px;
    border: 1.5px solid #333;
    display: inline-block;
    margin-right: 4px;
    vertical-align: middle;
  }

  /* Notes line for print */
  .print-notes-line {
    border-bottom: 1px solid #999;
    min-width: 150px;
    display: inline-block;
  }

  /* Page break handling */
  .print-row {
    page-break-inside: avoid;
  }
}
`,Nt=t=>{const s=new Date(t),l=s.getDay(),a=s.getDate()-l+(l===0?-6:1);return s.setDate(a),s.setHours(0,0,0,0),s},Zl=t=>{const s=Nt(t),l=new Date(s);return l.setDate(s.getDate()+6),l.setHours(23,59,59,999),l},ht=t=>t.toISOString().split("T")[0],Wt=(t,s)=>{const l={month:"short",day:"numeric"};return`${t.toLocaleDateString("en-US",l)} - ${s.toLocaleDateString("en-US",l)}, ${t.getFullYear()}`},pt=t=>{let s=null;for(const l of t.operations||[])if(l.last_worked_at){const a=new Date(l.last_worked_at);!isNaN(a.getTime())&&(!s||a>s)&&(s=a)}return s},Ql=(t,s,l)=>{var o;let a=null;if((o=t.boat)!=null&&o.location)a=t.boat.location;else if(t.rigging_id){const m=l.find(p=>p.dockmaster_id===t.rigging_id);a=m==null?void 0:m.location}if(!a)return!1;const r=s.find(m=>m.name===a);return(r==null?void 0:r.type)==="shop"||(r==null?void 0:r.type)==="workshop"};function Xl({currentUser:t}){var xe,ye;const[s,l]=x.useState({workOrders:[]}),[a,r]=x.useState(!0),[o,m]=x.useState(""),[p,u]=x.useState(7),[w,d]=x.useState(new Set),[D,H]=x.useState(null),[N,P]=x.useState(null),[T,v]=x.useState(null),[I,se]=x.useState(()=>Nt(new Date)),[V,y]=x.useState(null),[A,G]=x.useState({}),[Y,le]=x.useState(""),[L,W]=x.useState(!1),[K,$]=x.useState(""),g=Zl(I),q=x.useCallback(async()=>{try{const U=ht(I),{data:J,error:re}=await R.from("weekly_reports").select("*").eq("week_start",U).single();if(re&&re.code!=="PGRST116"&&console.error("Error loading weekly report:",re),J){y(J),le(J.notes||"");const{data:ie,error:fe}=await R.from("weekly_report_items").select("*").eq("report_id",J.id);if(fe)console.error("Error loading report items:",fe);else{const Q={};for(const S of ie||[])Q[S.work_order_id]={billing_status:S.billing_status,notes:S.notes||""};G(Q)}}else y(null),le(""),G({})}catch(U){console.error("Error in loadWeeklyReport:",U)}},[I]);x.useEffect(()=>{z()},[p]),x.useEffect(()=>{q()},[q]);const z=async()=>{r(!0),m("");try{const U=new Date;U.setDate(U.getDate()-p),U.setHours(0,0,0,0);const{data:J}=await R.from("locations").select("id, name, type"),{data:re}=await R.from("inventory_boats").select("id, dockmaster_id, location");let ie=[],fe=0;const Q=1e3;for(;;){const{data:C,error:M}=await R.from("work_order_operations").select("work_order_id, last_worked_at").gte("last_worked_at",U.toISOString()).range(fe,fe+Q-1);if(M)throw M;if(!C||C.length===0||(ie.push(...C),C.length<Q))break;fe+=Q}const S=new Map;for(const C of ie){const M=S.get(C.work_order_id);(!M||new Date(C.last_worked_at)>new Date(M))&&S.set(C.work_order_id,C.last_worked_at)}const h=[...S.keys()];if(h.length===0){l({workOrders:[]}),r(!1);return}const i=500,_=[];for(let C=0;C<h.length;C+=i){const M=h.slice(C,C+i),{data:n,error:f}=await R.from("work_orders").select(`
            *,
            boat:boats(id, name, owner, dockmaster_id, work_order_number, location)
          `).in("id",M).eq("status","O").gt("total_charges",0);if(f)throw f;n&&_.push(...n)}const de=_.map(C=>C.id),ne=[];for(let C=0;C<de.length;C+=i){const M=de.slice(C,C+i),{data:n,error:f}=await R.from("work_order_operations").select("*").in("work_order_id",M);if(f)throw f;n&&ne.push(...n)}const ce=new Map;for(const C of ne)ce.has(C.work_order_id)||ce.set(C.work_order_id,[]),ce.get(C.work_order_id).push(C);const j=_.map(C=>({...C,operations:ce.get(C.id)||[]})).filter(C=>!Ql(C,J||[],re||[]));j.sort((C,M)=>{const n=pt(C),f=pt(M);return((f==null?void 0:f.getTime())||0)-((n==null?void 0:n.getTime())||0)}),l({workOrders:j})}catch(U){console.error("Error loading unbilled work:",U),m(U.message||"Failed to load unbilled work")}finally{r(!1)}},O=U=>{const J=new Set(w);J.has(U)?J.delete(U):J.add(U),d(J)},B=()=>{const U=new Date(I);U.setDate(U.getDate()-7),se(U)},X=()=>{const U=new Date(I);U.setDate(U.getDate()+7),se(U)},ae=()=>{se(Nt(new Date))},E=(U,J,re)=>{G(ie=>({...ie,[U]:{...ie[U],[J]:re}}))},ee=async(U="draft")=>{W(!0),$("");try{const J=ht(I),re=ht(g),ie=s.workOrders.length,fe=s.workOrders.reduce((S,h)=>S+(h.total_charges||0),0);let Q=V==null?void 0:V.id;if(Q){const S={notes:Y,total_work_orders:ie,total_charges:fe,status:U};U==="submitted"&&V.status!=="submitted"&&(S.submitted_at=new Date().toISOString());const{error:h}=await R.from("weekly_reports").update(S).eq("id",Q);if(h)throw h}else{const{data:S,error:h}=await R.from("weekly_reports").insert({week_start:J,week_end:re,created_by:t==null?void 0:t.id,notes:Y,total_work_orders:ie,total_charges:fe,status:U,submitted_at:U==="submitted"?new Date().toISOString():null}).select().single();if(h)throw h;Q=S.id}for(const[S,h]of Object.entries(A))if(h.billing_status||h.notes){const{error:i}=await R.from("weekly_report_items").upsert({report_id:Q,work_order_id:parseInt(S),billing_status:h.billing_status||"pending",notes:h.notes||""},{onConflict:"report_id,work_order_id"});i&&console.error("Error saving report item:",i)}if(U==="submitted")try{await R.functions.invoke("notify-report-submitted",{body:{reportId:Q}})}catch(S){console.error("Failed to send notification:",S)}await q(),$(U==="submitted"?"Report submitted!":"Draft saved!"),setTimeout(()=>$(""),3e3)}catch(J){console.error("Error saving report:",J),$("Error saving report")}finally{W(!1)}},oe=()=>{const U=document.createElement("style");U.id="print-styles",U.textContent=Ul,document.head.appendChild(U),window.print(),setTimeout(()=>{const J=document.getElementById("print-styles");J&&J.remove()},1e3)},b=s.workOrders.length,Z=s.workOrders.reduce((U,J)=>{var re;return U+(((re=J.operations)==null?void 0:re.length)||0)},0),ue=s.workOrders.reduce((U,J)=>U+(J.total_charges||0),0),ge=({status:U})=>{const J={draft:{bg:"bg-yellow-100",text:"text-yellow-800",icon:ol,label:"Draft"},submitted:{bg:"bg-blue-100",text:"text-blue-800",icon:Et,label:"Submitted"},approved:{bg:"bg-green-100",text:"text-green-800",icon:rl,label:"Approved"}},re=J[U]||J.draft,ie=re.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm font-medium ${re.bg} ${re.text}`,children:[e.jsx(ie,{className:"w-4 h-4"}),re.label]})};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Weekly Reports"}),e.jsx("p",{className:"text-slate-600",children:"Track unbilled work orders and submit weekly billing reports"})]}),e.jsxs("div",{className:"mb-6 bg-white rounded-xl shadow-md border border-slate-200 p-4 no-print",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:B,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",title:"Previous week",children:e.jsx(Gt,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Week of"}),e.jsx("p",{className:"font-semibold text-slate-900",children:Wt(I,g)})]}),e.jsx("button",{onClick:X,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",title:"Next week",children:e.jsx(St,{className:"w-5 h-5 text-slate-600"})}),e.jsx("button",{onClick:ae,className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:"Today"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[V?e.jsx(ge,{status:V.status}):e.jsx("span",{className:"text-sm text-slate-500",children:"No report yet"}),(V==null?void 0:V.submitted_at)&&e.jsxs("span",{className:"text-xs text-slate-500",children:["Submitted: ",new Date(V.submitted_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ee("draft"),disabled:L||(V==null?void 0:V.status)==="approved",className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(gl,{className:"w-4 h-4"}),"Save Draft"]}),e.jsxs("button",{onClick:()=>ee("submitted"),disabled:L||(V==null?void 0:V.status)==="approved"||(V==null?void 0:V.status)==="submitted",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Et,{className:"w-4 h-4"}),"Submit Report"]})]})]}),K&&e.jsx("div",{className:`mt-3 text-sm font-medium ${K.includes("Error")?"text-red-600":"text-green-600"}`,children:K}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Weekly Notes / Summary"}),e.jsx("textarea",{value:Y,onChange:U=>le(U.target.value),placeholder:"Add notes about this week's billing review...",rows:3,disabled:(V==null?void 0:V.status)==="approved",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-100 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-4 no-print",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-700",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Last Updated:",e.jsxs("select",{value:p,onChange:U=>u(Number(U.target.value)),className:"px-3 py-1 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:14,children:"Last 14 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:60,children:"Last 60 days"})]})]}),e.jsx("button",{onClick:z,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"Refresh"}),e.jsxs("button",{onClick:oe,disabled:s.workOrders.length===0,className:"px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Print Report"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(Re,{title:"Unbilled Work Orders",value:b,subtitle:"With active charges",icon:Ge,color:"blue"}),e.jsx(Re,{title:"Total Operations",value:Z,subtitle:"Across all work orders",icon:Ne,color:"purple"}),e.jsx(Re,{title:"Total Charges",value:`$${ue.toFixed(2)}`,subtitle:"Unbilled amount",icon:tt,color:"green"})]}),o&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[e.jsx(tl,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900",children:"Error loading unbilled work"}),e.jsx("p",{className:"text-sm text-red-700",children:o})]})]}),a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-3 text-slate-600",children:"Loading unbilled work..."})]}),!a&&s.workOrders.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ge,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No unbilled work found"}),e.jsxs("p",{className:"text-slate-600",children:["No open work orders with charges updated in the last ",p," days"]})]}),e.jsxs("div",{className:"hidden print:block mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Unbilled Work Orders Report"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Week: ",Wt(I,g)," | Generated: ",new Date().toLocaleDateString()," | Total: ",b," work orders | $",ue.toFixed(2)," unbilled"]}),Y&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 rounded",children:[e.jsx("p",{className:"text-sm font-medium",children:"Notes:"}),e.jsx("p",{className:"text-sm",children:Y})]})]}),!a&&s.workOrders.length>0&&e.jsx("div",{className:"bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden print:shadow-none print:border-0",children:e.jsxs("table",{className:"w-full print-table",children:[e.jsx("thead",{className:"bg-slate-100 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Work Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Boat / Owner"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Charges"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Last Labor"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-slate-700 uppercase tracking-wider no-print",children:"Operations"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider",style:{minWidth:"120px"},children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider no-print",style:{minWidth:"200px"},children:"Notes"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:s.workOrders.map(U=>{const J=w.has(U.id),re=U.boat||{},ie=U.operations||[],fe=A[U.id]||{};return e.jsxs(Ht.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors print-row",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(U.id),className:"p-1 hover:bg-slate-200 rounded no-print",children:e.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform ${J?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),H(U)},className:"font-mono font-semibold text-blue-600 hover:text-blue-800 hover:underline",children:U.id})]}),U.title&&e.jsx("p",{className:"text-xs text-slate-600 mt-1 ml-7 print:ml-0",children:U.title})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium text-slate-900",children:re.name||"Unknown Boat"}),e.jsx("p",{className:"text-sm text-slate-600",children:re.owner||"Unknown Owner"})]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"font-semibold text-slate-900",children:["$",(U.total_charges||0).toFixed(2)]})}),e.jsx("td",{className:"px-4 py-3",children:(()=>{const Q=pt(U);return Q?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-slate-700",children:Q.toLocaleDateString()}),e.jsx("p",{className:"text-xs text-slate-500 no-print",children:Q.toLocaleTimeString()})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"Unknown"})})()}),e.jsx("td",{className:"px-4 py-3 text-center no-print",children:e.jsxs("span",{className:"px-2 py-1 bg-slate-100 text-slate-700 text-xs font-medium rounded",children:[ie.length," ops"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:fe.billing_status||"pending",onChange:Q=>E(U.id,"billing_status",Q.target.value),disabled:(V==null?void 0:V.status)==="approved",className:`w-full px-2 py-1 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:cursor-not-allowed ${fe.billing_status==="billed"?"bg-green-50 border-green-300 text-green-800":fe.billing_status==="not_billed"?"bg-red-50 border-red-300 text-red-800":"bg-yellow-50 border-yellow-300 text-yellow-800"}`,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"billed",children:"Billed"}),e.jsx("option",{value:"not_billed",children:"Not Billed"})]})}),e.jsx("td",{className:"px-4 py-3 no-print",children:e.jsx("input",{type:"text",value:fe.notes||"",onChange:Q=>E(U.id,"notes",Q.target.value),placeholder:"Add note...",disabled:(V==null?void 0:V.status)==="approved",className:"w-full px-2 py-1 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-100 disabled:cursor-not-allowed"})})]}),J&&ie.length>0&&e.jsx("tr",{className:"no-print",children:e.jsx("td",{colSpan:7,className:"px-4 py-2 bg-slate-50",children:e.jsxs("div",{className:"pl-7",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-700 uppercase mb-2",children:"Operations"}),e.jsx("div",{className:"space-y-1",children:ie.map((Q,S)=>e.jsxs("div",{onClick:()=>{P(Q),v(U.id)},className:"flex items-center justify-between p-2 bg-white rounded border border-slate-200 cursor-pointer hover:border-blue-400 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-xs font-semibold text-blue-600 hover:text-blue-800",children:Q.opcode}),e.jsx("span",{className:"text-sm text-slate-600",children:Q.opcode_desc||"No description"}),Q.flag_labor_finished&&e.jsx("span",{className:"px-2 py-0.5 bg-orange-500 text-white text-xs font-bold rounded uppercase",children:"Unbilled"})]}),e.jsxs("span",{className:"font-semibold text-slate-900",children:["$",(Q.total_charges||0).toFixed(2)]})]},S))})]})})})]},U.id)})})]})}),D&&e.jsx(Ct,{workOrders:[{...D,totalCharges:D.total_charges,creationDate:D.creation_date,operations:(D.operations||[]).map(U=>({...U,opcodeDesc:U.opcode_desc,totalCharges:U.total_charges,flagLaborFinished:U.flag_labor_finished}))}],boatName:((xe=D.boat)==null?void 0:xe.name)||"Unknown Boat",boatOwner:((ye=D.boat)==null?void 0:ye.owner)||"",onClose:()=>H(null),variant:"customer"}),N&&e.jsx(es,{operation:N,workOrderId:T,onClose:()=>{P(null),v(null)}})]})}if(typeof window<"u"){let t=null;const s=r=>{const o=r.target.closest('[draggable="true"]');if(o&&!o.classList.contains("customizer-drag")){t=o,o.style.opacity="0.5";const m=new Event("dragstart",{bubbles:!0});o.dispatchEvent(m)}},l=r=>{t&&r.preventDefault()},a=r=>{if(!t)return;t.style.opacity="";const o=r.changedTouches[0],m=document.elementFromPoint(o.clientX,o.clientY),p=m==null?void 0:m.closest(".location-slot");if(p&&p!==t){const w=new Event("drop",{bubbles:!0});p.dispatchEvent(w)}const u=new Event("dragend",{bubbles:!0});t.dispatchEvent(u),t=null};document.addEventListener("touchstart",s,{passive:!1}),document.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("touchend",a)}function ea({currentUser:t,onSignOut:s,boats:l=[],onAddBoat:a,onUpdateBoat:r,onDeleteBoat:o,onAssignNfcTag:m,onReleaseNfcTag:p,inventoryBoats:u=[],onUpdateInventoryBoat:w,onSyncInventory:d,onSyncInternalWorkOrders:D,lastInventorySync:H,locations:N=[],onAddLocation:P,onUpdateLocation:T,onDeleteLocation:v,onAssignBoatToSlot:I,onRemoveBoatFromSlot:se,onMoveBoat:V,sites:y=[],onAddSite:A,onUpdateSite:G,onDeleteSite:Y,onReorderSites:le,userPreferences:L={},onSavePreferences:W,users:K=[],onReloadUsers:$,dockmasterConfig:g,onSaveDockmasterConfig:q}){const[z,O]=x.useState(!0),[B,X]=x.useState("dashboard"),[ae,E]=x.useState(!1),ee=async J=>{const re=J.filter(Q=>!l.find(S=>S.id===Q.id)),ie=l.filter(Q=>!J.find(S=>S.id===Q.id)),fe=J.filter(Q=>{const S=l.find(h=>h.id===Q.id);return S&&JSON.stringify(S)!==JSON.stringify(Q)});for(const Q of re)await a(Q);for(const Q of ie)await o(Q.id);for(const Q of fe){const S=l.find(i=>i.id===Q.id),h={};for(const i in Q)JSON.stringify(Q[i])!==JSON.stringify(S==null?void 0:S[i])&&(h[i]=Q[i]);Object.keys(h).length>0&&await r(Q.id,h)}},oe=async J=>{const re=J.filter(Q=>!N.find(S=>S.id===Q.id)),ie=N.filter(Q=>!J.find(S=>S.id===Q.id)),fe=J.filter(Q=>{const S=N.find(h=>h.id===Q.id);return S&&JSON.stringify(S)!==JSON.stringify(Q)});for(const Q of re)await P(Q);for(const Q of ie)await v(Q.id);for(const Q of fe){const S=N.find(i=>i.id===Q.id),h={};for(const i in Q)JSON.stringify(Q[i])!==JSON.stringify(S==null?void 0:S[i])&&(h[i]=Q[i]);Object.keys(h).length>0&&await T(Q.id,h)}},b=async(J,re=null)=>{if(re){const ie=J.find(fe=>fe.id===re);ie&&await w(ie.id,ie);return}for(const ie of J){const fe=u.find(Q=>Q.id===ie.id);fe&&JSON.stringify(fe)!==JSON.stringify(ie)&&await w(ie.id,ie)}},Z=async(J,re)=>{try{await W(re)}catch(ie){console.error("Error saving user preferences:",ie)}},ue=async(J=!1)=>{if(!g||!g.username||!g.password){console.log("Dockmaster credentials not configured. Skipping inventory sync.");return}try{const re=await d(J);console.log(`Inventory sync completed. ${(re==null?void 0:re.count)||0} boats synced.`)}catch(re){console.error("Error syncing inventory boats:",re)}},ge=async(J=!1)=>{if(!(!g||!g.username||!g.password))try{const re=await D(J);console.log("Internal work orders sync completed:",re)}catch(re){console.error("Error syncing internal work orders:",re)}};x.useEffect(()=>{if(!(g!=null&&g.username)||!(g!=null&&g.password))return;const J=setTimeout(()=>{ue(!1)},1e3),re=setInterval(()=>ue(!1),18e5);return()=>{clearTimeout(J),clearInterval(re)}},[g]);const xe=J=>{O(!0),X("dashboard")},ye=async()=>{O(!1),await s(),X("dashboard"),E(!1)};if(!z)return e.jsx(jl,{users:K,onLogin:xe});const U=()=>{const J={},re=[];return l.forEach(ie=>{J[ie.id]||(J[ie.id]=!0,re.push(ie))}),u.forEach(ie=>{if(!J[ie.id])J[ie.id]=!0,re.push(ie);else{const fe=re.findIndex(Q=>Q.id===ie.id);fe!==-1&&(re[fe]=ie)}}),re};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-slate-100",children:[e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap');
        * { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Archivo', sans-serif; }
        .boat-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .boat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(15, 23, 42, 0.15); }
        .location-slot { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .location-slot:not([draggable="true"]):hover { background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3); }
        .location-slot[draggable="true"]:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .location-slot[draggable="true"] { cursor: grab; user-select: none; }
        .location-slot[draggable="true"]:active { cursor: grabbing; }
        .dragging { opacity: 0.4; transform: scale(0.95); }
        .drag-over { border-color: #3b82f6 !important; background: rgba(59, 130, 246, 0.15) !important; transform: scale(1.02); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); }
        .unassigned-boat { user-select: none; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .unassigned-boat:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .unassigned-boat:active { transform: scale(0.98); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
        .status-needs-approval { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .status-needs-parts { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .status-parts-kit-pulled { background: linear-gradient(135deg, #f97316, #ea580c); }
        .status-on-deck { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .status-all-work-complete { background: linear-gradient(135deg, #10b981, #059669); }
        .status-archived { background: linear-gradient(135deg, #6b7280, #4b5563); }
      `}),e.jsx("nav",{className:"bg-white border-b border-slate-200 shadow-sm sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center h-14 lg:h-16",children:[e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 min-w-0",children:[e.jsx("img",{src:"/images/favicon.png",alt:"Boats by George",className:"w-8 h-8 lg:w-10 lg:h-10 object-contain flex-shrink-0",onError:J=>{J.target.style.display="none",J.target.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg flex items-center justify-center flex-shrink-0",style:{display:"none"},children:e.jsx(Ne,{className:"w-5 h-5 lg:w-6 lg:h-6 text-white"})}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Boats By George"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Asset Management System"})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[e.jsx($e,{icon:Lt,label:"Dashboard",active:B==="dashboard",onClick:()=>X("dashboard")}),e.jsx($e,{icon:yt,label:"My View",active:B==="myview",onClick:()=>X("myview")}),e.jsx($e,{icon:Ae,label:"Locations",active:B==="locations",onClick:()=>X("locations")}),e.jsx($e,{icon:Ne,label:"Boats",active:B==="boats",onClick:()=>X("boats")}),e.jsx($e,{icon:Ne,label:"Inventory",active:B==="inventory",onClick:()=>X("inventory")}),e.jsx($e,{icon:ct,label:"Shows",active:B==="shows",onClick:()=>X("shows")}),e.jsx($e,{icon:Ge,label:"Reports",active:B==="reports",onClick:()=>X("reports")}),e.jsx($e,{icon:vt,label:"Scan",active:B==="scan",onClick:()=>X("scan")}),e.jsx($e,{icon:st,label:"Settings",active:B==="settings",onClick:()=>X("settings")}),e.jsx("div",{className:"flex items-center ml-2 pl-2 border-l border-slate-200",children:e.jsx("button",{onClick:ye,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",title:"Logout",children:e.jsx(At,{className:"w-5 h-5 text-slate-600"})})})]}),e.jsxs("div",{className:"flex lg:hidden items-center gap-2",children:[e.jsx("button",{onClick:ye,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",title:"Logout",children:e.jsx(At,{className:"w-4 h-4 lg:w-5 lg:h-5 text-slate-600"})}),e.jsx("button",{onClick:()=>E(!ae),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",title:"Menu",children:e.jsx(xl,{className:"w-5 h-5 lg:w-6 lg:h-6 text-slate-600"})})]})]}),ae&&e.jsx("div",{className:"lg:hidden border-t border-slate-200 py-2 bg-white",children:e.jsx("div",{className:"flex flex-col gap-1",children:[{view:"dashboard",icon:Lt,label:"Dashboard"},{view:"myview",icon:yt,label:"My View"},{view:"locations",icon:Ae,label:"Locations"},{view:"boats",icon:Ne,label:"Boats"},{view:"inventory",icon:Ne,label:"Inventory"},{view:"shows",icon:ct,label:"Shows"},{view:"reports",icon:Ge,label:"Reports"},{view:"scan",icon:vt,label:"Scan"},{view:"settings",icon:st,label:"Settings"}].map(({view:J,icon:re,label:ie})=>e.jsxs("button",{onClick:()=>{X(J),E(!1)},className:`flex items-center gap-3 px-4 py-2.5 text-sm font-medium transition-colors ${B===J?"bg-blue-50 text-blue-700":"text-slate-700 hover:bg-slate-50"}`,children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{children:ie})]},J))})})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[B==="dashboard"&&e.jsx(Al,{boats:l,locations:N,sites:y,onNavigate:X,onUpdateBoats:ee,onUpdateLocations:oe,onMoveBoat:V,currentUser:t}),B==="locations"&&e.jsx(Tl,{locations:N,sites:y,boats:U(),onUpdateLocations:oe,onUpdateBoats:J=>{ee(J.filter(re=>!re.isInventory)),b(J.filter(re=>re.isInventory))},onMoveBoat:V,onAddSite:A,onUpdateSite:G,onDeleteSite:Y,onReorderSites:le,currentUser:t}),B==="boats"&&e.jsx(Fl,{boats:l,locations:N,sites:y,onUpdateBoats:ee,onMoveBoat:V,dockmasterConfig:g,currentUser:t}),B==="scan"&&e.jsx(Wl,{boats:l,locations:N,onUpdateBoats:ee,onUpdateLocations:oe}),B==="myview"&&e.jsx(ql,{locations:N,sites:y,boats:U(),userPreferences:L,currentUser:t,onSavePreferences:J=>Z((t==null?void 0:t.id)||(t==null?void 0:t.username)||"default-user",J),onUpdateLocations:oe,onUpdateBoats:J=>{ee(J.filter(re=>!re.isInventory)),b(J.filter(re=>re.isInventory))},onMoveBoat:V}),B==="inventory"&&e.jsx(zl,{inventoryBoats:u,boats:l,locations:N,sites:y,lastSync:H,onSyncNow:ue,onSyncRiggingWOs:ge,onUpdateInventoryBoats:b,onUpdateSingleBoat:w,onMoveBoat:V,dockmasterConfig:g,currentUser:t}),B==="shows"&&e.jsx(Jl,{inventoryBoats:u}),B==="reports"&&e.jsx(Xl,{currentUser:t}),B==="settings"&&e.jsx(Gl,{dockmasterConfig:g,currentUser:t,users:K,onSaveConfig:q,onUpdateUsers:()=>console.log("User updates handled by auth system"),onReloadUsers:$})]})]})}function ft(t,s){let l=null;const a=(...r)=>{l&&clearTimeout(l),l=setTimeout(()=>{l=null,t(...r)},s)};return a.cancel=()=>{l&&(clearTimeout(l),l=null)},a}const{boats:Ee,inventoryBoats:Pe,locations:it,sites:Xe,preferences:qt,dockmaster:gt,users:ta}=Le;function sa(){const{user:t,signOut:s}=lt(),[l,a]=x.useState([]),[r,o]=x.useState([]),[m,p]=x.useState([]),[u,w]=x.useState([]),[d,D]=x.useState({}),[H,N]=x.useState([]),[P,T]=x.useState(null),[v,I]=x.useState(null),[se,V]=x.useState(!0),y=x.useRef(!1),A=x.useRef({loadBoats:null,loadLocations:null,loadInventoryBoats:null}),G=x.useRef(null),Y=x.useRef(null);x.useEffect(()=>{t&&le()},[t]),x.useEffect(()=>{if(!t)return;console.log("Setting up real-time subscriptions...");const h=ft(()=>{if(y.current){console.log("Real-time update: skipping boats reload (sync in progress)");return}console.log("Real-time update: reloading boats (debounced)"),L()},2e3),i=ft(()=>{if(y.current){console.log("Real-time update: skipping locations reload (sync in progress)");return}console.log("Real-time update: reloading locations (debounced)"),K()},2e3),_=ft(()=>{if(y.current){console.log("Real-time update: skipping inventory boats reload (sync in progress)");return}console.log("Real-time update: reloading inventory boats (debounced)"),W()},2e3);A.current={loadBoats:h,loadLocations:i,loadInventoryBoats:_};try{const de=Le.subscriptions.subscribeToBoats(()=>{console.log("Real-time update: boats changed"),h(),i()}),ne=Le.subscriptions.subscribeToLocations(()=>{console.log("Real-time update: locations changed"),i(),h()}),ce=()=>Le.subscriptions.subscribeToInventoryBoats(()=>{y.current||(console.log("Real-time update: inventory boats changed"),_(),i())});return G.current=ce(),Y.current=()=>{console.log("Re-subscribing to inventory real-time updates..."),G.current=ce()},console.log("Real-time subscriptions active"),()=>{console.log("Cleaning up real-time subscriptions..."),Le.subscriptions.unsubscribe(de),Le.subscriptions.unsubscribe(ne),G.current&&Le.subscriptions.unsubscribe(G.current)}}catch(de){console.error("Error setting up real-time subscriptions:",de)}},[t]);const le=async()=>{V(!0),console.log("Starting to load all data...");try{const h=new Promise((i,_)=>setTimeout(()=>_(new Error("Data loading timeout after 10 seconds")),1e4));await Promise.race([Promise.all([L().then(()=>console.log("✓ Boats loaded")),W().then(()=>console.log("✓ Inventory boats loaded")),K().then(()=>console.log("✓ Locations loaded")),$().then(()=>console.log("✓ Sites loaded")),g().then(()=>console.log("✓ User preferences loaded")),q().then(()=>console.log("✓ Users loaded")),z().then(()=>console.log("✓ Dockmaster config loaded"))]),h]),console.log("All data loaded successfully!")}catch(h){console.error("Error loading data:",h),alert("Failed to load data. Please refresh the page or contact support.")}finally{V(!1)}},L=async()=>{try{const i=(await Ee.getAll()).map(_=>({..._,qrCode:_.qr_code,nfcTag:_.nfc_tag,workOrderNumber:_.work_order_number,mechanicalsComplete:_.mechanicals_complete??!1,cleanComplete:_.clean_complete??!1,fiberglassComplete:_.fiberglass_complete??!1,warrantyComplete:_.warranty_complete??!1,invoicedComplete:_.invoiced_complete??!1,archivedDate:_.archived_date,completedBy:_.completed_by,completedAt:_.completed_at,notesUpdatedBy:_.notes_updated_by,notesUpdatedAt:_.notes_updated_at,dockmasterId:_.dockmaster_id,customerId:_.customer_id,hullId:_.hull_id,storageBoat:_.storage_boat??!1,fallStatus:_.fall_status||"needs-approval",winterStatus:_.winter_status||"needs-approval",springStatus:_.spring_status||"needs-approval",fallMechanicalsComplete:_.fall_mechanicals_complete??!1,fallCleanComplete:_.fall_clean_complete??!1,fallFiberglassComplete:_.fall_fiberglass_complete??!1,fallWarrantyComplete:_.fall_warranty_complete??!1,fallInvoicedComplete:_.fall_invoiced_complete??!1,winterMechanicalsComplete:_.winter_mechanicals_complete??!1,winterCleanComplete:_.winter_clean_complete??!1,winterFiberglassComplete:_.winter_fiberglass_complete??!1,winterWarrantyComplete:_.winter_warranty_complete??!1,winterInvoicedComplete:_.winter_invoiced_complete??!1,springMechanicalsComplete:_.spring_mechanicals_complete??!1,springCleanComplete:_.spring_clean_complete??!1,springFiberglassComplete:_.spring_fiberglass_complete??!1,springWarrantyComplete:_.spring_warranty_complete??!1,springInvoicedComplete:_.spring_invoiced_complete??!1,fallCompletedBy:_.fall_completed_by||null,fallCompletedAt:_.fall_completed_at||null,winterCompletedBy:_.winter_completed_by||null,winterCompletedAt:_.winter_completed_at||null,springCompletedBy:_.spring_completed_by||null,springCompletedAt:_.spring_completed_at||null}));a(i)}catch(h){console.error("Error loading boats:",h)}},W=async()=>{try{const i=(await Pe.getAll()).map(_=>({..._,qrCode:_.qr_code,nfcTag:_.nfc_tag,workOrderNumber:_.work_order_number,mechanicalsComplete:_.mechanicals_complete??!1,cleanComplete:_.clean_complete??!1,fiberglassComplete:_.fiberglass_complete??!1,warrantyComplete:_.warranty_complete??!1,invoicedComplete:_.invoiced_complete??!1,archivedDate:_.archived_date,completedBy:_.completed_by,completedAt:_.completed_at,notesUpdatedBy:_.notes_updated_by,notesUpdatedAt:_.notes_updated_at,dockmasterId:_.dockmaster_id,hullId:_.hull_id,salesStatus:_.sales_status,lastSynced:_.last_synced,isInventory:!0}));o(i)}catch(h){console.error("Error loading inventory boats:",h)}},K=async()=>{try{const h=await it.getAll();p(h)}catch(h){console.error("Error loading locations:",h)}},$=async()=>{try{const h=await Xe.getAll();w(h||[])}catch(h){console.error("Error loading sites:",h)}},g=async()=>{try{if(!t||!t.id){console.warn("Cannot load preferences: user or user.id is missing");return}const h=await qt.get(t.id);h&&D({selectedLocations:h.selected_locations||[],locationOrder:h.location_order||[]})}catch(h){console.error("Error loading preferences:",h)}},q=async()=>{try{if(t&&t.role==="admin"){const h=await ta.getAll();N(h)}}catch(h){console.error("Error loading users:",h)}},z=async()=>{try{const h=await gt.getConfig();h&&(T({baseUrl:h.base_url,username:h.username,password:h.password}),I(h.last_sync))}catch(h){console.error("Error loading dockmaster config:",h)}},O=async h=>{try{await ze.importOrUpdateBoat(h,{targetStatus:"needs-approval",preserveLocation:!1}),await L()}catch(i){throw console.error("Error adding boat:",i),i}},B=async(h,i)=>{try{const{sales_status:_,last_synced:de,isInventory:ne,currentLocation:ce,currentSlot:be,qrCode:j,nfcTag:C,workOrderNumber:M,mechanicalsComplete:n,cleanComplete:f,fiberglassComplete:c,warrantyComplete:k,invoicedComplete:F,archivedDate:te,completedAt:me,completedBy:pe,notesUpdatedBy:je,notesUpdatedAt:De,dockmasterId:Ye,customerId:Ie,hullId:Me,storageBoat:ms,fallStatus:us,winterStatus:xs,springStatus:hs,fallMechanicalsComplete:ps,fallCleanComplete:fs,fallFiberglassComplete:gs,fallWarrantyComplete:bs,fallInvoicedComplete:ws,winterMechanicalsComplete:vs,winterCleanComplete:ys,winterFiberglassComplete:js,winterWarrantyComplete:Ns,winterInvoicedComplete:ks,springMechanicalsComplete:Ss,springCleanComplete:Cs,springFiberglassComplete:_s,springWarrantyComplete:Bs,springInvoicedComplete:Bt,fallCompletedBy:Se,fallCompletedAt:la,winterCompletedBy:aa,winterCompletedAt:ra,springCompletedBy:na,springCompletedAt:oa,qr_code:ia,nfc_tag:ca,work_order_number:da,mechanicals_complete:ma,clean_complete:ua,fiberglass_complete:xa,warranty_complete:ha,invoiced_complete:pa,archived_date:fa,completed_at:ga,completed_by:ba,notes_updated_by:wa,notes_updated_at:va,dockmaster_id:ya,customer_id:ja,hull_id:Na,storage_boat:ka,fall_status:Sa,winter_status:Ca,spring_status:_a,fall_mechanicals_complete:Ba,fall_clean_complete:Da,fall_fiberglass_complete:La,fall_warranty_complete:Aa,fall_invoiced_complete:$a,winter_mechanicals_complete:Ea,winter_clean_complete:Oa,winter_fiberglass_complete:Ia,winter_warranty_complete:Ma,winter_invoiced_complete:Pa,spring_mechanicals_complete:Fa,spring_clean_complete:Ra,spring_fiberglass_complete:Ta,spring_warranty_complete:Wa,spring_invoiced_complete:qa,fall_completed_by:Ha,fall_completed_at:za,winter_completed_by:Va,winter_completed_at:Ya,spring_completed_by:Ka,spring_completed_at:Ga,...Ds}=i,we={...Ds};"qrCode"in i&&(we.qr_code=i.qrCode),"nfcTag"in i&&(we.nfc_tag=i.nfcTag),"workOrderNumber"in i&&(we.work_order_number=i.workOrderNumber),"mechanicalsComplete"in i&&(we.mechanicals_complete=i.mechanicalsComplete),"cleanComplete"in i&&(we.clean_complete=i.cleanComplete),"fiberglassComplete"in i&&(we.fiberglass_complete=i.fiberglassComplete),"warrantyComplete"in i&&(we.warranty_complete=i.warrantyComplete),"invoicedComplete"in i&&(we.invoiced_complete=i.invoicedComplete),"archivedDate"in i&&(we.archived_date=i.archivedDate),"completedAt"in i&&(we.completed_at=i.completedAt),"completedBy"in i&&(we.completed_by=i.completedBy),"notesUpdatedBy"in i&&(we.notes_updated_by=i.notesUpdatedBy),"notesUpdatedAt"in i&&(we.notes_updated_at=i.notesUpdatedAt),"dockmasterId"in i&&(we.dockmaster_id=i.dockmasterId),"customerId"in i&&(we.customer_id=i.customerId),"hullId"in i&&(we.hull_id=i.hullId),"storageBoat"in i&&(we.storage_boat=i.storageBoat),"fallStatus"in i&&(we.fall_status=i.fallStatus),"winterStatus"in i&&(we.winter_status=i.winterStatus),"springStatus"in i&&(we.spring_status=i.springStatus),"fallMechanicalsComplete"in i&&(we.fall_mechanicals_complete=i.fallMechanicalsComplete),"fallCleanComplete"in i&&(we.fall_clean_complete=i.fallCleanComplete),"fallFiberglassComplete"in i&&(we.fall_fiberglass_complete=i.fallFiberglassComplete),"fallWarrantyComplete"in i&&(we.fall_warranty_complete=i.fallWarrantyComplete),"fallInvoicedComplete"in i&&(we.fall_invoiced_complete=i.fallInvoicedComplete),"winterMechanicalsComplete"in i&&(we.winter_mechanicals_complete=i.winterMechanicalsComplete),"winterCleanComplete"in i&&(we.winter_clean_complete=i.winterCleanComplete),"winterFiberglassComplete"in i&&(we.winter_fiberglass_complete=i.winterFiberglassComplete),"winterWarrantyComplete"in i&&(we.winter_warranty_complete=i.winterWarrantyComplete),"winterInvoicedComplete"in i&&(we.winter_invoiced_complete=i.winterInvoicedComplete),"springMechanicalsComplete"in i&&(we.spring_mechanicals_complete=i.springMechanicalsComplete),"springCleanComplete"in i&&(we.spring_clean_complete=i.springCleanComplete),"springFiberglassComplete"in i&&(we.spring_fiberglass_complete=i.springFiberglassComplete),"springWarrantyComplete"in i&&(we.spring_warranty_complete=i.springWarrantyComplete),"springInvoicedComplete"in i&&(we.spring_invoiced_complete=i.springInvoicedComplete),"fallCompletedBy"in i&&(we.fall_completed_by=i.fallCompletedBy),"fallCompletedAt"in i&&(we.fall_completed_at=i.fallCompletedAt),"winterCompletedBy"in i&&(we.winter_completed_by=i.winterCompletedBy),"winterCompletedAt"in i&&(we.winter_completed_at=i.winterCompletedAt),"springCompletedBy"in i&&(we.spring_completed_by=i.springCompletedBy),"springCompletedAt"in i&&(we.spring_completed_at=i.springCompletedAt),await Ee.update(h,we),await L()}catch(_){throw console.error("Error updating boat:",_),_}},X=async h=>{try{await Ee.delete(h),await L()}catch(i){throw console.error("Error deleting boat:",i),i}},ae=async(h,i)=>{try{await Ee.assignNfcTag(h,i),await L()}catch(_){throw console.error("Error assigning NFC tag:",_),_}},E=async h=>{try{await Ee.releaseNfcTag(h),await L()}catch(i){throw console.error("Error releasing NFC tag:",i),i}},ee=async(h,i)=>{try{const{isInventory:_,currentLocation:de,currentSlot:ne,qrCode:ce,nfcTag:be,workOrderNumber:j,mechanicalsComplete:C,cleanComplete:M,fiberglassComplete:n,warrantyComplete:f,invoicedComplete:c,archivedDate:k,completedAt:F,completedBy:te,notesUpdatedBy:me,notesUpdatedAt:pe,dockmasterId:je,hullId:De,salesStatus:Ye,lastSynced:Ie,qr_code:Me,nfc_tag:ms,work_order_number:us,mechanicals_complete:xs,clean_complete:hs,fiberglass_complete:ps,warranty_complete:fs,invoiced_complete:gs,archived_date:bs,completed_at:ws,completed_by:vs,notes_updated_by:ys,notes_updated_at:js,dockmaster_id:Ns,hull_id:ks,sales_status:Ss,last_synced:Cs,location:_s,slot:Bs,...Bt}=i,Se={...Bt};"workOrderNumber"in i&&(Se.work_order_number=i.workOrderNumber),"mechanicalsComplete"in i&&(Se.mechanicals_complete=i.mechanicalsComplete),"cleanComplete"in i&&(Se.clean_complete=i.cleanComplete),"fiberglassComplete"in i&&(Se.fiberglass_complete=i.fiberglassComplete),"warrantyComplete"in i&&(Se.warranty_complete=i.warrantyComplete),"invoicedComplete"in i&&(Se.invoiced_complete=i.invoicedComplete),"completedAt"in i&&(Se.completed_at=i.completedAt),"completedBy"in i&&(Se.completed_by=i.completedBy),"notesUpdatedBy"in i&&(Se.notes_updated_by=i.notesUpdatedBy),"notesUpdatedAt"in i&&(Se.notes_updated_at=i.notesUpdatedAt),Object.keys(Se).length>0&&(console.log("Inventory boat update - sending to DB:",Se),await Pe.update(h,Se),await W())}catch(_){throw console.error("Error updating inventory boat:",_),_}},oe=async(h=!1)=>{var _,de;y.current=!0,console.log("Sync started - blocking real-time reloads");const i=A.current;i.loadBoats&&i.loadBoats.cancel(),i.loadLocations&&i.loadLocations.cancel(),i.loadInventoryBoats&&i.loadInventoryBoats.cancel(),console.log("Cancelled pending debounced reloads"),G.current&&(console.log("Unsubscribing from inventory real-time updates during sync..."),Le.subscriptions.unsubscribe(G.current),G.current=null);try{console.log(`Calling Dockmaster inventory sync (${h?"full":"incremental"})...`);const be=await fetch("undefined/functions/v1/dockmaster-inventory",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({fullSync:h})});if(!be.ok){const C=await be.json();throw console.error("Inventory sync error:",C),new Error(C.error||"Failed to sync inventory")}const j=await be.json();if(console.log(`Received ${((_=j.boats)==null?void 0:_.length)||0} boats from Dockmaster`),j.boats&&j.boats.length>0){const C=j.boats.map(M=>({dockmaster_id:M.dockmasterId,hull_id:M.hullId,name:M.name,model:M.model,make:M.make,year:M.year,owner:"INVENTORY",status:"needs-approval",sales_status:M.salesStatus,qr_code:`INV-${M.dockmasterId}`,length:M.length,beam:M.beam,stock_number:M.stockNumber,color:M.color,list_price:M.listPrice,total_cost:M.totalCost,received_date:M.receivedDate,comments:M.comments,draft:M.draft,weight:M.weight,hull_type:M.hullType,hull_material:M.hullMaterial,fuel_capacity:M.fuelCapacity,water_capacity:M.waterCapacity,motor_rating:M.motorRating,sleep_capacity:M.sleepCapacity,motors:M.motors,trailers:M.trailers,options:M.options,accessories:M.accessories,raw_data:M.rawData}));await Pe.sync(C,h)}return await gt.updateLastSync(),y.current=!1,console.log("Sync completed - re-enabling real-time reloads"),await W(),await z(),Y.current&&Y.current(),console.log("Inventory sync completed successfully"),{success:!0,count:((de=j.boats)==null?void 0:de.length)||0}}catch(ne){throw y.current=!1,Y.current&&Y.current(),console.error("Error syncing inventory:",ne),ne}},b=async(h=!1)=>{try{console.log(`Calling internal work orders sync (${h?"full":"incremental"})...`);const de=await fetch("undefined/functions/v1/dockmaster-internal-workorders-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({fullSync:h})});if(!de.ok){const ce=await de.json();throw console.error("Internal work orders sync error:",ce),new Error(ce.error||"Failed to sync internal work orders")}const ne=await de.json();return console.log("Internal work orders sync completed:",ne),ne}catch(i){throw console.error("Error syncing internal work orders:",i),i}},Z=async h=>{try{const{id:i,poolBoats:_,pool_boats:de,...ne}=h,ce={...ne,boats:ne.boats||{}};h.type==="pool"&&(ce.pool_boats=de||[]),await it.create(ce),await K()}catch(i){throw console.error("Error adding location:",i),i}},ue=async(h,i)=>{try{await it.update(h,i),await K()}catch(_){throw console.error("Error updating location:",_),_}},ge=async h=>{try{await it.delete(h),await K()}catch(i){throw console.error("Error deleting location:",i),i}},xe=async(h,i,_,de=!1)=>{try{de?(await Pe.assignToSlot(h,i,_),await W()):(await Ee.assignToSlot(h,i,_),await L()),await K()}catch(ne){throw console.error("Error assigning boat to slot:",ne),ne}},ye=async(h,i=!1)=>{try{i?(await Pe.removeFromSlot(h),await W()):(await Ee.removeFromSlot(h),await L()),await K()}catch(_){throw console.error("Error removing boat from slot:",_),_}},U=async(h,i,_,de=!1)=>{var be;console.log("[AppContainer.handleMoveBoat] Called with:",{boatOrBoatId:h,toLocationId:i,toSlotId:_,isInventory:de});const ne=typeof h=="object"?h:null,ce=ne?ne.id:h;try{let j=ne;if(!j&&(j=(de?r:l).find(c=>c.id===ce),!j))throw new Error("Boat not found");const C=j.location||null,M=j.slot||null,n=i?(be=m.find(f=>f.id===i))==null?void 0:be.name:null;i?(console.log("[AppContainer.handleMoveBoat] Moving boat to new location"),de?(await Pe.moveToSlot(ce,i,_),await W()):(await Ee.moveToSlot(ce,i,_),await L())):(console.log("[AppContainer.handleMoveBoat] Removing boat from location"),de?(console.log("[AppContainer.handleMoveBoat] Calling inventoryBoatsService.removeFromSlot"),await Pe.removeFromSlot(ce),console.log("[AppContainer.handleMoveBoat] Reloading inventory boats"),await W()):(await Ee.removeFromSlot(ce),await L()));try{const f=de||j.isInventory?"inventory":"customer";await Le.boatMovements.logMovement({boatId:ce,boatType:f,fromLocation:C,fromSlot:M,toLocation:n,toSlot:_||null,movedBy:t==null?void 0:t.id,notes:null}),console.log("[AppContainer.handleMoveBoat] Movement logged successfully")}catch(f){console.error("Failed to log movement:",f)}console.log("[AppContainer.handleMoveBoat] Reloading locations"),await K(),console.log("[AppContainer.handleMoveBoat] Complete")}catch(j){throw console.error("Error moving boat:",j),j}},J=async h=>{try{await Xe.create(h),await $()}catch(i){throw console.error("Error adding site:",i),i}},re=async(h,i)=>{try{await Xe.update(h,i),await $()}catch(_){throw console.error("Error updating site:",_),_}},ie=async h=>{try{await Xe.delete(h),await $()}catch(i){throw console.error("Error deleting site:",i),i}},fe=async h=>{try{await Xe.reorder(h),await $()}catch(i){throw console.error("Error reordering sites:",i),i}},Q=async h=>{try{await qt.save(t.id,h),D(h)}catch(i){throw console.error("Error saving preferences:",i),i}},S=async h=>{try{await gt.saveConfig({base_url:h.baseUrl,username:h.username,password:h.password}),await z()}catch(i){throw console.error("Error saving dockmaster config:",i),i}};return se?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 text-lg",children:"Loading your workspace..."})]})}):e.jsx(ea,{currentUser:t,onSignOut:s,boats:l,onAddBoat:O,onUpdateBoat:B,onDeleteBoat:X,onAssignNfcTag:ae,onReleaseNfcTag:E,inventoryBoats:r,onUpdateInventoryBoat:ee,onSyncInventory:oe,onSyncInternalWorkOrders:b,lastInventorySync:v,locations:m,onAddLocation:Z,onUpdateLocation:ue,onDeleteLocation:ge,onAssignBoatToSlot:xe,onRemoveBoatFromSlot:ye,onMoveBoat:U,sites:u,onAddSite:J,onUpdateSite:re,onDeleteSite:ie,onReorderSites:fe,userPreferences:d,onSavePreferences:Q,users:H,onReloadUsers:q,dockmasterConfig:P,onSaveDockmasterConfig:S})}bt.createRoot(document.getElementById("root")).render(e.jsx(Ht.StrictMode,{children:e.jsx(Js,{children:e.jsx(Qs,{children:e.jsx(sa,{})})})}));
